
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Spin Wheel</title>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<style>
:root{
  --bg1:#150720;
  --bg2:#2b0f41;

  /* ✅ rgb helper */
  --bg1rgb: 21 7 32;
  --bg2rgb: 43 15 65;

  --goldA:#ffd36d;
  --goldB:#ffb300;
  --goldC:#d98b00;

  --text:#ffffff;
  --yellow:#ffcf52;

  --green1:#39ff5c;
  --green2:#19da3e;
  --green3:#10b834;

  --safeT: env(safe-area-inset-top, 0px);
  --safeB: env(safe-area-inset-bottom, 0px);

  /* ✅ Responsive Core */
  --stageMax: 560px;
  --wheelSize: clamp(360px, 86vw, 520px);

  /* ✅ Wheel naik ke atas */
  --wheelLift: clamp(-25px, -5svh, -22px);

  /* ✅ Bottom Hero Stage */
  --bottomH: clamp(220px, 34svh, 380px);
  --heroW: clamp(260px, 78vw, 520px);

  /* ✅ Button */
  --btnW: clamp(240px, 78vw, 420px);
  --btnY: clamp(56px, 8.5svh, 92px);

  --softShadow: 0 16px 26px rgba(0,0,0,.44);

  /* ✅ CONTROL GELAP BAWAH */
  --groundFade: .98;

  /* ✅ HERO FOOT FADE */
  --heroFadeStart: 10%;
  --heroFadeMid: 56%;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
html{
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
  background: #0b0014;
}

/* ============================================================
   ✅ BACKGROUND UTAMA
   - bawah purple premium tetap
   - atas dibuat lebih dark depth via overlay (body::before)
   ============================================================ */
body{
  margin:0;
  display:grid;
  place-items:center;
  overflow:hidden;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--text);

  background:
    /* ✅ TOP glow (lebih soft biar tidak terlalu terang) */
    radial-gradient(1200px 860px at 50% 0%,
      rgba(255,211,109,.14) 0%,
      rgba(176,76,255,.10) 40%,
      rgba(0,0,0,0) 74%
    ),

    /* ✅ TOP highlight putih dikurangin */
    radial-gradient(900px 540px at 50% -8%,
      rgba(255,255,255,.06) 0%,
      rgba(0,0,0,0) 62%
    ),

    /* ✅ violet bloom */
    radial-gradient(980px 680px at 50% 22%,
      rgba(176,76,255,.20) 0%,
      rgba(0,0,0,0) 66%
    ),

    /* ✅ mid aura ungu */
    radial-gradient(980px 720px at 50% 58%,
      rgba(176,76,255,.16),
      rgba(0,0,0,0) 66%
    ),

    /* ✅ BOTTOM: purple dark premium (tetap dipertahankan) */
    radial-gradient(170% 125% at 50% 128%,
      rgba(32,0,72,.98) 0%,
      rgba(43,15,90,.90) 28%,
      rgba(0,0,0,.14) 56%,
      rgba(0,0,0,0) 76%
    ),

    /* ✅ base */
    linear-gradient(180deg,
      #2d1147 0%,
      #19082f 52%,
      #05000f 100%
    );

  overscroll-behavior: none;
  -webkit-tap-highlight-color: transparent;
  user-select:none;

  position:relative;
  isolation:isolate;
}

/* ============================================================
   ✅ TOP DARK DEPTH PURPLE (SAMPAI TENGAH SAJA)
   - ini yang bikin atas lebih cinematic
   - stop halus di tengah (mask presisi)
   ============================================================ */
body::before{
  content:"";
  position:fixed;
  inset:-40px;
  pointer-events:none;
  z-index:0;

  background:
    /* ✅ dark dome top */
    radial-gradient(1200px 860px at 50% -10%,
      rgba(0,0,0,.72) 0%,
      rgba(18,0,40,.60) 32%,
      rgba(74,24,128,.18) 56%,
      rgba(0,0,0,0) 78%
    ),

    /* ✅ depth ke tengah biar smooth */
    radial-gradient(1100px 820px at 50% 42%,
      rgba(10,0,26,.46) 0%,
      rgba(0,0,0,0) 72%
    ),

    /* ✅ noise halus */
    repeating-linear-gradient(0deg,
      rgba(255,255,255,.010),
      rgba(255,255,255,.010) 1px,
      rgba(0,0,0,0) 2px,
      rgba(0,0,0,0) 6px
    );

  opacity:.999;

  /* ✅ penting: gelap hanya sampai tengah */
  -webkit-mask-image: linear-gradient(to bottom,
    rgba(0,0,0,1) 0%,
    rgba(0,0,0,1) 52%,
    rgba(0,0,0,0) 70%,
    rgba(0,0,0,0) 100%
  );
  mask-image: linear-gradient(to bottom,
    rgba(0,0,0,1) 0%,
    rgba(0,0,0,1) 52%,
    rgba(0,0,0,0) 70%,
    rgba(0,0,0,0) 100%
  );
}

/* ✅ game scene stripes drift */
body::after{
  content:"";
  position:fixed;
  inset:-40px;
  pointer-events:none;
  z-index:0;

  background:
    repeating-linear-gradient(135deg,
      rgba(255,255,255,.028) 0px,
      rgba(255,255,255,.028) 1px,
      rgba(0,0,0,0) 12px,
      rgba(0,0,0,0) 30px
    );

  opacity:.10;
  filter: blur(0.35px);
  transform: translate3d(0,0,0);
  animation: sceneDrift 12s linear infinite;
}

@keyframes sceneDrift{
  0%   { transform: translate3d(-14px, 0, 0); }
  100% { transform: translate3d(14px, 0, 0); }
}

@media (prefers-reduced-motion: reduce){
  body::after{ animation:none; }
}

/* ✅ Stage */
.stage{
  width: min(var(--stageMax), 94vw);
  min-height: 100dvh;
  height: 100dvh;

  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;

  position:relative;
  padding: calc(16px + var(--safeT)) 14px 0;
  gap: clamp(8px, 1.6svh, 14px);

  z-index:1;
  isolation:isolate;
}

/* ✅ Top headline */
.topText{
  width:100%;
  text-align:center;
  position:relative;
  z-index: 3;
  padding-top: 2px;
}

.topText::after{
  content:"";
  display:block;
  width:100%;
  height:2px;
  margin:10px auto 0;
  background: linear-gradient(90deg,
    transparent,
    rgba(255,255,255,.08),
    rgba(176,76,255,.18),
    rgba(255,211,109,.14),
    rgba(255,255,255,.08),
    transparent
  );
  opacity:.78;
  border-radius:99px;
}

.title{
  font-weight:950;
  letter-spacing:1.2px;
  color:#fff;
  font-size: clamp(22px, 3.6vw, 32px);
  line-height:1.05;
  text-transform:uppercase;
  text-shadow:
    0 10px 20px rgba(0,0,0,.55),
    0 0 18px rgba(176,76,255,.22);
}

.subtitle{
  margin-top:4px;
  font-weight:950;
  letter-spacing:1.55px;
  font-size: clamp(10px, 1.7vw, 13px);
  text-transform:uppercase;
  color: #3aff64;
  text-shadow:
    0 10px 18px rgba(0,0,0,.55),
    0 0 18px rgba(57,255,92,.28);
}

/* ✅ Wheel Area */
.wheelArea{
  width:100%;
  display:grid;
  place-items:center;
  position:relative;
  flex: 1 1 auto;
  min-height: calc(var(--wheelSize) * 0.72);
  padding: 0;
  z-index: 2;
}

.wheelArea::before{
  content:"";
  position:absolute;
  width:min(560px, 128%);
  aspect-ratio:1;
  border-radius:50%;
  background:
    radial-gradient(circle at 50% 45%,
      rgba(255,211,109,.14),
      rgba(176,76,255,.22) 42%,
      rgba(0,0,0,0) 74%
    );
  filter: blur(14px);
  opacity:.62;
  pointer-events:none;
}

/* ✅ Wheel naik ke atas disini */
.wrap{
  width: min(var(--wheelSize), 96%);
  aspect-ratio: 1 / 1;
  display:grid;
  place-items:center;
  position:relative;
  transform: translateY(var(--wheelLift)) translateZ(0);
  will-change: transform;
}

/* ✅ Bottom Stage */
.bottomStage{
  width:100%;
  height: var(--bottomH);
  position:relative;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding-bottom: max(10px, var(--safeB));
  z-index: 5;
  isolation:isolate;
}

/* ✅ OVERLAY UTAMA BAWAH (PURPLE DARK) */
.bottomStage::before{
  content:"";
  position:absolute;
  inset: -40px -26px calc(-110px - var(--safeB)) -26px;
  pointer-events:none;
  z-index:2;

  background:
    radial-gradient(190% 150% at 50% 132%,
      rgba(26,0,60,1) 0%,
      rgba(32,0,72,.96) 34%,
      rgba(0,0,0,.22) 60%,
      rgba(0,0,0,0) 82%
    ),
    linear-gradient(180deg,
      rgba(0,0,0,0) 0%,
      rgba(72,24,118,.16) 34%,
      rgba(20,0,44,.92) 76%,
      rgba(7,0,16,1) 100%
    );

  opacity: var(--groundFade);
  filter: blur(.12px);
}

/* ✅ FLOOR FOG EXTRA (nutup kaki pasti aman) */
.bottomStage::after{
  content:"";
  position:absolute;
  left:-26px;
  right:-26px;
  bottom: calc(-80px - var(--safeB));
  height: clamp(210px, 28svh, 320px);
  pointer-events:none;
  z-index:3;

  background:
    radial-gradient(120% 110% at 50% 90%,
      rgba(44,14,92,.92) 0%,
      rgba(24,0,58,.82) 30%,
      rgba(0,0,0,0) 68%
    ),
    linear-gradient(to top,
      rgba(18,0,40,.96) 0%,
      rgba(18,0,40,.70) 30%,
      rgba(0,0,0,0) 70%
    );

  opacity: .92;
  filter: blur(0.35px);
}

/* ✅ Hero image */
.heroWrap{
  position:absolute;
  left:50%;
  bottom: -105%;
  transform: translateX(-50%);
  width: var(--heroW);
  pointer-events:none;
  z-index: 1;

  filter:
    drop-shadow(0 16px 22px rgba(0,0,0,.52))
    drop-shadow(0 0 18px rgba(176,76,255,.12));

  will-change: transform;
  animation: heroFloat 3.2s ease-in-out infinite;

  -webkit-mask-image: linear-gradient(to top,
    rgba(0,0,0,0) var(--heroFadeStart),
    rgba(0,0,0,1) var(--heroFadeMid),
    rgba(0,0,0,1) 100%
  );
  mask-image: linear-gradient(to top,
    rgba(0,0,0,0) var(--heroFadeStart),
    rgba(0,0,0,1) var(--heroFadeMid),
    rgba(0,0,0,1) 100%
  );
}

.heroWrap img{
  width:100%;
  height:auto;
  display:block;
  transform: translateZ(0);
}

@keyframes heroFloat{
  0%   { transform: translateX(-50%) translateY(0px); }
  50%  { transform: translateX(-50%) translateY(-6px); }
  100% { transform: translateX(-50%) translateY(0px); }
}

@media (prefers-reduced-motion: reduce){
  .heroWrap{ animation:none; }
}

/* ✅ Spin Button */
.spinBtn{
  position:absolute;
  left:50%;
  bottom: calc(var(--btnY) + var(--safeB));
  transform: translateX(-50%);
  width: var(--btnW);
  height: clamp(46px, 7svh, 60px);

  border-radius: 999px;
  border: 3px solid rgba(255,155,0,.95);

  box-shadow:
    0 18px 30px rgba(0,0,0,.56),
    0 0 0 1px rgba(90,40,0,.40),
    inset 0 1px 0 rgba(255,255,255,.28),
    inset 0 -14px 18px rgba(0,0,0,.22);

  background:
    radial-gradient(130% 160% at 50% 0%,
      rgba(255,255,255,.32),
      rgba(255,255,255,0) 58%),
    linear-gradient(180deg,
      #49ff6b 0%,
      #25e351 44%,
      #14c93c 72%,
      #0fa62f 100%
    );

  color: rgba(10,35,12,.96);
  font-weight: 950;
  letter-spacing: 1.1px;
  text-transform: uppercase;
  font-size: clamp(14px, 2.8vw, 18px);

  text-shadow:
    0 1px 0 rgba(255,255,255,.30),
    0 3px 10px rgba(0,0,0,.18);

  cursor:pointer;
  overflow:hidden;

  transition: transform .12s ease, filter .18s ease, opacity .18s ease;
  touch-action: manipulation;
  -webkit-font-smoothing: antialiased;
  will-change: transform;
  z-index: 6;
}

.spinBtn::after{
  content:"";
  position:absolute;
  left:12px;
  right:12px;
  bottom:7px;
  height: 10px;
  border-radius: 999px;

  background:
    linear-gradient(180deg,
      rgba(0,0,0,.28),
      rgba(0,0,0,0)
    );

  opacity:.55;
  pointer-events:none;
}

.spinBtn::before{
  content:"";
  position:absolute;
  inset:-60% -40%;
  background: linear-gradient(90deg,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,.30) 26%,
    rgba(255,255,255,0) 52%,
    rgba(255,255,255,0) 100%
  );
  transform: rotate(10deg) translateX(-86%);
  opacity:.45;
  pointer-events:none;
  animation: btnShimmer 2.2s ease-in-out infinite;
}

@keyframes btnShimmer{
  0%   { transform: rotate(10deg) translateX(-92%); }
  55%  { transform: rotate(10deg) translateX(92%); }
  100% { transform: rotate(10deg) translateX(92%); }
}

.spinBtn:hover{ filter: brightness(1.03) saturate(1.06); }
.spinBtn:active{
  transform: translateX(-50%) scale(.985);
  filter: brightness(.98) saturate(1.0);
}

.spinBtn.is-disabled{
  opacity:.55;
  cursor:not-allowed;
  filter: grayscale(.10);
}
.spinBtn.is-disabled::before{
  animation:none;
  opacity:.18;
}

/* ✅ Tries */
.tries{
  position:absolute;
  left:50%;
  bottom: max(8px, var(--safeB));
  transform: translateX(-50%);
  width: min(520px, 92vw);
  text-align:center;

  font-size: clamp(11px, 2.8vw, 14px);
  letter-spacing: 1.2px;
  font-weight: 900;
  text-transform:uppercase;
  color: rgba(255,255,255,.88);

  text-shadow:
    0 10px 18px rgba(0,0,0,.55),
    0 0 14px rgba(176,76,255,.20);

  opacity:.92;
  z-index: 7;
}

.tries .triesNum{
  color:#39ff5c;
  text-shadow:
    0 0 12px rgba(57,255,92,.36),
    0 10px 18px rgba(0,0,0,.55);
}

/* ✅ Mobile tweak */
@media (max-width: 420px){
  :root{
    --wheelLift: clamp(-44px, -4.2svh, -16px);
    --btnW: clamp(235px, 78vw, 410px);
  }
}

/* ✅ Short height safety */
@media (max-height: 680px){
  :root{
    --bottomH: clamp(200px, 30svh, 320px);
    --btnY: clamp(46px, 7svh, 72px);
    --heroW: clamp(210px, 70vw, 380px);
    --wheelLift: clamp(-40px, -4svh, -14px);
  }
  .stage{ gap: 10px; }
}

@media (prefers-reduced-motion: reduce){
  .spinBtn::before{ animation:none; }
}
</style>

<body>
  <main class="stage">
    <header class="topText" aria-label="Wheel header">
      <div class="title">SPIN THE WHEEL</div>
      <div class="subtitle">AND GET BONUSES!</div>
    </header>

    <section class="wheelArea" aria-label="Wheel area">
      <div class="wrap" id="mount"></div>
    </section>

    <footer class="bottomStage" aria-label="Spin area">
      <div class="heroWrap" aria-hidden="true">
        <img src="https://img.sanishtech.com/u/a5be0d7ca0b31c6e514b93c77add83dd.png" alt="" />
      </div>

      <button class="spinBtn" id="spinBtn" type="button" aria-label="Spin the wheel button">
        SPIN THE WHEEL
      </button>

      <div class="tries" id="triesText">
        YOU HAVE <span class="triesNum">1</span> TRIES!
      </div>
    </footer>
  </main>
</body>

  <script>
    (() => {
      const mount = document.getElementById("mount");
      if (!mount) return;

      // ================================
      // DATA
      // ================================
      const segments = [
        { main: "25K",   sub: "PRIZE", type: "spins",   value: 150 }, // TOP
        { main: "50K",   sub: "PRIZE", type: "spins",   value: 100 },
        { main: "75K",   sub: "PRIZE", type: "deposit", value: 100 },
        { main: "100K",  sub: "PRIZE", type: "deposit", value: 150 },
        { main: "150K",  sub: "PRIZE", type: "nowin",   value: 0   },
        { main: "200K",  sub: "PRIZE", type: "deposit", value: 375 },
        { main: "BONUS", sub: "PRIZE", type: "spins",   value: 50  },
        { main: "BONUS", sub: "PRIZE", type: "nowin",   value: 0   },
      ];

      const SEG = segments.length;
      const DEG = 360 / SEG;

      // ================================
      // UTILS
      // ================================
      const prefersReduceMotion = () =>
        !!(window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches);

      function polarToCartesian(cx, cy, r, angleDeg) {
        const rad = (angleDeg - 90) * Math.PI / 180;
        return { x: cx + (r * Math.cos(rad)), y: cy + (r * Math.sin(rad)) };
      }

      function createSVG(tag, attrs = {}) {
        const el = document.createElementNS("http://www.w3.org/2000/svg", tag);
        for (const k in attrs) el.setAttribute(k, attrs[k]);
        return el;
      }

      function radToDeg(x){ return x * 180 / Math.PI; }

      function arcPath(cx, cy, r, startDeg, endDeg){
        const s = polarToCartesian(cx, cy, r, startDeg);
        const e = polarToCartesian(cx, cy, r, endDeg);
        const largeArc = Math.abs(endDeg - startDeg) > 180 ? 1 : 0;
        const sweep = 1;
        return `M ${s.x} ${s.y} A ${r} ${r} 0 ${largeArc} ${sweep} ${e.x} ${e.y}`;
      }

      // ✅ capsule wedge (rounded outer + rounded inner edge)
      function capsuleWedgePathV2(cx, cy, rOuter, rInner, startDeg, endDeg, opts={}){
        const padDeg   = opts.padDeg ?? 1.65;
        const rcOuter  = opts.rcOuter ?? 36;
        const bulge    = opts.bulge ?? 20;
        const shoulder = opts.shoulder ?? 26;
        const capInset = opts.capInset ?? 3.2;

        const s = startDeg + padDeg;
        const e = endDeg   - padDeg;

        const dO = radToDeg(rcOuter / rOuter);

        const A1 = polarToCartesian(cx, cy, rOuter, s + dO);
        const B1 = polarToCartesian(cx, cy, rOuter, e - dO);
        const A2 = polarToCartesian(cx, cy, rOuter - rcOuter, s);
        const B2 = polarToCartesian(cx, cy, rOuter - rcOuter, e);

        const E1 = polarToCartesian(cx, cy, rInner + shoulder, e);
        const S1 = polarToCartesian(cx, cy, rInner + shoulder, s);

        const E2 = polarToCartesian(cx, cy, rInner, e - capInset);
        const S2 = polarToCartesian(cx, cy, rInner, s + capInset);

        const m = (s + e) / 2;
        const ctrl = polarToCartesian(cx, cy, Math.max(10, rInner - bulge), m);

        const CE = polarToCartesian(cx, cy, rInner, e - capInset * 0.00);
        const CS = polarToCartesian(cx, cy, rInner, s + capInset * 0.00);

        return `
          M ${A1.x} ${A1.y}
          A ${rOuter} ${rOuter} 0 0 1 ${B1.x} ${B1.y}
          A ${rcOuter} ${rcOuter} 0 0 1 ${B2.x} ${B2.y}

          L ${E1.x} ${E1.y}
          Q ${CE.x} ${CE.y} ${E2.x} ${E2.y}

          Q ${ctrl.x} ${ctrl.y} ${S2.x} ${S2.y}

          Q ${CS.x} ${CS.y} ${S1.x} ${S1.y}
          L ${A2.x} ${A2.y}

          A ${rcOuter} ${rcOuter} 0 0 1 ${A1.x} ${A1.y}
          Z
        `;
      }

      // ================================
      // BUILD SVG
      // ================================
      function buildWheelSVG(){
        const svg = createSVG("svg", {
          id:"wheelSvg",
          viewBox:"0 0 1000 1000",
          fill:"none",
          xmlns:"http://www.w3.org/2000/svg"
        });

        const defs = createSVG("defs");
        defs.innerHTML = `
          <!-- GOLD -->
          <linearGradient id="goldRing" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0" stop-color="#FFD36D"/>
            <stop offset="0.55" stop-color="#FFB300"/>
            <stop offset="1" stop-color="#D98B00"/>
          </linearGradient>

          <radialGradient id="goldGlow" cx="50%" cy="35%" r="70%">
            <stop offset="0" stop-color="#FFF2B0" stop-opacity="1"/>
            <stop offset="0.38" stop-color="#FFD36D" stop-opacity=".92"/>
            <stop offset="1" stop-color="#B96200" stop-opacity="1"/>
          </radialGradient>

          <linearGradient id="segLight" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#8C5BE2"/>
            <stop offset="1" stop-color="#6E3FD3"/>
          </linearGradient>

          <linearGradient id="segDark" x1="1" y1="0" x2="0" y2="1">
            <stop offset="0" stop-color="#45207B"/>
            <stop offset="1" stop-color="#2B114F"/>
          </linearGradient>

          <radialGradient id="segSoft" cx="40%" cy="22%" r="95%">
            <stop offset="0" stop-color="#FFFFFF" stop-opacity=".10"/>
            <stop offset="0.6" stop-color="#000000" stop-opacity="0"/>
            <stop offset="1" stop-color="#000000" stop-opacity=".22"/>
          </radialGradient>

          <radialGradient id="spinGreen" cx="50%" cy="35%" r="70%">
            <stop offset="0" stop-color="#7CFF7E"/>
            <stop offset="0.45" stop-color="#35FF3B"/>
            <stop offset="1" stop-color="#10C52E"/>
          </radialGradient>

          <filter id="wheelShadow" x="-30%" y="-30%" width="160%" height="160%">
            <feDropShadow dx="0" dy="18" stdDeviation="14" flood-color="#000" flood-opacity=".55"/>
          </filter>

          <filter id="segDepth" x="-30%" y="-30%" width="160%" height="160%">
            <feDropShadow dx="0" dy="7" stdDeviation="7" flood-color="#000" flood-opacity=".26"/>
          </filter>

          <!-- ✅ TOP HIGHLIGHT GOLD -->
          <radialGradient id="hlFillGold" cx="50%" cy="32%" r="75%">
            <stop offset="0" stop-color="#FFF6C9" stop-opacity="0.52"/>
            <stop offset="0.38" stop-color="#FFD36D" stop-opacity="0.24"/>
            <stop offset="1" stop-color="#FFB300" stop-opacity="0"/>
          </radialGradient>

          <linearGradient id="hlRimGold" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0" stop-color="#FFF2B0"/>
            <stop offset="0.55" stop-color="#FFD36D"/>
            <stop offset="1" stop-color="#FFB300"/>
          </linearGradient>

          <filter id="hlGlowSoft" x="-70%" y="-70%" width="240%" height="240%">
            <feDropShadow dx="0" dy="0" stdDeviation="10" flood-color="#FFD36D" flood-opacity=".55"/>
            <feDropShadow dx="0" dy="7" stdDeviation="12" flood-color="#FFB300" flood-opacity=".30"/>
          </filter>

          <!-- ✅ POINTER GOLD PREMIUM -->
          <filter id="pointerGoldFx" x="-120%" y="-120%" width="340%" height="340%">
            <feDropShadow dx="0" dy="0" stdDeviation="6.5" flood-color="#FFD36D" flood-opacity=".32"/>
            <feDropShadow dx="0" dy="2" stdDeviation="5.5" flood-color="#FFB300" flood-opacity=".22"/>
            <feDropShadow dx="0" dy="6" stdDeviation="6.5" flood-color="#000000" flood-opacity=".35"/>
          </filter>

          <!-- ✅ GEM KIT -->
          <linearGradient id="gemGoldBezel" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0" stop-color="#FFF2B0"/>
            <stop offset="0.35" stop-color="#FFD36D"/>
            <stop offset="0.7" stop-color="#FFB300"/>
            <stop offset="1" stop-color="#B86200"/>
          </linearGradient>

          <radialGradient id="gemGoldHot" cx="35%" cy="25%" r="75%">
            <stop offset="0" stop-color="#FFFFFF" stop-opacity=".52"/>
            <stop offset="0.35" stop-color="#FFD36D" stop-opacity=".30"/>
            <stop offset="1" stop-color="#FFB300" stop-opacity="0"/>
          </radialGradient>

          <radialGradient id="gemPurplePro" cx="38%" cy="28%" r="75%">
            <stop offset="0" stop-color="#FFD6FF" stop-opacity=".98"/>
            <stop offset="0.38" stop-color="#B04CFF" stop-opacity=".95"/>
            <stop offset="0.78" stop-color="#6B1FDB" stop-opacity=".98"/>
            <stop offset="1" stop-color="#2A003F" stop-opacity="1"/>
          </radialGradient>

          <radialGradient id="gemGlassSpec" cx="28%" cy="18%" r="60%">
            <stop offset="0" stop-color="#FFFFFF" stop-opacity=".70"/>
            <stop offset="0.35" stop-color="#FFFFFF" stop-opacity=".24"/>
            <stop offset="1" stop-color="#FFFFFF" stop-opacity="0"/>
          </radialGradient>

          <radialGradient id="gemRareAura" cx="50%" cy="40%" r="75%">
            <stop offset="0" stop-color="#FFF6C9" stop-opacity=".46"/>
            <stop offset="0.32" stop-color="#FFD36D" stop-opacity=".22"/>
            <stop offset="0.62" stop-color="#B04CFF" stop-opacity=".14"/>
            <stop offset="1" stop-color="#FFB300" stop-opacity="0"/>
          </radialGradient>

          <radialGradient id="gemOrangePro" cx="35%" cy="30%" r="75%">
            <stop offset="0" stop-color="#FFE7B5" stop-opacity=".95"/>
            <stop offset="0.35" stop-color="#FFB44A" stop-opacity=".98"/>
            <stop offset="0.78" stop-color="#FF7A00" stop-opacity=".98"/>
            <stop offset="1" stop-color="#8A2A00" stop-opacity="1"/>
          </radialGradient>

          <filter id="gemFx" x="-90%" y="-90%" width="280%" height="280%">
            <feDropShadow dx="0" dy="3" stdDeviation="3.5" flood-color="#000" flood-opacity=".38"/>
            <feDropShadow dx="0" dy="0" stdDeviation="5.6" flood-color="#FFD36D" flood-opacity=".18"/>
          </filter>

          <filter id="gemTopFx" x="-120%" y="-120%" width="340%" height="340%">
            <feDropShadow dx="0" dy="4" stdDeviation="4.0" flood-color="#000" flood-opacity=".40"/>
            <feDropShadow dx="0" dy="0" stdDeviation="7.2" flood-color="#FFD36D" flood-opacity=".22"/>
            <feDropShadow dx="0" dy="0" stdDeviation="5.2" flood-color="#B04CFF" flood-opacity=".14"/>
          </filter>

          <filter id="gemOrbitFx" x="-160%" y="-160%" width="420%" height="420%">
            <feDropShadow dx="0" dy="0" stdDeviation="6.6" flood-color="#FFD36D" flood-opacity=".16"/>
            <feDropShadow dx="0" dy="0" stdDeviation="5.6" flood-color="#B04CFF" flood-opacity=".12"/>
          </filter>

          <!-- ✅ SPIN BLOOM -->
          <filter id="gemSpinBloomFx" x="-220%" y="-220%" width="540%" height="540%">
            <feGaussianBlur stdDeviation="7" result="b1"/>
            <feMerge>
              <feMergeNode in="b1"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>

          <!-- ICONS -->
          <g id="giftIcon" opacity=".10">
            <path d="M0 10c0-2.2 1.8-4 4-4h18c2.2 0 4 1.8 4 4v4H0v-4z" fill="#FFFFFF"/>
            <path d="M2 16h24v10c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V16z" fill="#FFFFFF"/>
            <path d="M13 6c-2.2 0-4-1.8-4-4 0-1.1.9-2 2-2 1.6 0 2.6 1.3 3.2 2.4C14.8 1.3 15.8 0 17.4 0c1.1 0 2 .9 2 2 0 2.2-1.8 4-4 4H13z" fill="#FFFFFF"/>
            <path d="M12.5 6h3v22h-3V6z" fill="#FFFFFF"/>
            <path d="M0 13h26v3H0v-3z" fill="#FFFFFF"/>
          </g>

          <path id="leaf" d="M0 0 C 18 8, 28 26, 14 44 C 6 54, -4 50, -6 40 C -10 22, -4 8, 0 0 Z" />
        `;
        svg.appendChild(defs);

        const cx = 500, cy = 500;
        const base = createSVG("g", { filter:"url(#wheelShadow)" });

        // ================================
        // ✅ OUTER GOLD RING + POINTER
        // ================================
        const ringOuter = createSVG("g", {
          id: "goldOuterRings",
          filter: "url(#hlGlowSoft)"
        });

        ringOuter.appendChild(createSVG("circle", {
          cx, cy, r:"432",
          fill:"none",
          stroke:"url(#hlRimGold)",
          "stroke-width":"22",
          opacity:"0.98"
        }));
        ringOuter.appendChild(createSVG("circle", {
          cx, cy, r:"432",
          fill:"none",
          stroke:"rgba(255,255,255,.22)",
          "stroke-width":"6",
          opacity:"0.92"
        }));
        ringOuter.appendChild(createSVG("circle", {
          cx, cy, r:"418",
          fill:"none",
          stroke:"url(#hlRimGold)",
          "stroke-width":"10",
          opacity:"0.98"
        }));
        ringOuter.appendChild(createSVG("circle", {
          cx, cy, r:"418",
          fill:"none",
          stroke:"rgba(255,255,255,.16)",
          "stroke-width":"4",
          opacity:"0.92"
        }));

        const pointer = createSVG("g", {
          id:"pointerArc",
          filter:"url(#pointerGoldFx)"
        });

        const POINTER_A = 10.6;
        const arcOuter = arcPath(cx, cy, 432, -POINTER_A, POINTER_A);
        const arcInner = arcPath(cx, cy, 418, -POINTER_A, POINTER_A);

        pointer.appendChild(createSVG("path", {
          d: arcOuter,
          fill:"none",
          stroke:"url(#hlRimGold)",
          "stroke-width":"24",
          "stroke-linecap":"round",
          opacity:"0.995"
        }));

        pointer.appendChild(createSVG("path", {
          d: arcOuter,
          fill:"none",
          stroke:"rgba(255,255,255,.20)",
          "stroke-width":"5.2",
          "stroke-linecap":"round",
          opacity:"0.92"
        }));

        pointer.appendChild(createSVG("path", {
          d: arcOuter,
          fill:"none",
          stroke:"rgba(255,242,176,.22)",
          "stroke-width":"2.2",
          "stroke-linecap":"round",
          opacity:"0.85"
        }));

        pointer.appendChild(createSVG("path", {
          d: arcInner,
          fill:"none",
          stroke:"rgba(0,0,0,.18)",
          "stroke-width":"7",
          "stroke-linecap":"round",
          opacity:"0.50"
        }));

        ringOuter.appendChild(pointer);
        base.appendChild(ringOuter);

        // ================================
        // INNER BASE
        // ================================
        base.appendChild(createSVG("circle", {
          cx, cy, r:"400",
          fill:"rgba(40,14,60,.92)"
        }));
        base.appendChild(createSVG("circle", {
          cx, cy, r:"392",
          fill:"rgba(55,18,92,.55)"
        }));

        // ================================
        // ROT GROUP
        // ================================
        const rot = createSVG("g", { id:"wheelRot" });

        const rOuter = 380;
        const rInner = 130;

        for(let i=0;i<SEG;i++){
          const start = (i * DEG) - (DEG/2);
          const end   = start + DEG;

          const segD = capsuleWedgePathV2(cx, cy, rOuter, rInner, start, end, {
            padDeg: 1.65,
            rcOuter: 36,
            bulge: 20,
            shoulder: 26,
            capInset: 3.2
          });

          const seg = createSVG("path", {
            d: segD,
            fill: (i%2===0) ? "url(#segLight)" : "url(#segDark)",
            filter:"url(#segDepth)"
          });
          rot.appendChild(seg);

          const soft = createSVG("path", {
            d: segD,
            fill:"url(#segSoft)",
            opacity:"0.92"
          });
          rot.appendChild(soft);

          // icon
          const mid = i * DEG;
          const iconPos = polarToCartesian(cx, cy, 255, mid);
          const gIcon = createSVG("g", {
            transform:`translate(${iconPos.x-13},${iconPos.y-13}) scale(1.0)`
          });
          gIcon.appendChild(createSVG("use", { href:"#giftIcon" }));
          rot.appendChild(gIcon);

          // text group
          const tpos = polarToCartesian(cx, cy, 312, mid);
          const tg = createSVG("g", {
            transform:`translate(${tpos.x},${tpos.y}) rotate(${mid})`
          });

          const main = createSVG("text", {
            x:"0", y:"0",
            "text-anchor":"middle",
            "dominant-baseline":"middle",
            fill:"#FFCF52",
            "font-weight":"950",
            "font-size":"42",
            "letter-spacing":"0.8"
          });
          main.textContent = segments[i].main;
          tg.appendChild(main);

          const sub = createSVG("text", {
            x:"0", y:"34",
            "text-anchor":"middle",
            "dominant-baseline":"middle",
            fill:"#FFFFFF",
            opacity:"0.88",
            "font-weight":"900",
            "font-size":"14",
            "letter-spacing":"1.6"
          });
          sub.textContent = segments[i].sub;
          tg.appendChild(sub);

          rot.appendChild(tg);
        }

        base.appendChild(rot);

        // ================================
        // ✅ TOP HIGHLIGHT (GOLD)
        // ================================
        const highlight = createSVG("g", { id:"topHighlight" });

        const selStart = -DEG/2;
        const selEnd   =  DEG/2;

        const hlD = capsuleWedgePathV2(cx, cy, rOuter, rInner, selStart, selEnd, {
          padDeg: 1.65,
          rcOuter: 36,
          bulge: 20,
          shoulder: 30,
          capInset: 3.2
        });

        highlight.appendChild(createSVG("path", {
          d: hlD,
          fill: "url(#hlFillGold)",
          opacity: "0.20"
        }));

        const rim = createSVG("g", { filter: "url(#hlGlowSoft)" });

        rim.appendChild(createSVG("path", {
          d: hlD,
          fill: "none",
          stroke: "url(#hlRimGold)",
          "stroke-width": "18",
          "stroke-linejoin": "round",
          "stroke-linecap": "round",
          opacity: "0.95"
        }));

        rim.appendChild(createSVG("path", {
          d: hlD,
          fill: "none",
          stroke: "rgba(255,255,255,.22)",
          "stroke-width": "6",
          "stroke-linejoin": "round",
          "stroke-linecap": "round",
          opacity: "0.95"
        }));

        highlight.appendChild(rim);
        base.appendChild(highlight);

        // ================================
        // ✅ GEM MARKERS
        // ================================
        const gemLayer = createSVG("g", { id:"gemLayer", style:"pointer-events:none" });
        base.appendChild(gemLayer);

        function addGem(angleDeg, kind="normal"){
          const isTop = (kind === "top");

          const baseRadius = isTop ? 412 : 426;
          const p0 = polarToCartesian(cx, cy, baseRadius, angleDeg);

          const vx = p0.x - cx;
          const vy = p0.y - cy;
          const len = Math.hypot(vx, vy) || 1;
          const inset = 9.9;
          const px = p0.x - (vx / len) * inset;
          const py = p0.y - (vy / len) * inset;

          const g = createSVG("g", {
            transform:`translate(${px},${py})`,
            filter: isTop ? "url(#gemTopFx)" : "url(#gemFx)"
          });

          if(isTop) g.setAttribute("data-role","topGemRoot");

          if(isTop){
            const TOP_SCALE = 1.12;
            const R  = 25;
            const rG = 18.2;

            const clipId = "topGemAuraClip";
            if(!defs.querySelector("#"+clipId)){
              const cp = createSVG("clipPath", { id: clipId });
              cp.appendChild(createSVG("circle", { cx: px.toString(), cy: py.toString(), r:"110" }));
              defs.appendChild(cp);
            }

            const auraWrap = createSVG("g", { "clip-path":`url(#${clipId})` });
            auraWrap.setAttribute("data-role","auraWrap");
            g.appendChild(auraWrap);

            const aura1 = createSVG("circle", {
              cx:"0", cy:"0",
              r:(R + 18).toString(),
              fill:"url(#gemRareAura)",
              opacity:"0.62"
            });
            aura1.setAttribute("data-role","aura1");
            auraWrap.appendChild(aura1);

            const aura2 = createSVG("circle", {
              cx:"0", cy:"0",
              r:(R + 28).toString(),
              fill:"url(#gemRareAura)",
              opacity:"0.22"
            });
            aura2.setAttribute("data-role","aura2");
            auraWrap.appendChild(aura2);

            const body = createSVG("g", { transform:`scale(${TOP_SCALE})` });
            body.setAttribute("data-role","body");
            g.appendChild(body);

            const socket = createSVG("g", { opacity:"0.98" });
            socket.appendChild(createSVG("ellipse", {
              cx:"0", cy:"14.2",
              rx:"35.0", ry:"16.0",
              fill:"rgba(0,0,0,.18)",
              opacity:"0.58"
            }));
            socket.appendChild(createSVG("ellipse", {
              cx:"0", cy:"13.0",
              rx:"33.4", ry:"15.1",
              fill:"url(#gemGoldBezel)",
              opacity:"0.92"
            }));
            socket.appendChild(createSVG("ellipse", {
              cx:"0", cy:"11.2",
              rx:"28.4", ry:"12.4",
              fill:"rgba(255,255,255,.10)",
              opacity:"0.82"
            }));
            body.appendChild(socket);

            const orbY = 3.2;
            const orbX = 24.0;
            const orbR = 6.2;

            function orangeOrb(x){
              const og = createSVG("g", {});
              og.appendChild(createSVG("circle", {
                cx: x.toString(), cy: orbY.toString(), r: orbR.toString(),
                fill:"url(#gemOrangePro)",
                opacity:"0.98"
              }));
              og.appendChild(createSVG("circle", {
                cx: (x-1.55).toString(), cy: (orbY-1.85).toString(), r: "1.55",
                fill:"rgba(255,255,255,.70)",
                opacity:"0.94"
              }));
              og.appendChild(createSVG("circle", {
                cx: (x+1.35).toString(), cy: (orbY+1.35).toString(), r: "1.05",
                fill:"rgba(0,0,0,.16)",
                opacity:"0.50"
              }));
              return og;
            }
            body.appendChild(orangeOrb(-orbX));
            body.appendChild(orangeOrb( orbX));

            body.appendChild(createSVG("circle", {
              cx:"0", cy:"0", r:R.toString(),
              fill:"url(#gemGoldBezel)",
              opacity:"0.98"
            }));

            body.appendChild(createSVG("circle", {
              cx:"0", cy:"-0.75", r:(R-1.55).toString(),
              fill:"none",
              stroke:"rgba(255,255,255,.22)",
              "stroke-width":"3.0",
              opacity:"0.90"
            }));

            body.appendChild(createSVG("circle", {
              cx:"0", cy:"1.10", r:(R-1.55).toString(),
              fill:"none",
              stroke:"rgba(120,40,0,.18)",
              "stroke-width":"3.0",
              opacity:"0.56"
            }));

            body.appendChild(createSVG("circle", {
              cx:"0", cy:"0", r:(R-1.15).toString(),
              fill:"url(#gemGoldHot)",
              opacity:"0.64"
            }));

            body.appendChild(createSVG("circle", {
              cx:"0", cy:"1.0",
              r:(rG + 2.0).toString(),
              fill:"rgba(0,0,0,.22)",
              opacity:"0.66"
            }));

            const coreGlow = createSVG("circle", {
              cx:"0", cy:"0",
              r:(rG + 5.4).toString(),
              fill:"url(#gemRareAura)",
              opacity:"0.0",
              style:"mix-blend-mode:screen"
            });
            coreGlow.setAttribute("data-role","coreGlow");
            body.appendChild(coreGlow);

            const coreBloom = createSVG("circle", {
              cx:"0", cy:"0",
              r:(rG + 13.0).toString(),
              fill:"url(#gemRareAura)",
              opacity:"0.0",
              filter:"url(#gemSpinBloomFx)",
              style:"mix-blend-mode:screen"
            });
            coreBloom.setAttribute("data-role","coreBloom");
            body.appendChild(coreBloom);

            const core = createSVG("circle", {
              cx:"0", cy:"0", r:rG.toString(),
              fill:"url(#gemPurplePro)",
              opacity:"0.99"
            });
            core.setAttribute("data-role","core");
            body.appendChild(core);

            body.appendChild(createSVG("circle", {
              cx:"0", cy:"-0.65",
              r:(rG-0.9).toString(),
              fill:"none",
              stroke:"rgba(255,255,255,.18)",
              "stroke-width":"2.4",
              opacity:"0.90"
            }));

            body.appendChild(createSVG("ellipse", {
              cx:"-5.4", cy:"-6.2",
              rx:"8.0", ry:"6.2",
              fill:"url(#gemGlassSpec)",
              opacity:"0.90"
            }));

            body.appendChild(createSVG("circle", {
              cx:"-9.2", cy:"-7.9",
              r:"1.8",
              fill:"rgba(255,255,255,.84)",
              opacity:"0.92"
            }));

            const orbit = createSVG("circle", {
              cx:"0", cy:"0",
              r:(R + 15.4).toString(),
              fill:"none",
              stroke:"rgba(255,255,255,.16)",
              "stroke-width":"2.1",
              "stroke-dasharray":"3 8",
              "stroke-dashoffset":"0",
              opacity:"0.70",
              filter:"url(#gemOrbitFx)"
            });
            orbit.setAttribute("data-role","orbit");
            body.appendChild(orbit);

            const halo = createSVG("circle", {
              cx:"0", cy:"-25",
              r:"11.2",
              fill:"none",
              stroke:"url(#hlRimGold)",
              "stroke-width":"4.2",
              opacity:"0.92"
            });
            halo.setAttribute("data-role","halo");
            body.appendChild(halo);

            body.appendChild(createSVG("circle", {
              cx:"0", cy:"-25",
              r:"11.2",
              fill:"none",
              stroke:"rgba(255,255,255,.18)",
              "stroke-width":"1.9",
              opacity:"0.90"
            }));

            gemLayer.appendChild(g);
            return;
          }

          // normal gem
          const R  = 16;
          const rG = 12;

          g.appendChild(createSVG("circle", {
            cx:"0", cy:"2",
            r:(R + 1.6).toString(),
            fill:"rgba(0,0,0,.25)",
            opacity:"0.52"
          }));

          g.appendChild(createSVG("circle", {
            cx:"0", cy:"0",
            r:R.toString(),
            fill:"url(#gemGoldBezel)",
            opacity:"0.98"
          }));

          g.appendChild(createSVG("circle", {
            cx:"0", cy:"0",
            r:rG.toString(),
            fill:"url(#gemPurplePro)",
            opacity:"0.98"
          }));

          g.appendChild(createSVG("circle", {
            cx:"-4", cy:"-5",
            r:"3.1",
            fill:"rgba(255,255,255,.70)",
            opacity:"0.94"
          }));

          gemLayer.appendChild(g);
        }

        addGem(0,   "top");
        addGem(90,  "normal");
        addGem(180, "normal");
        addGem(270, "normal");

        // ================================
        // CENTER HUB (SPIN)
        // ================================
        const hub = createSVG("g", { class:"hit-spin", id:"spinCenter" });

        hub.appendChild(createSVG("circle", {
          cx, cy, r:"96",
          fill:"none",
          stroke:"url(#hlRimGold)",
          "stroke-width":"16",
          opacity:"0.98"
        }));

        hub.appendChild(createSVG("circle", {
          cx, cy, r:"96",
          fill:"none",
          stroke:"rgba(255,255,255,.20)",
          "stroke-width":"6",
          opacity:"0.92"
        }));

        const laurel = createSVG("g", { opacity:"0.95" });

        function laurelSide(dir=1){
          const g = createSVG("g", {
            transform:`translate(${cx + dir*68},${cy+6}) rotate(${dir*18}) scale(${dir*0.86},0.86)`
          });
          for(let k=0;k<5;k++){
            const leaf = createSVG("use", { href:"#leaf", fill:"url(#goldGlow)", opacity:"0.95" });
            leaf.setAttribute("transform", `translate(${k*10},${k*6}) rotate(${k*14}) scale(.50,.50)`);
            g.appendChild(leaf);
          }
          return g;
        }
        laurel.appendChild(laurelSide(-1));
        laurel.appendChild(laurelSide(1));
        hub.appendChild(laurel);

        hub.appendChild(createSVG("circle", {
          cx, cy, r:"72",
          fill:"url(#spinGreen)",
          stroke:"url(#hlRimGold)",
          "stroke-width":"10"
        }));

        hub.appendChild(createSVG("circle", {
          cx: cx-16, cy: cy-16, r:"16",
          fill:"rgba(255,255,255,.18)"
        }));

        const spinText = createSVG("text", {
          x: cx, y: cy+5,
          "text-anchor":"middle",
          "dominant-baseline":"middle",
          fill:"#0c3a16",
          "font-weight":"950",
          "font-size":"22",
          "letter-spacing":"2.2"
        });
        spinText.textContent = "SPIN";
        hub.appendChild(spinText);

        base.appendChild(hub);
        svg.appendChild(base);
        return svg;
      }

      // ================================
      // ✅ TOP GEM AMBIENT ANIM
      // ================================
      function initTopGemRareAnim(){
        const top = document.querySelector('#wheelSvg [data-role="topGemRoot"]');
        if(!top) return;

        const aura1 = top.querySelector('[data-role="aura1"]');
        const aura2 = top.querySelector('[data-role="aura2"]');
        const halo  = top.querySelector('[data-role="halo"]');
        const orbit = top.querySelector('[data-role="orbit"]');

        const stable = (el)=>{
          if(!el) return;
          gsap.set(el, { transformBox:"fill-box", transformOrigin:"50% 50%" });
        };
        [aura1,aura2,halo,orbit].forEach(stable);

        if(prefersReduceMotion()){
          if(aura1) gsap.set(aura1, { opacity: 0.62, scale: 1.05 });
          if(aura2) gsap.set(aura2, { opacity: 0.22, scale: 1.02 });
          if(halo)  gsap.set(halo,  { opacity: 0.92 });
          if(orbit) gsap.set(orbit, { opacity: 0.70 });
          return;
        }

        if(aura1){
          gsap.to(aura1, {
            scale: 1.12,
            opacity: 0.74,
            duration: 1.55,
            yoyo: true,
            repeat: -1,
            ease: "sine.inOut"
          });
        }

        if(aura2){
          gsap.to(aura2, {
            scale: 1.06,
            opacity: 0.30,
            duration: 1.85,
            yoyo: true,
            repeat: -1,
            ease: "sine.inOut"
          });
        }

        if(orbit){
          gsap.to(orbit, {
            attr: { "stroke-dashoffset": 220 },
            duration: 14,
            repeat: -1,
            ease: "none"
          });

          gsap.fromTo(orbit,
            { opacity: 0.55 },
            { opacity: 0.82, duration: 1.6, yoyo: true, repeat: -1, ease: "sine.inOut" }
          );
        }

        if(halo){
          gsap.fromTo(halo,
            { opacity: 0.70 },
            { opacity: 0.95, duration: 1.35, yoyo: true, repeat: -1, ease: "sine.inOut" }
          );
        }
      }

      // ================================
      // ✅ TOP GEM CORE BLINK (ONLY WHILE SPINNING)
      // ================================
      let _spinPulseTL = null;

      function startTopGemSpinPulse(){
        if (prefersReduceMotion()) return;

        const root = document.querySelector('#wheelSvg [data-role="topGemRoot"]');
        if(!root) return;

        const core  = root.querySelector('[data-role="core"]');
        const glow  = root.querySelector('[data-role="coreGlow"]');
        const bloom = root.querySelector('[data-role="coreBloom"]');
        if(!core) return;

        if(_spinPulseTL){
          _spinPulseTL.kill();
          _spinPulseTL = null;
        }

        gsap.killTweensOf([core, glow, bloom].filter(Boolean));

        gsap.set(core,  { opacity: 0.99, scale: 1, transformOrigin:"50% 50%", transformBox:"fill-box" });
        if(glow)  gsap.set(glow,  { opacity: 0.00, scale: 1, transformOrigin:"50% 50%", transformBox:"fill-box" });
        if(bloom) gsap.set(bloom, { opacity: 0.00, scale: 1, transformOrigin:"50% 50%", transformBox:"fill-box" });

        _spinPulseTL = gsap.timeline({ repeat: -1 });

        _spinPulseTL.to([glow, bloom].filter(Boolean), {
          opacity: (i) => i === 0 ? 0.34 : 0.22,
          duration: 0.38,
          ease: "sine.inOut"
        }, 0);

        _spinPulseTL.to(core, {
          opacity: 0.88,
          duration: 0.38,
          ease: "sine.inOut"
        }, 0);

        _spinPulseTL.to([glow, bloom].filter(Boolean), {
          opacity: (i) => i === 0 ? 0.10 : 0.06,
          duration: 0.30,
          ease: "sine.out"
        }, 0.38);

        _spinPulseTL.to(core, {
          opacity: 0.99,
          duration: 0.30,
          ease: "sine.out"
        }, 0.38);

        _spinPulseTL.to({}, { duration: 0.10 });
      }

      function stopTopGemSpinPulse(){
        const root = document.querySelector('#wheelSvg [data-role="topGemRoot"]');
        const core  = root?.querySelector('[data-role="core"]');
        const glow  = root?.querySelector('[data-role="coreGlow"]');
        const bloom = root?.querySelector('[data-role="coreBloom"]');

        if(_spinPulseTL){
          _spinPulseTL.kill();
          _spinPulseTL = null;
        }

        if(core){
          gsap.killTweensOf(core);
          gsap.to(core, { opacity: 0.99, scale: 1, duration: 0.22, ease: "sine.out" });
        }
        if(glow){
          gsap.killTweensOf(glow);
          gsap.to(glow, { opacity: 0.0, scale: 1, duration: 0.22, ease: "sine.out" });
        }
        if(bloom){
          gsap.killTweensOf(bloom);
          gsap.to(bloom, { opacity: 0.0, scale: 1, duration: 0.22, ease: "sine.out" });
        }
      }

      // ================================
      // SPIN LOGIC (PRESISI KE TOP HIGHLIGHT)
      // ================================
      let spinning = false;
      const HIGHLIGHT_CENTER_DEG = 0;

      function norm360(a){
        a = a % 360;
        return (a < 0) ? a + 360 : a;
      }

      function forwardDelta(fromDeg, toDeg){
        return norm360(toDeg - fromDeg);
      }

      function pickResultIndex(){
        return Math.floor(Math.random() * SEG);
      }

      // ✅ TRIES
      let triesLeft = 2;
      const triesEl = document.getElementById("triesText");
      const spinBtnEl = document.getElementById("spinBtn");

      function setSpinBtnState(){
        if(!spinBtnEl) return;
        const disabled = spinning || triesLeft <= 0;
        spinBtnEl.disabled = disabled;
        spinBtnEl.classList.toggle("is-disabled", disabled);
      }

      function renderTries(){
        if(!triesEl) return;
        triesEl.textContent = `YOU HAVE ${Math.max(0, triesLeft)} TRIES!`;
      }

      function spinOnce(){
        if(spinning) return;
        if(triesLeft <= 0) return;

        spinning = true;
        triesLeft -= 1;
        renderTries();
        setSpinBtnState();

        startTopGemSpinPulse();

        const idx = pickResultIndex();
        const segCenter = idx * DEG;
        const finalAngle = HIGHLIGHT_CENTER_DEG - segCenter;

        const cur = Number(gsap.getProperty("#wheelRot", "rotation")) || 0;
        const curNorm = norm360(cur);

        const targetNorm = norm360(finalAngle);
        const deltaToTarget = forwardDelta(curNorm, targetNorm);

        const reduce = prefersReduceMotion();
        const extraSpins = reduce ? 0 : (6 + Math.floor(Math.random() * 3));
        const newRotation = cur + (extraSpins * 360) + deltaToTarget;

        // pointer micro-punch
        if(!reduce && document.querySelector("#pointerArc")){
          gsap.fromTo("#pointerArc",
            { scale: 1.0 },
            { scale: 1.06, duration: 0.22, yoyo: true, repeat: 1, ease: "sine.inOut", transformOrigin:"50% 50%" }
          );
        }

        gsap.to("#wheelRot", {
          rotation: newRotation,
          transformOrigin: "50% 50%",
          duration: reduce ? 0.55 : 4.4,
          ease: reduce ? "sine.out" : "power4.out",
          onInterrupt: () => {
            stopTopGemSpinPulse();
            spinning = false;
            setSpinBtnState();
          },
          onComplete: () => {
            stopTopGemSpinPulse();
            const snap = Math.round(newRotation * 1000) / 1000;
            gsap.set("#wheelRot", { rotation: snap });
            spinning = false;
            setSpinBtnState();
          }
        });
      }

      // ================================
      // MOUNT
      // ================================
      mount.appendChild(buildWheelSVG());
      requestAnimationFrame(initTopGemRareAnim);

      renderTries();
      setSpinBtnState();

      // klik hub tengah
      const spinCenter = document.getElementById("spinCenter");
      if(spinCenter){
        spinCenter.addEventListener("click", spinOnce, { passive: true });
      }

      // klik tombol bawah
      if(spinBtnEl){
        spinBtnEl.addEventListener("click", spinOnce, { passive: true });
      }
    })();
  </script>
</body>
</html>