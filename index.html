<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Lucky Balloon Pop - Menang Hingga 200K!</title>
  <meta name="description" content="Pop balon keberuntungan, masukkan User ID dan menangkan hadiah. Jackpot real-time terus bertambah." />

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.0/dist/confetti.browser.min.js"></script>

<style>
  *{ margin:0; padding:0; box-sizing:border-box; }
  :root{
    /* ‚úÖ Fresh Sky Palette */
    --skyA:#f7fcff;
    --skyB:#e9f6ff;
    --skyC:#d6efff;

    --ink:#0c2340;
    --muted:#5b7a95;

    --accent:#1ea7ff;
    --accentB:#2d7dff;
    --accent2:#79d5ff;

    --card1: rgba(255,255,255,0.86);
    --card2: rgba(244,252,255,0.68);
    --card3: rgba(233,246,255,0.58);
    --cardBorder: rgba(30,167,255,0.16);

    --softShadow: 0 18px 45px rgba(12,35,64,0.12);

    --focusRing:
      0 0 0 3px rgba(30,167,255,.20),
      0 0 0 1px rgba(255,255,255,.85) inset;

    --radius: 26px;
    --radius2: 16px;

    --safeT: env(safe-area-inset-top, 0px);
    --safeB: env(safe-area-inset-bottom, 0px);

    --gap: clamp(10px, 2.4vw, 14px);
    --pad: clamp(18px, 3.4vw, 22px);

    --easeOut: cubic-bezier(.22,1,.36,1);
    --easeInOut: cubic-bezier(.4,0,.2,1);

    /* ‚úÖ History highlight (solid + menyatu) */
    --hRowA: rgba(30,167,255,.11);
    --hRowB: rgba(30,167,255,.07);
    --hRowC: rgba(30,167,255,.00);

    /* ‚úÖ Baloon round helper */
    --balloonRoundX: 1.06;
    --balloonRoundY: 1.02;
  }

  /* ==========================================================
     ‚úÖ SCROLL + BASE
     ========================================================== */
  html{
    height: auto;
    scroll-behavior: smooth;
  }
  body{
    font-family:'Poppins', sans-serif;
    color: var(--ink);

    min-height: 100vh;
    min-height: 100svh;

    display:block;
    overflow-x:hidden;
    overflow-y:auto;

    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;

    padding:
      calc(var(--pad) + var(--safeT))
      var(--pad)
      calc(var(--pad) + var(--safeB));

    background:
      radial-gradient(1100px 780px at 15% 10%,
        rgba(30,167,255,.22) 0%,
        rgba(30,167,255,0) 60%
      ),
      radial-gradient(900px 640px at 85% 5%,
        rgba(121,213,255,.22) 0%,
        rgba(121,213,255,0) 58%
      ),
      radial-gradient(900px 700px at 50% 120%,
        rgba(30,167,255,.15) 0%,
        rgba(30,167,255,0) 60%
      ),
      linear-gradient(135deg, var(--skyA) 0%, var(--skyB) 45%, var(--skyC) 100%);
  }

  /* ‚úÖ Soft glass bloom */
  body::before{
    content:"";
    position: fixed;
    inset:0;
    pointer-events:none;

    background:
      radial-gradient(700px 500px at 50% 15%, rgba(255,255,255,.88) 0%, rgba(255,255,255,0) 70%),
      radial-gradient(900px 680px at 50% 120%, rgba(255,255,255,.45) 0%, rgba(255,255,255,0) 62%);

    mix-blend-mode: soft-light;
    opacity: .95;
  }

  /* ==========================================================
     ‚úÖ Container (lebih smooth & responsif)
     ========================================================== */
  .container{
    width:min(540px, 100%);
    margin: 0 auto;
    text-align:center;
    padding: var(--pad);
    border-radius: var(--radius);
    position:relative;

    background:
      radial-gradient(900px 520px at 18% 10%,
        rgba(30,167,255,0.16) 0%,
        rgba(30,167,255,0.00) 62%
      ),
      radial-gradient(900px 560px at 86% 0%,
        rgba(121,213,255,0.14) 0%,
        rgba(121,213,255,0.00) 60%
      ),
      linear-gradient(180deg,
        var(--card1) 0%,
        var(--card2) 38%,
        var(--card3) 100%
      );

    border: 1px solid rgba(255,255,255,0.74);
    box-shadow: var(--softShadow);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);

    isolation:isolate;
    transform: translateZ(0);
  }

  .container::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius: var(--radius);
    pointer-events:none;

    box-shadow:
      0 0 0 1px rgba(30,167,255,0.14) inset,
      0 0 0 12px rgba(255,255,255,0.06) inset;

    background:
      linear-gradient(180deg,
        rgba(255,255,255,0.32) 0%,
        rgba(30,167,255,0.06) 52%,
        rgba(0,0,0,0.00) 100%
      );

    opacity: 0.95;
    z-index:-1;
  }

  @media (prefers-reduced-motion: no-preference){
    .container{
      animation: cardEnter .35s var(--easeOut) both;
    }
    @keyframes cardEnter{
      from{ opacity:0; transform: translateY(10px) scale(.985); }
      to  { opacity:1; transform: translateY(0) scale(1); }
    }
  }

  /* ==========================================================
     ‚úÖ HEADER UTAMA (Sheen DIHAPUS + lebih premium clean)
     ========================================================== */
  .hero-header{
    padding: 8px 0 14px;
    margin-bottom: 10px;
    position: relative;
  }

  .hero-title{
    font-weight: 900;
    letter-spacing: .85px;
    text-transform: uppercase;

    font-size: clamp(1.62rem, 4.2vw, 2.28rem);
    line-height: 1.05;

    color: transparent;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    -webkit-background-clip: text;

    /* ‚úÖ Clean gradient (no sheen layer) */
    background-image:
      linear-gradient(180deg,
        rgba(30,167,255,1) 0%,
        rgba(45,125,255,1) 55%,
        rgba(10,90,255,1) 100%
      );

    text-shadow:
      0 24px 48px rgba(30,167,255,0.15),
      0 2px 0 rgba(255,255,255,0.38);

    margin-bottom: 9px;
    display: inline-block;
    isolation: isolate;

    /* ‚úÖ sheen OFF */
    animation: none !important;
  }

  .hero-title::after{
    content:"";
    display:block;
    width: min(260px, 78%);
    height: 8px;
    margin: 11px auto 0;
    border-radius: 999px;

    background: linear-gradient(90deg,
      rgba(30,167,255,0) 0%,
      rgba(30,167,255,0.40) 18%,
      rgba(121,213,255,0.95) 50%,
      rgba(45,125,255,0.44) 82%,
      rgba(30,167,255,0) 100%
    );

    box-shadow:
      0 14px 34px rgba(30,167,255,0.18),
      0 0 0 1px rgba(255,255,255,0.35) inset;

    opacity: .92;
  }

  /* ‚úÖ Badge header rapi (opsional, kalau kamu pakai div class="hero-badges") */
  .hero-badges{
    margin-top: 10px;
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    gap:8px;
  }
  .hero-badge{
    display:inline-flex;
    align-items:center;
    gap:7px;
    padding: 7px 12px;
    border-radius: 999px;
    font-size: .82rem;
    font-weight: 900;
    letter-spacing:.15px;

    color: rgba(12,35,64,.88);
    background: rgba(255,255,255,.72);
    border: 1px solid rgba(30,167,255,.16);
    box-shadow:
      0 14px 28px rgba(12,35,64,.06),
      0 0 0 1px rgba(255,255,255,.50) inset;

    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  .hero-badge i{
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: rgba(30,167,255,.92);
    box-shadow: 0 0 0 4px rgba(30,167,255,.14);
  }

  .hero-sub{
    font-weight: 700;
    font-size: clamp(1.03rem, 2.7vw, 1.18rem);
    line-height: 1.25;

    color: rgba(12,35,64,.82);
    text-shadow: 0 10px 26px rgba(12,35,64,.05);
  }

  .hero-sub b{
    font-weight: 900;
    background: linear-gradient(180deg,
      rgba(30,167,255,1),
      rgba(45,125,255,1)
    );
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  @media (max-width: 360px){
    .hero-title{
      letter-spacing: .6px;
      font-size: clamp(1.48rem, 5.2vw, 1.92rem);
    }
  }

  /* ==========================================================
     ‚úÖ Balloon stage (lebih stabil + round ideal)
     ========================================================== */
  .balloon-container{
    position: relative;
    height: clamp(320px, 50svh, 390px);
    margin: 10px 0 8px;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
    touch-action: pan-y;
  }

  .balloon-set{
    position:absolute;
    inset:0;
  }

  .balloon-item{
    position:absolute;
    width: clamp(142px, 26vw, 184px);
    height:auto;
    padding:0;
    border:0;
    background:transparent;
    cursor:pointer;

    --hs: 1;

    transform: translate3d(-50%, -50%, 0) scale(calc(var(--s, 1) * var(--hs, 1)));
    filter: drop-shadow(0 18px 26px rgba(12,35,64,0.18));
    transition: filter .22s var(--easeInOut), transform .22s var(--easeInOut);
    will-change: transform, filter;
    outline:none;

    animation: balloonBob var(--dur, 6.8s) ease-in-out infinite;
    animation-delay: var(--delay, 0s);

    touch-action: manipulation;
  }

  .balloon-item svg{
    display:block;
    width:100%;
    height:auto;

    /* ‚úÖ bikin bentuk terlihat lebih round */
    transform-origin: 50% 50%;
    transform: scaleX(var(--balloonRoundX)) scaleY(var(--balloonRoundY));
    filter: saturate(1.04) brightness(1.02);
  }

  .balloon-q{
    position:absolute;
    top: 46%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: clamp(44px, 6vw, 58px);
    font-weight: 900;
    letter-spacing: 0.02em;
    color: rgba(255,255,255,0.94);
    text-shadow:
      0 10px 18px rgba(12,35,64,0.18),
      0 0 18px rgba(255,255,255,0.40);
    pointer-events:none;
  }

  .balloon-item:hover{
    --hs: 1.06;
    filter: drop-shadow(0 22px 34px rgba(12,35,64,0.22));
  }
  .balloon-item:active{
    --hs: 0.985;
    filter: drop-shadow(0 16px 22px rgba(12,35,64,0.18));
  }

  .balloon-item:focus-visible{
    outline:none;
    filter: drop-shadow(0 22px 34px rgba(12,35,64,0.22));
  }
  .balloon-item:focus-visible::after{
    content:"";
    position:absolute;
    inset:-10px;
    border-radius: 18px;
    box-shadow: var(--focusRing);
    pointer-events:none;
  }

  .balloon-item.b1{ left: 30%; top: 44%; --s: 1.05; --dur: 6.4s; --delay: -1.1s; }
  .balloon-item.b2{ left: 70%; top: 41%; --s: 1.00; --dur: 6.9s; --delay: -2.4s; }
  .balloon-item.b3{ left: 40%; top: 68%; --s: 0.96; --dur: 7.2s; --delay: -3.0s; }
  .balloon-item.b4{ left: 76%; top: 64%; --s: 0.94; --dur: 6.6s; --delay: -1.8s; }

  @keyframes balloonBob{
    0%,100%{
      transform: translate3d(-50%, -50%, 0) translateY(0px) rotate(-1.2deg)
        scale(calc(var(--s, 1) * var(--hs, 1)));
    }
    50%{
      transform: translate3d(-50%, -50%, 0) translateY(-16px) rotate(1.7deg)
        scale(calc(var(--s, 1) * var(--hs, 1)));
    }
  }

  .balloon-set.pick-mode .balloon-item{
    filter: drop-shadow(0 20px 34px rgba(30,167,255,0.22));
  }
  .balloon-item.is-pick::before{
    content:"";
    position:absolute;
    inset:-8px;
    border-radius: 18px;
    pointer-events:none;
    box-shadow:
      0 0 0 1px rgba(30,167,255,0.20) inset,
      0 0 18px rgba(30,167,255,0.14);
    opacity:.9;
    animation: pickPulse 1.15s ease-in-out infinite;
  }
  @keyframes pickPulse{
    0%,100%{ opacity:.65; transform: scale(1); }
    50%{ opacity:1; transform: scale(1.02); }
  }

  .balloon-item.is-pop{
    pointer-events:none;
    animation: popBalloon .74s var(--easeOut) forwards !important;
  }
  @keyframes popBalloon{
    0%   { transform: translate3d(-50%, -50%, 0) scale(var(--s,1)); opacity:1; }
    60%  { transform: translate3d(-50%, -50%, 0) scale(calc(var(--s,1) * 1.32)) rotate(6deg); opacity:.88; }
    100% { transform: translate3d(-50%, -50%, 0) scale(0.0) rotate(14deg); opacity:0; }
  }

  @media (prefers-reduced-motion: reduce){
    .balloon-item{ animation:none !important; }
    .balloon-item.is-pick::before{ animation:none !important; }
  }

  @media (max-width: 390px){
    .balloon-item.b1{ left: 28%; top: 43%; }
    .balloon-item.b2{ left: 72%; top: 43%; }
    .balloon-item.b3{ left: 28%; top: 70%; }
    .balloon-item.b4{ left: 72%; top: 70%; }
  }

  /* ==========================================================
     ‚úÖ Prize overlay
     ========================================================== */
  .prize-overlay{
    position:absolute;
    top:50%;
    left:50%;
    transform: translate(-50%, -50%);
    font-size: clamp(2.2rem, 6vw, 3rem);
    font-weight: 900;
    opacity:0;
    pointer-events:none;
    color: var(--ink);
    text-shadow: 0 14px 34px rgba(12,35,64,0.22);
  }
  .prize-overlay.show{ animation: prizeShow 1s ease-out forwards; }
  @keyframes prizeShow{
    0% { opacity:0; transform: translate(-50%, -50%) scale(0.5); }
    50%{ opacity:1; transform: translate(-50%, -50%) scale(1.16); }
    100%{ opacity:1; transform: translate(-50%, -50%) scale(1); }
  }

  /* ==========================================================
     ‚úÖ Input + Button
     ========================================================== */
  .input-section{ margin: 6px 0 0; }

  label{
    display:block;
    margin-bottom: 8px;
    font-size: 1.02rem;
    font-weight: 900;
    letter-spacing:.2px;
  }

  #userId{
    width:100%;
    padding: 14px;
    border: 1px solid rgba(30,167,255,0.18);
    border-radius: 14px;
    font-size: 1.05rem;
    text-align:center;

    background: rgba(255,255,255,0.92);
    color: var(--ink);

    outline:none;
    box-shadow: 0 10px 22px rgba(12,35,64,0.06);
    transition: box-shadow .18s ease, border-color .18s ease;
  }
  #userId:focus{
    border-color: rgba(30,167,255,0.36);
    box-shadow:
      0 10px 22px rgba(12,35,64,0.06),
      var(--focusRing);
  }

  #popButton{
    width:100%;
    margin: 12px 0 0;
    padding: 16px 18px;
    font-size: clamp(1.05rem, 3.1vw, 1.30rem);
    font-weight: 900;
    border:none;
    border-radius: 16px;

    background: linear-gradient(180deg, rgba(30,167,255,1), rgba(45,125,255,1));
    color:#fff;

    cursor:pointer;
    box-shadow: 0 16px 30px rgba(30,167,255,0.22);

    position:relative;
    overflow:hidden;

    transition: filter .16s ease, box-shadow .16s ease, transform .16s ease;
    outline:none;
  }

  #popButton::after{
    content:"";
    position:absolute;
    inset:0;
    pointer-events:none;
    background: radial-gradient(120% 90% at 50% 0%,
      rgba(255,255,255,.26) 0%,
      rgba(255,255,255,0) 62%);
    opacity:.9;
  }

  #popButton::before{
    content:"";
    position:absolute;
    top:-40%;
    left:-60%;
    width:55%;
    height:180%;
    pointer-events:none;

    background: linear-gradient(90deg,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,.22) 32%,
      rgba(255,255,255,.46) 50%,
      rgba(255,255,255,.22) 68%,
      rgba(255,255,255,0) 100%
    );

    transform: skewX(-14deg);
    opacity:.85;
    animation: shimmerMove 2.65s ease-in-out infinite;
  }

  @keyframes shimmerMove{
    0%   { transform: translateX(-150%) skewX(-14deg); opacity:.45; }
    45%  { opacity:.92; }
    100% { transform: translateX(360%) skewX(-14deg); opacity:.50; }
  }

  #popButton:hover{
    filter: brightness(1.03);
    box-shadow: 0 18px 34px rgba(30,167,255,0.25);
  }

  #popButton:active{
    transform: translateY(1px);
    filter: brightness(0.99);
  }

  #popButton:focus-visible{
    box-shadow:
      0 18px 34px rgba(30,167,255,0.26),
      0 0 0 4px rgba(30,167,255,0.18),
      0 0 0 1px rgba(255,255,255,0.88) inset;
  }

  #popButton:disabled{
    opacity:0.62;
    cursor:not-allowed;
    filter: grayscale(0.12);
    box-shadow: 0 10px 18px rgba(12,35,64,0.10);
  }
  #popButton:disabled::before{ display:none; }

  @media (prefers-reduced-motion: reduce){
    #popButton::before{ animation:none !important; }
  }

  /* ==========================================================
     ‚úÖ INFO SECTION
     ========================================================== */
  .below-info{
    margin-top: 12px;
    display:grid;
    gap: 10px;
  }

  .jackpot-wrap{
    padding: 12px 12px;
    border-radius: 18px;
    background: rgba(255,255,255,0.64);
    border: 1px solid rgba(30,167,255,0.14);
    box-shadow: 0 16px 30px rgba(12,35,64,0.06);
  }

  .jackpot-title{
    font-weight: 900;
    font-size: .92rem;
    color: rgba(12,35,64,.62);
    letter-spacing: .2px;
    margin-bottom: 4px;
  }

  #jackpot{
    font-size: clamp(1.65rem, 3.8vw, 2.05rem);
    font-weight: 900;
    display:block;

    background: linear-gradient(180deg, #5ddcff 0%, var(--accent) 48%, var(--accentB) 100%);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;

    text-shadow: 0 14px 28px rgba(30,167,255,0.16);
  }

  .update-time{
    font-size: 0.90rem;
    color: var(--muted);
    margin-top: 4px;
  }

  .status-text{
    min-height: 28px;
    display:flex;
    justify-content:center;
    align-items:center;
    line-height: 1.25;
  }
  .status-chip{
    display:inline-flex;
    align-items:center;
    gap: 8px;

    padding: 8px 12px;
    border-radius: 999px;

    background: rgba(255,255,255,.72);
    border: 1px solid rgba(30,167,255,.14);
    box-shadow: 0 12px 22px rgba(12,35,64,.06);

    font-size: .90rem;
    color: rgba(12,35,64,.82);
    font-weight: 900;
    letter-spacing: .1px;

    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  .status-dot{
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: rgba(30,167,255,0.92);
    box-shadow: 0 0 0 4px rgba(30,167,255,0.12);
    flex: 0 0 auto;
  }
  .status-used .status-dot{
    background: rgba(255,159,26,0.95);
    box-shadow: 0 0 0 4px rgba(255,159,26,0.12);
  }
  .online-num{
    font-weight: 900;
    color: rgba(12,35,64,.95);
  }

/* ==========================================================
   ‚úÖ History (NORMAL HEADER + HIGHLIGHT CLEAN MENYATU)
   ========================================================== */
.history{
  --rowH: 44px;
  width:100%;
  border-collapse: collapse;

  background: rgba(255,255,255,0.58);
  border-radius: 14px;
  overflow:hidden;

  border: 1px solid rgba(30,167,255,0.16);
  box-shadow: 0 16px 30px rgba(12,35,64,0.06);
  margin-top: 14px;
}

.history thead{
  display: table;
  width:100%;
  table-layout: fixed;
  background: rgba(30,167,255,0.10);
}

.history tbody{
  display:block;
  width:100%;
  max-height: calc(var(--rowH) * 5);
  overflow-y:auto;

  scroll-behavior:smooth;
  -webkit-overflow-scrolling: touch;

  overscroll-behavior: contain;

  scrollbar-width: thin;
  scrollbar-color: rgba(30,167,255,0.45) rgba(12,35,64,0.06);
}

.history tbody tr{
  display: table;
  width:100%;
  table-layout: fixed;
  position: relative;
}

/* ‚úÖ cell base */
.history th,
.history td{
  height: var(--rowH);
  vertical-align: middle;
  padding: 0 10px;
  font-size: 0.92rem;
  color: var(--ink);
}

/* ‚úÖ HEADER NORMAL (balik clean, no badge/pill) */
.history th{
  font-weight: 900;
  letter-spacing: .25px;
  color: rgba(12,35,64,.78);
  text-transform: uppercase;

  border-bottom: 1px solid rgba(30,167,255,0.14);
}

/* ‚úÖ NO balance */
.history th:nth-child(1),
.history td:nth-child(1){
  width: 56px;
  text-align:center;
  padding: 0 6px;
  font-weight: 900;
  color: rgba(12,35,64,.72);
}

/* USER ID */
.history th:nth-child(2),
.history td:nth-child(2){
  text-align:left;
  padding-left: 10px;
}

/* HADIAH */
.history th:nth-child(3),
.history td:nth-child(3){
  text-align:right;
  padding-right: 12px;
}

/* ‚úÖ garis halus antar row (biar rapi & premium) */
.history tbody tr:not(:last-child) td{
  border-bottom: 1px solid rgba(12,35,64,0.06);
}

/* ‚úÖ hover (lebih normal & gak aneh) */
.history tbody tr:hover{
  background: rgba(30,167,255,0.06);
}

/* ‚úÖ anim row masuk */
.history tbody tr.row-enter td{
  animation: rowIn .32s ease both;
}
@keyframes rowIn{
  from{ opacity:0; transform: translateY(-10px); }
  to  { opacity:1; transform: translateY(0); }
}

/* ‚úÖ hadiah menang */
.history td.win{
  color: #ff9f1a;
  font-weight: 900;
  text-shadow: 0 0 10px rgba(255,159,26,0.14);
}

/* ‚úÖ Row ‚ÄúME‚Äù highlight menyatu (clean + accent kiri) */
.history tbody tr.row-me{
  background: linear-gradient(90deg,
    rgba(30,167,255,.14) 0%,
    rgba(30,167,255,.08) 55%,
    rgba(30,167,255,0) 100%
  );
}

.history tbody tr.row-me td:first-child{
  position: relative;
}

.history tbody tr.row-me td:first-child::before{
  content:"";
  position:absolute;
  left: 0;
  top: 8px;
  bottom: 8px;
  width: 3px;
  border-radius: 999px;
  background: rgba(30,167,255,.90);
  box-shadow: 0 0 0 4px rgba(30,167,255,.12);
}

/* ‚úÖ scrollbar */
.history tbody::-webkit-scrollbar{ width: 10px; }
.history tbody::-webkit-scrollbar-track{ background: rgba(12,35,64,0.06); }
.history tbody::-webkit-scrollbar-thumb{
  background: rgba(30,167,255,0.40);
  border-radius: 999px;
  border: 2px solid rgba(255,255,255,0.60);
}
.history tbody::-webkit-scrollbar-thumb:hover{
  background: rgba(30,167,255,0.55);
}

@media (max-width: 480px){
  .history{ --rowH: 42px; }
  .history th, .history td{ font-size: .90rem; }
  .history th:nth-child(1),
  .history td:nth-child(1){ width: 54px; }
}

/* ============================================================
   ‚úÖ HISTORY: user + tanggal/jam di bawahnya (minimalis rapi)
   ============================================================ */
.history td{ vertical-align: middle; }
.history td:nth-child(2){ text-align:left; }

.h-userbtn{
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  gap:2px;
  width:100%;
  border:0;
  background:transparent;
  padding:0;
  margin:0;
  text-align:left;
  color:inherit;
  font:inherit;
  cursor:default;
}

.h-userrow{
  display:inline-flex;
  align-items:center;
  gap:8px;
  line-height:1.1;
  font-weight:900;
}

.h-userbadge{
  font-size:.68rem;
  font-weight:900;
  padding:3px 8px;
  border-radius:999px;
  background: rgba(30,167,255,.12);
  border: 1px solid rgba(30,167,255,.22);
  color: rgba(12,35,64,.85);
  box-shadow: 0 10px 28px rgba(30,167,255,.14);
  letter-spacing:.2px;
}

.h-time{
  font-size:.76rem;
  opacity:.68;
  line-height:1.15;
  white-space:nowrap;
}

.h-userbtn.is-me{
  cursor:pointer;
}
.h-userbtn.is-me .h-userrow{
  color: rgba(12,35,64,.98);
  text-shadow: 0 10px 30px rgba(30,167,255,.18);
}

  /* ============================================================
     ‚úÖ MODAL DETAIL HISTORY (smooth)
     ============================================================ */
  .hmodal{
    position:fixed;
    inset:0;
    z-index:100001;
    display:grid;
    place-items:center;
    padding:18px;
    background: rgba(12,35,64,.32);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    opacity:0;
    pointer-events:none;
    transition: opacity .22s ease;
  }
  .hmodal.show{ opacity:1; pointer-events:auto; }

  .hmodal-card{
    width:min(380px,92vw);
    border-radius:22px;
    overflow:hidden;
    background:
      radial-gradient(900px 420px at 50% -12%,
        rgba(30,167,255,.18) 0%,
        rgba(30,167,255,0) 60%
      ),
      linear-gradient(180deg,
        rgba(255,255,255,.96) 0%,
        rgba(233,246,255,.92) 100%
      );
    border: 1px solid rgba(255,255,255,.86);
    box-shadow:
      0 38px 90px rgba(12,35,64,.22),
      0 0 0 1px rgba(30,167,255,.12) inset;
    transform: translateY(10px) scale(.985);
    transition: transform .22s var(--easeOut);
  }
  .hmodal.show .hmodal-card{ transform: translateY(0) scale(1); }

  .hmodal-head{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 14px 10px;
  }
  .hmodal-title{
    font-weight:1000;
    font-size:1.02rem;
    color:#0c2340;
  }
  .hmodal-x{
    width:38px;
    height:38px;
    border-radius:12px;
    border:1px solid rgba(12,35,64,.10);
    background: rgba(255,255,255,.88);
    cursor:pointer;
    font-weight:1000;
    color: rgba(12,35,64,.74);
    box-shadow: 0 14px 30px rgba(12,35,64,.10);
  }
  .hmodal-body{ padding: 6px 14px 16px; }

  .hm-big{
    font-weight:1000;
    font-size:1.2rem;
    color:#0c2340;
    margin-bottom:10px;
  }
  .hm-row{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:10px 12px;
    border-radius:16px;
    background: rgba(255,255,255,.76);
    border: 1px solid rgba(12,35,64,.08);
    margin-top:8px;
  }
  .hm-k{
    font-size:.84rem;
    color: rgba(12,35,64,.62);
    font-weight:800;
  }
  .hm-v{
    font-size:.92rem;
    color: rgba(12,35,64,.92);
    font-weight:1000;
    text-align:right;
    max-width:60%;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
  }

  @media (prefers-reduced-motion: reduce){
    .hmodal, .hmodal-card{ transition:none !important; }
  }

/* ==========================================================
   ‚úÖ RESULT POPUP (PREMIUM MINIMAL + MOBILE SMALL)
   ========================================================== */
html.modal-open, body.modal-open{ overflow:hidden !important; }

.result-pop{
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;

  padding:
    calc(16px + var(--safeT))
    14px
    calc(16px + var(--safeB));

  z-index: 99999;

  background: rgba(12,35,64,0.28);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);

  opacity: 0;
  pointer-events: none;
  transition: opacity .22s ease;
}
.result-pop.show{
  opacity: 1;
  pointer-events: auto;
}

.result-card{
  width: min(390px, 92vw);
  max-height: min(78vh, 560px); /* ‚úÖ biar tidak nutup layar */
  border-radius: 22px;
  position: relative;
  overflow: hidden;

  display:flex;
  flex-direction: column;

  background:
    radial-gradient(820px 420px at 50% -10%,
      rgba(30,167,255,.14) 0%,
      rgba(30,167,255,0) 58%
    ),
    linear-gradient(180deg,
      rgba(255,255,255,.96) 0%,
      rgba(233,246,255,.92) 100%
    );

  border: 1px solid rgba(255,255,255,.82);
  box-shadow:
    0 34px 88px rgba(12,35,64,0.22),
    0 0 0 1px rgba(30,167,255,.12) inset;

  transform: translateY(14px) scale(.985);
  opacity: 0;
}
.result-pop.show .result-card{
  animation: resultIn .34s var(--easeOut) forwards;
}
@keyframes resultIn{
  to{ transform: translateY(0) scale(1); opacity: 1; }
}

.result-card::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    radial-gradient(120% 72% at 50% 0%,
      rgba(255,255,255,.62) 0%,
      rgba(255,255,255,0) 60%
    );
  opacity: .92;
}

.result-card::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  border-radius: 22px;
  box-shadow:
    0 0 0 1px rgba(30,167,255,0.14) inset,
    0 0 0 12px rgba(255,255,255,0.06) inset;
  opacity: .95;
}

/* ‚úÖ TOP (balloon svg + badge) */
.result-top{
  position: relative;
  display:flex;
  flex-direction: column;
  align-items:center;
  justify-content:center;
  gap: 9px;

  padding: 14px 16px 0;
  z-index: 1;
}

.result-balloon-svg{
  width: 74px;
  height: 92px;
  filter: drop-shadow(0 18px 30px rgba(12,35,64,0.18));
  transform: translateZ(0);
}
.result-balloon-svg svg{
  width:100%;
  height:100%;
  display:block;
}

@media (prefers-reduced-motion: no-preference){
  .result-pop.show .result-balloon-svg{
    animation: modalBalloonFloat 1.15s var(--easeOut) both,
               modalBalloonIdle 3.2s ease-in-out infinite 1.15s;
  }
  @keyframes modalBalloonFloat{
    from{ transform: translateY(14px) scale(.94); opacity:0; }
    to  { transform: translateY(0) scale(1); opacity:1; }
  }
  @keyframes modalBalloonIdle{
    0%,100%{ transform: translateY(0) rotate(-1.2deg); }
    50%    { transform: translateY(-6px) rotate(1.2deg); }
  }
}

.result-pill{
  padding: 8px 13px;
  border-radius: 999px;

  background: linear-gradient(180deg,
    rgba(30,167,255,1),
    rgba(45,125,255,1)
  );
  color:#fff;
  font-weight: 800;
  font-size: .90rem;

  box-shadow: 0 14px 28px rgba(30,167,255,.20);
  border: 1px solid rgba(255,255,255,0.32);

  opacity: 0;
  transform: translateY(6px);
}

.result-pop.show .result-pill{
  animation: pillIn .34s ease forwards;
  animation-delay: .08s;
}
@keyframes pillIn{
  to{ opacity:1; transform: translateY(0); }
}

/* ‚úÖ BODY SCROLL SAFE */
.result-body{
  padding: 10px 16px 10px;
  position:relative;
  z-index:1;

  overflow: auto;              /* ‚úÖ kalau kepanjangan jadi scroll */
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}

.result-body::-webkit-scrollbar{ width: 10px; }
.result-body::-webkit-scrollbar-thumb{
  background: rgba(12,35,64,.14);
  border-radius: 999px;
  border: 3px solid rgba(255,255,255,.55);
}

.result-label{
  text-align:center;
  font-weight: 800;
  font-size: .80rem;
  letter-spacing: .25px;
  color: rgba(12,35,64,.62);
  margin-top: 6px;
}

.result-prize{
  text-align:center;
  margin: 8px 0 10px;
  line-height: 1.02;
  font-weight: 900;

  font-size: clamp(1.95rem, 6.2vw, 2.28rem);

  background: linear-gradient(180deg,
    #ffeaa0 0%,
    #ffbf2f 45%,
    #ff9f1a 100%
  );
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;

  text-shadow: 0 16px 30px rgba(255,191,47,.16);
}

.result-prize.is-zero{
  background: linear-gradient(180deg, rgba(12,35,64,.35), rgba(12,35,64,.72));
  -webkit-background-clip:text;
  background-clip:text;
  text-shadow:none;
}

.result-meta{
  display:grid;
  gap: 9px;
  margin-top: 4px;
}

.meta-row{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;

  padding: 10px 12px;
  border-radius: 14px;

  background: rgba(255,255,255,.66);
  border: 1px solid rgba(30,167,255,.14);
  box-shadow: 0 10px 22px rgba(12,35,64,.06);
}

.meta-k{
  font-weight: 800;
  font-size: .80rem;
  color: rgba(12,35,64,.60);
}
.meta-v{
  font-weight: 900;
  font-size: .94rem;
  color: rgba(12,35,64,.92);
}

/* ‚úÖ ACTIONS (sticky bawah, tetap rapi di mobile) */
.result-actions{
  padding: 12px 16px 14px;
  display:grid;
  grid-template-columns: 1fr;
  gap: 10px;

  position:relative;
  z-index:1;
}

.result-btn{
  width:100%;
  min-height: 50px;
  border:none;
  border-radius: 16px;
  padding: 14px 16px;

  font-weight: 900;
  font-size: 1.02rem;

  cursor:pointer;
  color:#fff;

  display:inline-flex;
  align-items:center;
  justify-content:center;

  position:relative;
  overflow:hidden;

  background: linear-gradient(180deg, rgba(30,167,255,1), rgba(45,125,255,1));
  box-shadow: 0 18px 34px rgba(30,167,255,.22);

  transition: filter .16s ease, transform .16s ease, box-shadow .16s ease;
  outline:none;
}

/* ‚úÖ Shimmer hanya untuk tombol utama (KLAIM) */
.result-btn::before{
  content:"";
  position:absolute;
  top:-40%;
  left:-60%;
  width:55%;
  height:180%;
  pointer-events:none;

  background: linear-gradient(90deg,
    rgba(255,255,255,0),
    rgba(255,255,255,.18),
    rgba(255,255,255,.44),
    rgba(255,255,255,.18),
    rgba(255,255,255,0)
  );

  transform: skewX(-14deg);
  animation: btnShimmer 2.35s ease-in-out infinite;
  opacity:.85;
}
@keyframes btnShimmer{
  0%   { transform: translateX(-150%) skewX(-14deg); opacity:.45; }
  60%  { opacity:.92; }
  100% { transform: translateX(360%) skewX(-14deg); opacity:.55; }
}

.result-btn:hover{
  filter: brightness(1.03);
  box-shadow: 0 20px 38px rgba(30,167,255,.24);
}
.result-btn:active{ transform: translateY(1px); }
.result-btn:focus-visible{
  box-shadow:
    0 20px 38px rgba(30,167,255,.24),
    0 0 0 4px rgba(30,167,255,0.18),
    0 0 0 1px rgba(255,255,255,0.88) inset;
}
.result-btn:disabled{
  opacity:.62;
  cursor:not-allowed;
}
.result-btn:disabled::before{ display:none; }

/* ==========================================================
   ‚úÖ BAGIKAN: putih bersih, TANPA shine
   ========================================================== */
.result-btn.btn-share{
  background: linear-gradient(180deg,
    rgba(255,255,255,0.98),
    rgba(241,248,255,0.95)
  );
  color: rgba(12,35,64,.92);

  border: 1px solid rgba(30,167,255,.18);
  box-shadow:
    0 16px 28px rgba(12,35,64,.10),
    0 0 0 1px rgba(255,255,255,.70) inset;
}
.result-btn.btn-share::before{
  display:none !important; /* ‚úÖ kill shimmer */
}
.result-btn.btn-share:hover{
  filter: none;
  box-shadow:
    0 18px 30px rgba(12,35,64,.12),
    0 0 0 1px rgba(255,255,255,.72) inset;
}

/* ‚úÖ Motion safe */
@media (prefers-reduced-motion: reduce){
  .result-btn::before{ animation:none !important; }
}

/* ==========================================================
   ‚úÖ MOBILE: lebih kecil, lebih minimal, tidak menutup layar
   ========================================================== */
@media (max-width: 420px){
  .result-pop{
    padding:
      calc(14px + var(--safeT))
      12px
      calc(14px + var(--safeB));
  }

  .result-card{
    width: min(340px, 92vw);
    max-height: min(74vh, 520px);
    border-radius: 20px;
  }

  .result-top{
    padding: 12px 14px 0;
    gap: 8px;
  }

  .result-balloon-svg{
    width: 66px;
    height: 82px;
  }

  .result-pill{
    font-size: .86rem;
    padding: 7px 12px;
  }

  .result-body{ padding: 9px 14px 10px; }

  .result-prize{
    font-size: clamp(1.75rem, 7vw, 2.05rem);
    margin: 7px 0 9px;
  }

  .meta-row{
    padding: 9px 11px;
    border-radius: 13px;
  }

  .result-actions{
    padding: 10px 14px 13px;
    gap: 9px;
  }

  .result-btn{
    min-height: 46px;
    border-radius: 14px;
    padding: 12px 14px;
    font-size: 1rem;
  }
}

    /* ==========================================================
       ‚úÖ CLAIM LOADING OVERLAY (Premium)
       ========================================================== */
    .claim-loading{
      position: fixed;
      inset: 0;
      z-index: 100000;
      display: grid;
      place-items: center;
      padding: 18px;

      background: rgba(12,35,64,0.30);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);

      opacity: 0;
      pointer-events: none;
      transition: opacity .22s ease;
    }

    .claim-loading.show{
      opacity: 1;
      pointer-events: auto;
    }

    .claim-loading-card{
      width: min(360px, 92vw);
      border-radius: 22px;
      padding: 18px 16px;

      background:
        radial-gradient(900px 420px at 50% -10%,
          rgba(30,167,255,.16) 0%,
          rgba(30,167,255,0) 60%
        ),
        linear-gradient(180deg,
          rgba(255,255,255,.96) 0%,
          rgba(233,246,255,.92) 100%
        );

      border: 1px solid rgba(255,255,255,.82);
      box-shadow:
        0 34px 88px rgba(12,35,64,0.22),
        0 0 0 1px rgba(30,167,255,.12) inset;

      position: relative;
      overflow: hidden;
      text-align: center;

      transform: translateY(10px) scale(.98);
      animation: claimCardIn .28s var(--easeOut) forwards;
    }

    @keyframes claimCardIn{
      to{ transform: translateY(0) scale(1); }
    }

    .claim-loading-card::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(120% 72% at 50% 0%,
          rgba(255,255,255,.60) 0%,
          rgba(255,255,255,0) 60%
        );
      opacity:.92;
    }

    .claim-spinner{
      width: 46px;
      height: 46px;
      border-radius: 999px;
      margin: 6px auto 10px;

      border: 4px solid rgba(30,167,255,.18);
      border-top-color: rgba(30,167,255,1);

      box-shadow: 0 16px 30px rgba(30,167,255,.16);
      animation: claimSpin .9s linear infinite;
    }

    @keyframes claimSpin{
      to{ transform: rotate(360deg); }
    }

    .claim-title{
      font-weight: 800;
      font-size: 1.06rem;
      letter-spacing: .2px;
      color: var(--ink);
    }

    .claim-sub{
      margin-top: 6px;
      font-size: .92rem;
      color: var(--muted);
      line-height: 1.35;
    }

    .claim-dots{
      display:inline-flex;
      gap: 4px;
      margin-left: 4px;
      vertical-align: middle;
    }

    .claim-dots i{
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(30,167,255,.70);
      opacity: .25;
      animation: dotBlink 1.1s ease-in-out infinite;
    }

    .claim-dots i:nth-child(2){ animation-delay: .12s; }
    .claim-dots i:nth-child(3){ animation-delay: .24s; }

    @keyframes dotBlink{
      0%,100%{ opacity: .22; transform: translateY(0); }
      50%{ opacity: .95; transform: translateY(-2px); }
    }

    @media (prefers-reduced-motion: reduce){
      .claim-spinner{ animation: none !important; }
      .claim-dots i{ animation: none !important; opacity: .7; }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- ‚úÖ HEADER UTAMA -->
    <div class="hero-header">
      <div class="hero-title">SELAMAT DATANG DI MADETOTO2</div>
      <div class="hero-sub">Lucky Balloon Pop - <b>Menang Hingga 200K!</b></div>
    </div>

    <div class="balloon-container" id="balloonContainer">
      <div class="balloon-set" id="balloon">

  <!-- üéà BALON 1 (PINK) -->
  <button class="balloon-item b1" type="button" aria-label="Balon Pink">
    <svg viewBox="0 0 200 330" width="200" height="330" role="img" aria-hidden="true">
      <defs>
        <radialGradient id="gPinkA" cx="35%" cy="28%" r="70%">
          <stop offset="0%"  stop-color="#ffffff" stop-opacity="0.96"/>
          <stop offset="24%" stop-color="#ffeaf2" stop-opacity="0.96"/>
          <stop offset="58%" stop-color="#ff5d98" stop-opacity="0.92"/>
          <stop offset="100%" stop-color="#ff2d7a" stop-opacity="0.88"/>
        </radialGradient>
        <linearGradient id="gPinkShade" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%"  stop-color="#000000" stop-opacity="0"/>
          <stop offset="72%" stop-color="#000000" stop-opacity="0.08"/>
          <stop offset="100%" stop-color="#000000" stop-opacity="0.12"/>
        </linearGradient>
        <filter id="softShadowPink" x="-40%" y="-40%" width="180%" height="210%">
          <feGaussianBlur in="SourceAlpha" stdDeviation="5" result="blur"/>
          <feOffset dy="8" result="off"/>
          <feColorMatrix in="off" type="matrix"
            values="0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 .18 0" result="shadow"/>
          <feMerge>
            <feMergeNode in="shadow"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <g filter="url(#softShadowPink)">
        <!-- ‚úÖ ROUND + sedikit lonjong bawah (balance) -->
        <path d="M100 40
                 C62 40 34 74 34 116
                 C34 170 66 206 100 214
                 C134 206 166 170 166 116
                 C166 74 138 40 100 40 Z"
              fill="url(#gPinkA)"
              stroke="rgba(255,255,255,0.38)" stroke-width="2"/>

        <path d="M100 40
                 C62 40 34 74 34 116
                 C34 170 66 206 100 214
                 C134 206 166 170 166 116
                 C166 74 138 40 100 40 Z"
              fill="url(#gPinkShade)" opacity="0.72"/>

        <!-- ‚úÖ highlight glossy -->
        <path d="M78 58
                 C54 78 46 102 50 128
                 C54 162 70 184 92 198
                 C68 176 62 154 64 130
                 C66 102 74 78 90 66 Z"
              fill="#fff" opacity="0.24"/>
        <circle cx="78" cy="88" r="10" fill="#fff" opacity="0.16"/>
        <circle cx="90" cy="106" r="5" fill="#fff" opacity="0.10"/>

        <!-- ‚úÖ knot -->
        <path d="M100 214
                 C92 224 90 232 90 240
                 C90 250 98 256 100 258
                 C102 256 110 250 110 240
                 C110 232 108 224 100 214 Z"
              fill="#ff3a7f" opacity="0.82"/>
      </g>

      <!-- ‚úÖ string -->
      <path d="M100 258 C116 272 92 278 108 286"
            fill="none"
            stroke="rgba(12,35,64,0.28)"
            stroke-width="2.2"
            stroke-linecap="round"/>
    </svg>
    <span class="balloon-q">?</span>
  </button>

  <!-- üéà BALON 2 (YELLOW) -->
  <button class="balloon-item b2" type="button" aria-label="Balon Kuning">
    <svg viewBox="0 0 200 330" width="200" height="330" role="img" aria-hidden="true">
      <defs>
        <radialGradient id="gYellowA" cx="35%" cy="28%" r="70%">
          <stop offset="0%"  stop-color="#ffffff" stop-opacity="0.96"/>
          <stop offset="24%" stop-color="#fff7cf" stop-opacity="0.96"/>
          <stop offset="60%" stop-color="#ffd84b" stop-opacity="0.92"/>
          <stop offset="100%" stop-color="#ffb200" stop-opacity="0.88"/>
        </radialGradient>
        <linearGradient id="gYellowShade" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%"  stop-color="#000000" stop-opacity="0"/>
          <stop offset="72%" stop-color="#000000" stop-opacity="0.08"/>
          <stop offset="100%" stop-color="#000000" stop-opacity="0.12"/>
        </linearGradient>
        <filter id="softShadowYellow" x="-40%" y="-40%" width="180%" height="210%">
          <feGaussianBlur in="SourceAlpha" stdDeviation="5" result="blur"/>
          <feOffset dy="8" result="off"/>
          <feColorMatrix in="off" type="matrix"
            values="0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 .18 0" result="shadow"/>
          <feMerge>
            <feMergeNode in="shadow"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <g filter="url(#softShadowYellow)">
        <path d="M100 40
                 C62 40 34 74 34 116
                 C34 170 66 206 100 214
                 C134 206 166 170 166 116
                 C166 74 138 40 100 40 Z"
              fill="url(#gYellowA)"
              stroke="rgba(255,255,255,0.38)" stroke-width="2"/>
        <path d="M100 40
                 C62 40 34 74 34 116
                 C34 170 66 206 100 214
                 C134 206 166 170 166 116
                 C166 74 138 40 100 40 Z"
              fill="url(#gYellowShade)" opacity="0.70"/>

        <path d="M78 58
                 C54 78 46 102 50 128
                 C54 162 70 184 92 198
                 C68 176 62 154 64 130
                 C66 102 74 78 90 66 Z"
              fill="#fff" opacity="0.22"/>
        <circle cx="78" cy="88" r="10" fill="#fff" opacity="0.14"/>
        <circle cx="90" cy="106" r="5" fill="#fff" opacity="0.09"/>

        <path d="M100 214
                 C92 224 90 232 90 240
                 C90 250 98 256 100 258
                 C102 256 110 250 110 240
                 C110 232 108 224 100 214 Z"
              fill="#ffb200" opacity="0.78"/>
      </g>

      <path d="M100 258 C116 272 90 278 106 286"
            fill="none"
            stroke="rgba(12,35,64,0.28)"
            stroke-width="2.2"
            stroke-linecap="round"/>
    </svg>
    <span class="balloon-q">?</span>
  </button>

  <!-- üéà BALON 3 (ORANGE) -->
  <button class="balloon-item b3" type="button" aria-label="Balon Orange">
    <svg viewBox="0 0 200 330" width="200" height="330" role="img" aria-hidden="true">
      <defs>
        <radialGradient id="gOrangeA" cx="35%" cy="28%" r="70%">
          <stop offset="0%"  stop-color="#ffffff" stop-opacity="0.96"/>
          <stop offset="24%" stop-color="#ffe7d4" stop-opacity="0.96"/>
          <stop offset="60%" stop-color="#ff9f3a" stop-opacity="0.92"/>
          <stop offset="100%" stop-color="#ff6a2a" stop-opacity="0.88"/>
        </radialGradient>
        <linearGradient id="gOrangeShade" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%"  stop-color="#000000" stop-opacity="0"/>
          <stop offset="72%" stop-color="#000000" stop-opacity="0.08"/>
          <stop offset="100%" stop-color="#000000" stop-opacity="0.12"/>
        </linearGradient>
        <filter id="softShadowOrange" x="-40%" y="-40%" width="180%" height="210%">
          <feGaussianBlur in="SourceAlpha" stdDeviation="5" result="blur"/>
          <feOffset dy="8" result="off"/>
          <feColorMatrix in="off" type="matrix"
            values="0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 .18 0" result="shadow"/>
          <feMerge>
            <feMergeNode in="shadow"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <g filter="url(#softShadowOrange)">
        <path d="M100 40
                 C62 40 34 74 34 116
                 C34 170 66 206 100 214
                 C134 206 166 170 166 116
                 C166 74 138 40 100 40 Z"
              fill="url(#gOrangeA)"
              stroke="rgba(255,255,255,0.38)" stroke-width="2"/>
        <path d="M100 40
                 C62 40 34 74 34 116
                 C34 170 66 206 100 214
                 C134 206 166 170 166 116
                 C166 74 138 40 100 40 Z"
              fill="url(#gOrangeShade)" opacity="0.70"/>

        <path d="M78 58
                 C54 78 46 102 50 128
                 C54 162 70 184 92 198
                 C68 176 62 154 64 130
                 C66 102 74 78 90 66 Z"
              fill="#fff" opacity="0.20"/>
        <circle cx="78" cy="88" r="10" fill="#fff" opacity="0.13"/>
        <circle cx="90" cy="106" r="5" fill="#fff" opacity="0.09"/>

        <path d="M100 214
                 C92 224 90 232 90 240
                 C90 250 98 256 100 258
                 C102 256 110 250 110 240
                 C110 232 108 224 100 214 Z"
              fill="#ff6a2a" opacity="0.78"/>
      </g>

      <path d="M100 258 C116 272 88 278 108 286"
            fill="none"
            stroke="rgba(12,35,64,0.28)"
            stroke-width="2.2"
            stroke-linecap="round"/>
    </svg>
    <span class="balloon-q">?</span>
  </button>

  <!-- üéà BALON 4 (PURPLE) -->
  <button class="balloon-item b4" type="button" aria-label="Balon Ungu">
    <svg viewBox="0 0 200 330" width="200" height="330" role="img" aria-hidden="true">
      <defs>
        <radialGradient id="gPurpleA" cx="35%" cy="28%" r="70%">
          <stop offset="0%"  stop-color="#ffffff" stop-opacity="0.96"/>
          <stop offset="24%" stop-color="#f2eaff" stop-opacity="0.96"/>
          <stop offset="60%" stop-color="#caa2ff" stop-opacity="0.92"/>
          <stop offset="100%" stop-color="#8e62ff" stop-opacity="0.88"/>
        </radialGradient>
        <linearGradient id="gPurpleShade" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%"  stop-color="#000000" stop-opacity="0"/>
          <stop offset="72%" stop-color="#000000" stop-opacity="0.08"/>
          <stop offset="100%" stop-color="#000000" stop-opacity="0.12"/>
        </linearGradient>
        <filter id="softShadowPurple" x="-40%" y="-40%" width="180%" height="210%">
          <feGaussianBlur in="SourceAlpha" stdDeviation="5" result="blur"/>
          <feOffset dy="8" result="off"/>
          <feColorMatrix in="off" type="matrix"
            values="0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 .18 0" result="shadow"/>
          <feMerge>
            <feMergeNode in="shadow"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <g filter="url(#softShadowPurple)">
        <path d="M100 40
                 C62 40 34 74 34 116
                 C34 170 66 206 100 214
                 C134 206 166 170 166 116
                 C166 74 138 40 100 40 Z"
              fill="url(#gPurpleA)"
              stroke="rgba(255,255,255,0.38)" stroke-width="2"/>
        <path d="M100 40
                 C62 40 34 74 34 116
                 C34 170 66 206 100 214
                 C134 206 166 170 166 116
                 C166 74 138 40 100 40 Z"
              fill="url(#gPurpleShade)" opacity="0.70"/>

        <path d="M78 58
                 C54 78 46 102 50 128
                 C54 162 70 184 92 198
                 C68 176 62 154 64 130
                 C66 102 74 78 90 66 Z"
              fill="#fff" opacity="0.20"/>
        <circle cx="78" cy="88" r="10" fill="#fff" opacity="0.13"/>
        <circle cx="90" cy="106" r="5" fill="#fff" opacity="0.09"/>

        <path d="M100 214
                 C92 224 90 232 90 240
                 C90 250 98 256 100 258
                 C102 256 110 250 110 240
                 C110 232 108 224 100 214 Z"
              fill="#8e62ff" opacity="0.78"/>
      </g>

      <path d="M100 258 C114 272 92 278 108 286"
            fill="none"
            stroke="rgba(12,35,64,0.28)"
            stroke-width="2.2"
            stroke-linecap="round"/>
    </svg>
    <span class="balloon-q">?</span>
  </button>

</div>

      <div class="prize-overlay" id="prizeOverlay"></div>
    </div>

    <div class="input-section">
      <label for="userId">MASUKKAN USER ID ANDA</label>
      <input type="text" id="userId" placeholder="Masukkan User ID" inputmode="text" autocomplete="off" />
      <button id="popButton" disabled>PECAH BALON SEKARANG!</button>

      <!-- ‚úÖ SEMUA INFO DIPINDAH KE BAWAH BUTTON -->
      <div class="below-info">
        <div class="jackpot-wrap">
          <div class="jackpot-title">Total Jackpot</div>
          <div id="jackpot">IDR 913.929.049</div>
          <div class="update-time">Update: <span id="time">00:00:00</span></div>
        </div>

        <!-- ‚úÖ Status (Online / Used) -->
        <div class="status-text" id="statusText" aria-live="polite"></div>
      </div>
    </div>

    <table class="history" aria-label="Riwayat Hadiah">
      <thead>
        <tr>
          <th>NO</th>
          <th>USER ID</th>
          <th>HADIAH</th>
        </tr>
      </thead>
      <tbody id="historyBody"></tbody>
    </table>
  </div>

<script>
(() => {
  "use strict";

  // ==========================================================
  // ‚úÖ FLEXIBLE CONFIG (EDIT INI AJA)
  // ==========================================================
  const CONFIG = {
    claim: {
      url: "https://madetoto2.info",
      openTarget: "_self",
      includeParams: true,

      loading: {
        enabled: true,
        delayMs: 950,
        title: "Menghubungkan ke server",
        sub: "Mohon tunggu sebentar‚Ä¶",
        failTitle: "Link klaim belum diisi",
        failSub: "Silakan isi CONFIG.claim.url dulu."
      }
    },

    share: {
      title: "Lucky Balloon Pop",
      url: ""
    },

    jackpot: {
      base: 913_929_049,
      minReset: 1_000_000,
      maxSafe: 9_000_000_000_000_000,
      jackpotChance: 0.02
    },

    labels: {
      pop: "PECAH BALON SEKARANG!",
      pick: "PILIH BALON",
      processing: "DIPROSES...",
      usedBtn: "SUDAH DIPAKAI",
      empty: "BALON HABIS",
      usedText: "Kesempatan Anda sudah habis. Silakan klaim hadiah Anda."
    },

    history: {
      max: 50,
      liveSim: true,
      liveMinDelay: 3800,
      liveMaxDelay: 8600
    },

    online: {
      min: 145,
      max: 240
    },

    prizes: [
      { text: "200K", p: 0.06 },
      { text: "150K", p: 0.07 },
      { text: "100K", p: 0.11 },
      { text: "75K",  p: 0.14 },
      { text: "50K",  p: 0.18 },
      { text: "25K",  p: 0.20 },
      { text: "0",    p: 0.24 }
    ],

    sound: {
      enabled: true,
      master: 0.85,

      // volume masing-masing (0 - 1)
      bg: 0.10,        // background music halus
      pop: 0.95,
      tap: 0.30,
      historyIn: 0.40, // ‚úÖ notif history masuk
      modal: 0.40,

      // ‚úÖ FILE SOUND (ISI LINK MP3 KAMU)
      files: {
        bg:  "https://assets.mixkit.co/music/1072/1072.mp3",
        pop: "https://assets.mixkit.co/active_storage/sfx/2083/2083-preview.mp3",
        tap: "https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3",
        historyIn: "https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3", // ‚úÖ NEW
        modalOpen: "https://assets.mixkit.co/active_storage/sfx/2985/2985-preview.mp3",
        modalClose:"https://assets.mixkit.co/active_storage/sfx/2364/2364-preview.mp3"
      }
    }
  };

  // ==========================================================
  // ‚úÖ Helpers
  // ==========================================================
  const $ = (s, r = document) => r.querySelector(s);
  const $$ = (s, r = document) => Array.from(r.querySelectorAll(s));
  const nowMs = () => Date.now();
  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
  const clamp01 = (n) => Math.max(0, Math.min(1, Number(n) || 0));

  const fmtIDR = new Intl.NumberFormat("id-ID");
  const formatRupiah = (angka) => "IDR " + fmtIDR.format(Math.round(angka));

  const safeJSON = (raw, fallback) => {
    try { const v = JSON.parse(raw); return v ?? fallback; }
    catch { return fallback; }
  };

  const LS = {
    get(key, fallback) {
      try {
        const v = localStorage.getItem(key);
        return v == null ? fallback : safeJSON(v, fallback);
      } catch { return fallback; }
    },
    set(key, value) {
      try { localStorage.setItem(key, JSON.stringify(value)); } catch {}
    }
  };

  const debounce = (fn, ms) => {
    let t = null;
    return (...args) => {
      if (t) clearTimeout(t);
      t = setTimeout(() => fn(...args), ms);
    };
  };

  const prefersReducedMotion =
    window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

  const isSmallDevice =
    window.matchMedia && window.matchMedia("(max-width: 420px)").matches;

  const formatHistoryDateTime = (ts) => {
    try {
      const d = new Date(ts);
      const date = d.toLocaleDateString("id-ID", { day:"2-digit", month:"short", year:"numeric" });
      const time = d.toTimeString().slice(0, 5);
      return `${date} ‚Ä¢ ${time}`;
    } catch {
      return "‚Äî";
    }
  };

  // ==========================================================
  // ‚úÖ DOM
  // ==========================================================
  const jackpotEl = $("#jackpot");
  const timeEl = $("#time");
  const userIdInput = $("#userId");
  const popButton = $("#popButton");
  const balloon = $("#balloon");
  const balloonContainer = $("#balloonContainer");
  const prizeOverlay = $("#prizeOverlay");
  const historyBody = $("#historyBody");
  const statusText = $("#statusText");

  if (!jackpotEl || !timeEl || !userIdInput || !popButton || !balloon || !balloonContainer || !prizeOverlay || !historyBody || !statusText) return;

  const POP_LABEL  = CONFIG.labels.pop;
  const PICK_LABEL = CONFIG.labels.pick;
  const USED_TEXT  = CONFIG.labels.usedText;

  // ==========================================================
  // ‚úÖ Keys
  // ==========================================================
  const KEY_STATE = "lb_state_v6";
  const KEY_HISTORY = "lb_history_v6";
  const KEY_USED = "lb_used_users_v3";
  const KEY_ME = "lb_me_v1";
  const MAX_HISTORY = CONFIG.history.max;

  // ==========================================================
  // ‚úÖ Privacy / Hash
  // ==========================================================
  const PRIV_SALT_KEY = "lb_privacy_salt_v1";
  const getPrivacySalt = () => {
    let s = null;
    try { s = localStorage.getItem(PRIV_SALT_KEY); } catch {}
    if (!s) {
      s = String(Date.now()) + "-" + Math.random().toString(16).slice(2);
      try { localStorage.setItem(PRIV_SALT_KEY, s); } catch {}
    }
    return s;
  };
  const PRIV_SALT = getPrivacySalt();

  const hash32 = (str) => {
    let h = 2166136261;
    for (let i = 0; i < str.length; i++) {
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return h >>> 0;
  };

  const maskUserId = (raw) => {
    const s = String(raw || "").trim();
    if (!s) return "USER‚Ä¢‚Ä¢";
    const up = s.toUpperCase();
    if (up.length <= 3) return up[0] + "‚Ä¢‚Ä¢";
    const a = up.slice(0, 2);
    const b = up.slice(-2);
    return `${a}‚Ä¢‚Ä¢‚Ä¢‚Ä¢${b}`;
  };

  const userKeyOf = (raw) => {
    return hash32(`${String(raw || "").toLowerCase()}|${PRIV_SALT}`)
      .toString(36)
      .toUpperCase();
  };

  const makeHistoryItem = (rawUser, prizeText, ts, sim = false) => ({
    uk: userKeyOf(rawUser),
    user: maskUserId(rawUser),
    prize: prizeText || "0",
    ts: typeof ts === "number" ? ts : nowMs(),
    sim: !!sim
  });

  const rowKeyOf = (it) => `${it?.uk || "X"}|${it?.ts || 0}`;

  // ==========================================================
  // ‚úÖ ME INFO (buat klik history kamu)
  // ==========================================================
  let meInfo = LS.get(KEY_ME, null);
  if (!meInfo || typeof meInfo !== "object") meInfo = null;

  const setMeInfo = (uidRaw) => {
    const u = String(uidRaw || "").trim();
    if (!u) return;
    const data = { uk: userKeyOf(u), raw: u.toUpperCase() };
    meInfo = data;
    LS.set(KEY_ME, data);
  };

  const randomUserId = () => {
    const prefixes = ["PLAYER", "LUCKY", "USER", "POP", "BALLOON", "VIP", "WIN"];
    const p = prefixes[Math.floor(Math.random() * prefixes.length)];
    const n = Math.floor(1000 + Math.random() * 9000);
    return `${p}${n}`;
  };

  // ==========================================================
  // ‚úÖ Prize Pool
  // ==========================================================
  const prizePool = CONFIG.prizes.slice();

  const pickPrizeFromPool = () => {
    const r = Math.random();
    let acc = 0;
    for (let i = 0; i < prizePool.length; i++) {
      acc += prizePool[i].p;
      if (r <= acc) return prizePool[i].text;
    }
    return "0";
  };

  // ==========================================================
  // ‚úÖ State jackpot (smooth + safe)
  // ==========================================================
  const BASE_JACKPOT = CONFIG.jackpot.base;
  const RESET_JACKPOT_MIN = CONFIG.jackpot.minReset;
  const MAX_JACKPOT_SAFE = CONFIG.jackpot.maxSafe;

  let state = LS.get(KEY_STATE, null);

  if (!state || typeof state.jackpot !== "number") {
    state = {
      jackpot: BASE_JACKPOT,
      lastTick: nowMs(),
      rate: 95,
      lastRateAt: nowMs(),
      activeSim: 175,
      activeTotal: 0
    };
  }

  state.jackpot = clamp(Number(state.jackpot) || BASE_JACKPOT, RESET_JACKPOT_MIN, MAX_JACKPOT_SAFE);
  state.lastTick = Number(state.lastTick) || nowMs();
  state.rate = Number(state.rate) || 95;
  state.lastRateAt = Number(state.lastRateAt) || nowMs();
  state.activeSim = Number(state.activeSim) || 175;
  state.activeTotal = Number(state.activeTotal) || 0;

  const saveStateDebounced = debounce(() => LS.set(KEY_STATE, state), 520);

  // ==========================================================
  // ‚úÖ History normalize + dummy fill
  // ==========================================================
  let history = LS.get(KEY_HISTORY, []);
  if (!Array.isArray(history)) history = [];

  const normalizeHistory = () => {
    history = Array.isArray(history) ? history : [];

    history = history.map((it) => {
      if (it && it.uk && it.user && typeof it.ts === "number") {
        it.prize = it.prize ?? "0";
        it.sim = !!it.sim;
        return it;
      }
      const rawUser = it?.user || randomUserId();
      const prize = it?.prize ?? "0";
      const ts = typeof it?.ts === "number" ? it.ts : nowMs() - Math.floor(Math.random() * 180000);
      return makeHistoryItem(rawUser, prize, ts, true);
    });

    history.sort((a, b) => (b.ts || 0) - (a.ts || 0));
    if (history.length > MAX_HISTORY) history = history.slice(0, MAX_HISTORY);
  };

  normalizeHistory();

  if (history.length < MAX_HISTORY) {
    const need = MAX_HISTORY - history.length;
    const oldestTs = history.length ? history[history.length - 1].ts : nowMs();
    for (let i = 0; i < need; i++) {
      const ts = oldestTs - (need - i) * 2500;
      history.push(makeHistoryItem(randomUserId(), pickPrizeFromPool(), ts, true));
    }
    history.sort((a, b) => (b.ts || 0) - (a.ts || 0));
  }

  const saveHistoryDebounced = debounce(() => LS.set(KEY_HISTORY, history), 650);

  // ==========================================================
  // ‚úÖ Used Users (private hash only)
  // ==========================================================
  let usedMap = LS.get(KEY_USED, {});
  if (!usedMap || typeof usedMap !== "object") usedMap = {};
  const saveUsedDebounced = debounce(() => LS.set(KEY_USED, usedMap), 740);

  const cleanupUsedMap = () => {
    const t = nowMs();
    for (const k of Object.keys(usedMap)) {
      const v = usedMap[k];
      if (!v || typeof v !== "object") { delete usedMap[k]; continue; }
      if (v.status === "pending" && t - (v.at || 0) > 45_000) delete usedMap[k];
    }
    const keys = Object.keys(usedMap);
    if (keys.length > 3000) {
      keys.sort((a, b) => (usedMap[b]?.at || 0) - (usedMap[a]?.at || 0));
      for (let i = 3000; i < keys.length; i++) delete usedMap[keys[i]];
    }
  };
  cleanupUsedMap();

  const isUserUsed = (rawUid) => !!usedMap[userKeyOf(rawUid)];

  const markUserPending = (rawUid) => {
    usedMap[userKeyOf(rawUid)] = { status: "pending", at: nowMs() };
    saveUsedDebounced();
  };

  const markUserDone = (rawUid) => {
    usedMap[userKeyOf(rawUid)] = { status: "done", at: nowMs() };
    saveUsedDebounced();
  };

  const clearUserPending = (rawUid) => {
    const uk = userKeyOf(rawUid);
    const v = usedMap[uk];
    if (v && v.status === "pending") {
      delete usedMap[uk];
      saveUsedDebounced();
    }
  };

  // ==========================================================
  // ‚úÖ Active Players
  // ==========================================================
  const uniqueActivePlayers = (msWindow = 120_000) => {
    const t = nowMs();
    const set = new Set();
    for (let i = 0; i < history.length; i++) {
      const it = history[i];
      if (!it?.ts) continue;
      if (t - it.ts > msWindow) break;
      if (!it.sim && it.uk) set.add(it.uk);
    }
    return set.size;
  };

  const smoothActiveSim = () => {
    const target = CONFIG.online.min + Math.floor(Math.random() * (CONFIG.online.max - CONFIG.online.min + 1));
    state.activeSim = state.activeSim + (target - state.activeSim) * 0.070;
  };

  const calcTargetRate = () => {
    const activeReal = uniqueActivePlayers(120_000);
    smoothActiveSim();

    const activeTotal = clamp(Math.round(activeReal + state.activeSim), CONFIG.online.min, CONFIG.online.max);

    const base = 18 + Math.random() * 22;
    const factor = activeTotal * (0.12 + Math.random() * 0.18);
    const micro = Math.random() * 9;

    return { ratePerSec: base + factor + micro, activeTotal };
  };

  const updateRateIfNeeded = (t) => {
    if (t - state.lastRateAt < 1700) return;
    const { ratePerSec, activeTotal } = calcTargetRate();
    state.activeTotal = activeTotal;
    state.rate = state.rate + (ratePerSec - state.rate) * 0.075;
    state.lastRateAt = t;
  };

  const tickJackpot = () => {
    const t = nowMs();
    updateRateIfNeeded(t);

    let dt = (t - state.lastTick) / 1000;
    dt = Math.min(Math.max(dt, 0), 5);

    if (dt > 0.001) {
      state.jackpot = Math.min(MAX_JACKPOT_SAFE, state.jackpot + state.rate * dt);
      state.lastTick = t;
      saveStateDebounced();
    }
  };

  // ==========================================================
  // ‚úÖ STATUS SYSTEM (online only / used only)
  // ==========================================================
  let showUsedOnly = false;
  let displayedActive = state.activeTotal || 0;

  const setUsedStatus = (on) => {
    showUsedOnly = !!on;
    renderStatusNow();
  };

  const renderStatusNow = () => {
    statusText.classList.toggle("status-used", showUsedOnly);
    statusText.classList.toggle("status-online", !showUsedOnly);

    if (showUsedOnly) {
      statusText.innerHTML = `
        <span class="status-chip">
          <span class="status-dot"></span>
          <span>${USED_TEXT}</span>
        </span>
      `;
      return;
    }

    statusText.innerHTML = `
      <span class="status-chip">
        <span class="status-dot"></span>
        <span>Total Users Online</span>
        <span class="online-num">${Math.round(displayedActive)}</span>
      </span>
    `;
  };

  // ==========================================================
  // ‚úÖ Clock
  // ==========================================================
  const updateClock = () => {
    const d = new Date();
    timeEl.textContent = d.toTimeString().slice(0, 8);
  };

  // ==========================================================
  // ‚úÖ Render jackpot + online (super smooth)
  // ==========================================================
  let displayedJackpot = state.jackpot;
  let lastRenderAt = 0;

  const animateUI = (ts) => {
    if (ts - lastRenderAt > 125) {
      displayedJackpot = displayedJackpot + (state.jackpot - displayedJackpot) * 0.055;
      jackpotEl.textContent = formatRupiah(displayedJackpot);

      displayedActive = displayedActive + (state.activeTotal - displayedActive) * 0.14;
      renderStatusNow();

      lastRenderAt = ts;
    }
    requestAnimationFrame(animateUI);
  };

  updateClock();
  renderStatusNow();
  requestAnimationFrame(animateUI);

  // ==========================================================
  // ‚úÖ sanitize UserID
  // ==========================================================
  const sanitizeUserId = (v) => String(v || "").replace(/[^a-zA-Z0-9_-]/g, "").slice(0, 18);

  // ==========================================================
  // ‚úÖ checkReady
  // ==========================================================
  const checkReady = () => {
    const raw = userIdInput.value.trim();
    const uid = sanitizeUserId(raw);
    if (uid !== raw) userIdInput.value = uid;

    setUsedStatus(false);

    if (uid.length < 3) {
      popButton.disabled = true;
      popButton.textContent = POP_LABEL;
      return;
    }

    if (isUserUsed(uid)) {
      popButton.disabled = true;
      popButton.textContent = CONFIG.labels.usedBtn;
      setUsedStatus(true);
      return;
    }

    popButton.disabled = false;
    popButton.textContent = POP_LABEL;
  };

  userIdInput.addEventListener("input", checkReady);
  checkReady();

  // ==========================================================
  // ‚úÖ SOUND ENGINE (REAL FILES + BG LOOP)
  // ==========================================================
  let bgAudio = null;
  const sfxPools = Object.create(null);
  const POOL_SIZE = 4;

  const SND = CONFIG.sound || {};
  const soundEnabled = () => SND.enabled !== false;

  const FILES = (SND.files && typeof SND.files === "object") ? SND.files : {};
  const DEFAULT_FILES = {
    historyIn: "https://assets.mixkit.co/active_storage/sfx/2030/2030-preview.mp3"
  };

  const getUrl = (k) => {
    const u = FILES[k] || DEFAULT_FILES[k];
    return (typeof u === "string" && u.trim()) ? u.trim() : "";
  };

  const VOL = (k, fallback = 0.3) => {
    const v = Number(SND[k]);
    const master = clamp(Number(SND.master ?? 0.85), 0, 1);
    const raw = Number.isFinite(v) ? v : fallback;
    return clamp(raw * master, 0, 1);
  };

  const mkAudio = (src, { loop = false, volume = 0.3 } = {}) => {
    const a = new Audio();
    a.preload = "auto";
    a.src = src;
    a.loop = loop;
    a.volume = clamp(volume, 0, 1);
    a.crossOrigin = "anonymous";
    a.playsInline = true;
    return a;
  };

  const fadeVolume = (a, to, ms = 650) => {
    if (!a) return;
    const from = Number(a.volume || 0);
    const target = clamp(to, 0, 1);
    const start = performance.now();
    const dur = Math.max(120, ms);

    const step = (t) => {
      const p = clamp((t - start) / dur, 0, 1);
      a.volume = from + (target - from) * p;
      if (p < 1) requestAnimationFrame(step);
    };
    requestAnimationFrame(step);
  };

  const getPool = (key) => {
    const src = getUrl(key);
    if (!src) return null;

    const existing = sfxPools[key];
    if (existing && existing.src === src) return existing;

    const arr = [];
    for (let i = 0; i < POOL_SIZE; i++) arr.push(mkAudio(src, { loop: false, volume: 1 }));
    sfxPools[key] = { src, arr, idx: 0 };
    return sfxPools[key];
  };

  const playFromPool = async (key, vol) => {
    if (!soundEnabled()) return;
    const pool = getPool(key);
    if (!pool) return;

    const a = pool.arr[pool.idx++ % pool.arr.length];
    try {
      a.pause();
      a.currentTime = 0;
      a.volume = clamp(vol, 0, 1);
      await a.play();
    } catch {}
  };

  const startBg = async () => {
    if (!soundEnabled()) return;
    if (prefersReducedMotion) return;

    const src = getUrl("bg");
    if (!src) return;

    try {
      if (bgAudio && bgAudio.src && bgAudio.src.includes(src)) return;
    } catch {}

    try {
      if (bgAudio) {
        fadeVolume(bgAudio, 0, 180);
        setTimeout(() => { try { bgAudio.pause(); } catch {} }, 220);
      }
    } catch {}

    bgAudio = mkAudio(src, { loop: true, volume: 0 });

    try {
      await bgAudio.play();
      fadeVolume(bgAudio, VOL("bg", 0.10), 900);
    } catch {}
  };

  const pauseBg = () => {
    if (!bgAudio) return;
    try { bgAudio.pause(); } catch {}
  };

  const resumeBg = () => {
    if (!bgAudio) return;
    try { bgAudio.play().catch(() => {}); } catch {}
  };

  // ‚úÖ API sound yang dipakai script
  const sTap = () => playFromPool("tap", VOL("tap", 0.30));
  const sModalOpen = () => playFromPool("modalOpen", VOL("modal", 0.40));
  const sModalClose = () => playFromPool("modalClose", VOL("modal", 0.40));

  const sHistoryIn = (volOverride = null) => {
    const v = volOverride == null ? VOL("historyIn", 0.40) : clamp(volOverride, 0, 1);
    return playFromPool("historyIn", v);
  };

  const playPopSound = async () => {
    if (prefersReducedMotion) return;
    await playFromPool("pop", VOL("pop", 0.95));
  };

  // ‚úÖ unlock + start bg setelah interaksi pertama
  const primeAudioOnce = (() => {
    let done = false;
    return async () => {
      if (done) return;
      done = true;

      getPool("tap");
      getPool("pop");
      getPool("historyIn");
      getPool("modalOpen");
      getPool("modalClose");

      await startBg();
    };
  })();

  document.addEventListener("pointerdown", primeAudioOnce, { passive: true, once: true });
  balloonContainer.addEventListener("pointerdown", primeAudioOnce, { passive: true });
  popButton.addEventListener("pointerdown", primeAudioOnce, { passive: true });

  // ==========================================================
  // ‚úÖ Modal Lock Helper (scroll lock rapi)
  // ==========================================================
  const updateModalLock = () => {
    const anyOpen =
      !!document.querySelector(".result-pop.show") ||
      !!document.querySelector(".hmodal.show") ||
      !!document.querySelector(".claim-loading.show");

    document.documentElement.classList.toggle("modal-open", anyOpen);
    document.body.classList.toggle("modal-open", anyOpen);
  };

// ==========================================================
// ‚úÖ Result Hint Styles (PREMIUM CENTER + GLASS SHEEN)
// ==========================================================
const ensureResultHintStyles = () => {
  if (document.getElementById("lbResultHintStyle")) return;

  const st = document.createElement("style");
  st.id = "lbResultHintStyle";
  st.textContent = `
.result-hint{
  margin-top: 12px;
  padding: 12px 14px;
  border-radius: 16px;
  position: relative;
  overflow: hidden;

  /* ‚úÖ premium glass */
  background:
    radial-gradient(120% 120% at 50% -10%,
      rgba(255,255,255,.78) 0%,
      rgba(255,255,255,0) 55%
    ),
    linear-gradient(180deg,
      rgba(255,255,255,.92) 0%,
      rgba(233,246,255,.86) 100%
    );

  border: 1px solid rgba(30,167,255,.22);
  box-shadow:
    0 20px 48px rgba(12,35,64,.10),
    0 0 0 1px rgba(255,255,255,.55) inset;

  /* ‚úÖ center rapih */
  text-align: center;
  color: rgba(12,35,64,.72);
  font-size: .86rem;
  line-height: 1.35;
  letter-spacing: .15px;
}

/* glow highlight halus di atas */
.result-hint::before{
  content:"";
  position:absolute;
  inset:-2px;
  pointer-events:none;
  background: radial-gradient(70% 90% at 50% 0%,
    rgba(30,167,255,.20) 0%,
    rgba(30,167,255,0) 62%
  );
  opacity: .9;
}

/* ‚úÖ sheen jalan pelan (premium) */
.result-hint::after{
  content:"";
  position:absolute;
  top:-55%;
  left:-60%;
  width: 52%;
  height: 220%;
  pointer-events:none;
  background: linear-gradient(90deg,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,.55) 50%,
    rgba(255,255,255,0) 100%
  );
  opacity: .28;
  transform: rotate(18deg);
  animation: hintSheen 3.6s linear infinite;
}

@keyframes hintSheen{
  0%   { transform: translateX(0) rotate(18deg); }
  100% { transform: translateX(235%) rotate(18deg); }
}

.result-hint b{
  color: rgba(12,35,64,.95);
  font-weight: 1000;
}

.result-hint .hint-uid{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;

  margin-top: 8px;
  padding: 6px 12px;
  border-radius: 999px;

  background:
    radial-gradient(120% 140% at 30% 15%,
      rgba(255,255,255,.95) 0%,
      rgba(255,255,255,0) 55%
    ),
    rgba(12,35,64,.05);

  border: 1px solid rgba(12,35,64,.12);
  box-shadow:
    0 12px 26px rgba(12,35,64,.10),
    0 0 0 1px rgba(255,255,255,.55) inset;

  font-weight: 1000;
  letter-spacing: .45px;
  color: rgba(12,35,64,.92);
  white-space: nowrap;
}

.result-hint .hint-uid::before{
  content:"";
  width: 7px;
  height: 7px;
  border-radius: 999px;
  background: rgba(30,167,255,.95);
  box-shadow: 0 0 0 3px rgba(30,167,255,.16);
}

/* aksesibilitas */
@media (prefers-reduced-motion: reduce){
  .result-hint::after{ animation: none !important; opacity: .18; }
}
`;
  document.head.appendChild(st);
};
ensureResultHintStyles();

// ==========================================================
// ‚úÖ History Styles (Injected) ‚Äî SYNC dengan CSS terbaru (Row highlight MENYATU)
// ==========================================================
const ensureHistoryUIStyles = () => {
  if (document.getElementById("lbHistoryUIStyle")) return;

  const st = document.createElement("style");
  st.id = "lbHistoryUIStyle";
  st.textContent = `
/* ==========================================================
   ‚úÖ Table helpers (jangan bikin highlight pecah)
   ========================================================== */
.history td{ vertical-align: middle; }

/* tombol user */
.h-userbtn{
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  gap:2px;

  width:100%;
  border:0;
  background:transparent;
  padding:0;
  margin:0;

  text-align:left;
  color:inherit;
  font:inherit;

  cursor:default;
}
.h-userbtn.is-me{ cursor:pointer; }

/* 1 baris user + badge */
.h-userrow{
  display:inline-flex;
  align-items:center;
  gap:8px;

  font-weight:900;
  letter-spacing:.15px;
  line-height:1.1;
}

/* badge kecil */
.h-userbadge{
  font-size:.68rem;
  font-weight:900;
  padding:3px 8px;
  border-radius:999px;

  background: rgba(30,167,255,.12);
  border: 1px solid rgba(30,167,255,.22);
  color: rgba(12,35,64,.85);
  box-shadow: 0 10px 28px rgba(30,167,255,.14);
  letter-spacing:.2px;
}

/* tanggal jam */
.h-time{
  font-size:.76rem;
  opacity:.68;
  line-height:1.15;
  white-space:nowrap;
}

/* ==========================================================
   ‚úÖ ROW HIGHLIGHT: MENYATU FULL BARIS (PENTING!)
   - Jangan kasih background ke TD lagi
   ========================================================== */
.history tbody tr{
  position:relative;
}

/* ‚úÖ row-me highlight menyatu */
.history tbody tr.row-me{
  background: linear-gradient(90deg,
    rgba(30,167,255,.14) 0%,
    rgba(30,167,255,.08) 55%,
    rgba(30,167,255,0) 100%
  );
}

/* ‚úÖ accent kiri untuk row-me */
.history tbody tr.row-me td:first-child{
  position:relative;
}
.history tbody tr.row-me td:first-child::before{
  content:"";
  position:absolute;
  left:0;
  top:8px;
  bottom:8px;
  width:3px;
  border-radius:999px;

  background: rgba(30,167,255,.90);
  box-shadow: 0 0 0 4px rgba(30,167,255,.12);
}

/* ‚úÖ row-new highlight menyatu + clean (tanpa kotak per kolom) */
.history tbody tr.row-new{
  background: linear-gradient(90deg,
    rgba(30,167,255,.22) 0%,
    rgba(30,167,255,.10) 48%,
    rgba(30,167,255,0) 100%
  );
  animation: lbRowNewPulse .65s cubic-bezier(.22,1,.36,1) both;
}

/* accent kiri untuk row-new */
.history tbody tr.row-new td:first-child{
  position:relative;
}
.history tbody tr.row-new td:first-child::before{
  content:"";
  position:absolute;
  left:0;
  top:8px;
  bottom:8px;
  width:3px;
  border-radius:999px;

  background: rgba(30,167,255,.98);
  box-shadow: 0 0 0 4px rgba(30,167,255,.16);
}

/* glow tipis biar terasa ‚Äúbaru‚Äù tapi tetap premium */
.history tbody tr.row-new{
  box-shadow: 0 0 0 1px rgba(30,167,255,.10) inset;
}

@keyframes lbRowNewPulse{
  0%   { filter: saturate(1.15) brightness(1.06); }
  100% { filter: saturate(1) brightness(1); }
}

@media (prefers-reduced-motion: reduce){
  .history tbody tr.row-new{ animation:none !important; }
}

/* ==========================================================
   ‚úÖ Modal History (tetap premium & nyambung)
   ========================================================== */
.hmodal{
  position:fixed;
  inset:0;
  z-index:100001;
  display:grid;
  place-items:center;
  padding:18px;

  background: rgba(12,35,64,.32);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);

  opacity:0;
  pointer-events:none;
  transition: opacity .22s ease;
}
.hmodal.show{
  opacity:1;
  pointer-events:auto;
}

.hmodal-card{
  width:min(380px,92vw);
  border-radius:22px;
  overflow:hidden;

  background:
    radial-gradient(900px 420px at 50% -12%,
      rgba(30,167,255,.18) 0%,
      rgba(30,167,255,0) 60%
    ),
    linear-gradient(180deg,
      rgba(255,255,255,.96) 0%,
      rgba(233,246,255,.92) 100%
    );

  border: 1px solid rgba(255,255,255,.86);
  box-shadow:
    0 38px 90px rgba(12,35,64,.22),
    0 0 0 1px rgba(30,167,255,.12) inset;

  transform: translateY(10px) scale(.985);
  transition: transform .22s cubic-bezier(.22,1,.36,1);
}
.hmodal.show .hmodal-card{
  transform: translateY(0) scale(1);
}

.hmodal-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 14px 10px;
}
.hmodal-title{
  font-weight:1000;
  font-size:1.02rem;
  color:#0c2340;
  letter-spacing:.2px;
}

.hmodal-x{
  width:38px;
  height:38px;
  border-radius:12px;

  border:1px solid rgba(12,35,64,.10);
  background: rgba(255,255,255,.88);
  cursor:pointer;

  font-weight:1000;
  color: rgba(12,35,64,.74);
  box-shadow: 0 14px 30px rgba(12,35,64,.10);
}

.hmodal-body{ padding: 6px 14px 16px; }

.hm-big{
  font-weight:1000;
  font-size:1.2rem;
  color:#0c2340;
  margin-bottom:10px;
}

.hm-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;

  padding:10px 12px;
  border-radius:16px;

  background: rgba(255,255,255,.76);
  border: 1px solid rgba(12,35,64,.08);
  margin-top:8px;
}

.hm-k{
  font-size:.84rem;
  color: rgba(12,35,64,.62);
  font-weight:800;
}
.hm-v{
  font-size:.92rem;
  color: rgba(12,35,64,.92);
  font-weight:1000;
  text-align:right;
  max-width:60%;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

@media (prefers-reduced-motion: reduce){
  .hmodal, .hmodal-card{ transition:none !important; }
}
  `;
  document.head.appendChild(st);
};

ensureHistoryUIStyles();

// ==========================================================
// ‚úÖ History Render ‚Äî REALTIME FLIP (modal-aware + pending highlight)
// ==========================================================
let lastTopSig = "";
let lastHistSoundAt = 0;

// ‚úÖ Row baru yang masuk saat Result modal open ‚Üí ditahan highlight-nya
const pendingNewKeys = new Set();

// ‚úÖ coalesce render biar super smooth
let histRaf = 0;
let queuedHistOpts = null;

const isResultModalOpen = () => {
  // deteksi umum (punya kamu biasanya pakai modal-open)
  if (document.documentElement.classList.contains("modal-open")) return true;
  if (document.body.classList.contains("modal-open")) return true;

  // deteksi result popup (kalau struktur kamu pakai .result-pop)
  const el = document.querySelector(".result-pop.show, .result-pop[aria-hidden='false'], .result-pop.is-open");
  return !!el;
};

const canPlayHistorySfx = () => {
  if (!soundEnabled()) return false;
  if (document.hidden) return false;
  return true;
};

const playHistoryIncomingSound = (meta = { sim:false, me:false }) => {
  if (!canPlayHistorySfx()) return;

  const t = nowMs();
  if (t - lastHistSoundAt < 900) return; // ‚úÖ throttle anti spam
  lastHistSoundAt = t;

  // ‚úÖ kalau result modal lagi terbuka, lebih halus biar tidak ganggu
  const modalOpen = isResultModalOpen();
  const base = meta.sim ? 0.28 : 0.40;
  const vol = VOL("historyIn", modalOpen ? Math.min(base, 0.22) : base);
  sHistoryIn(vol);
};

const captureRowRects = () => {
  const map = new Map();
  const rows = Array.from(historyBody.querySelectorAll("tr[data-key]"));
  for (const r of rows) {
    const k = r.dataset.key || "";
    if (!k) continue;
    map.set(k, r.getBoundingClientRect());
  }
  return map;
};

const animateFLIP = (prevRects, highlightKeys) => {
  if (prefersReducedMotion) return;

  const hl = highlightKeys instanceof Set ? highlightKeys : new Set();
  const rows = Array.from(historyBody.querySelectorAll("tr[data-key]"));

  for (const r of rows) {
    const k = r.dataset.key || "";
    if (!k) continue;

    const prev = prevRects && prevRects.get ? prevRects.get(k) : null;
    const next = r.getBoundingClientRect();

    // ‚úÖ FLIP untuk geser turun halus
    if (prev) {
      const dx = prev.left - next.left;
      const dy = prev.top - next.top;

      if (Math.abs(dx) > 0.5 || Math.abs(dy) > 0.5) {
        r.animate(
          [
            { transform: `translate3d(${dx}px, ${dy}px, 0)` },
            { transform: "translate3d(0,0,0)" }
          ],
          { duration: 280, easing: "cubic-bezier(0.22, 1, 0.36, 1)" }
        );
      }
    } else {
      // ‚úÖ row benar-benar baru (key belum ada sebelumnya)
      r.animate(
        [
          { transform: "translate3d(0,-12px,0)", opacity: 0.0 },
          { transform: "translate3d(0,0,0)", opacity: 1.0 }
        ],
        { duration: 340, easing: "cubic-bezier(0.22, 1, 0.36, 1)" }
      );
    }

    // ‚úÖ Highlight row (termasuk pending yang baru muncul setelah modal ditutup)
    if (hl.has(k)) {
      r.classList.add("row-new");
      setTimeout(() => r.classList.remove("row-new"), 1600);
    }
  }
};

const mergeHistOpts = (a, b) => {
  const A = a || {};
  const B = b || {};
  return {
    playSoundIfNewTop: !!(A.playSoundIfNewTop || B.playSoundIfNewTop),
    meta: B.meta || A.meta || null,
    revealPending: !!(A.revealPending || B.revealPending),
  };
};

const queueRenderHistory = (opts = {}) => {
  queuedHistOpts = mergeHistOpts(queuedHistOpts, opts);

  if (histRaf) return;
  histRaf = requestAnimationFrame(() => {
    histRaf = 0;
    const finalOpts = queuedHistOpts || {};
    queuedHistOpts = null;
    renderHistory(finalOpts);
  });
};

const renderHistory = (opts = { playSoundIfNewTop: false, meta: null, revealPending: false }) => {
  // ‚úÖ modal aware
  const modalOpen = isResultModalOpen();

  // ‚úÖ ambil prev key dulu (biar bisa deteksi new keys walaupun kita skip rect)
  const prevKeySet = new Set();
  for (const r of historyBody.querySelectorAll("tr[data-key]")) {
    const k = r.dataset.key || "";
    if (k) prevKeySet.add(k);
  }

  // ‚úÖ rect untuk FLIP hanya kalau modal tidak menutup layar (biar hemat & gak sia-sia)
  const shouldAnimate = !prefersReducedMotion && !modalOpen;
  const prevRects = shouldAnimate ? captureRowRects() : null;

  historyBody.innerHTML = "";
  const frag = document.createDocumentFragment();

  const topItem = history[0];
  const topSig = topItem ? `${topItem.uk}|${topItem.ts}|${topItem.prize}` : "";

  // ‚úÖ highlightKeys: row yang akan di-highlight sekarang
  const highlightKeys = new Set();

  for (let i = 0; i < history.length; i++) {
    const item = history[i];
    const tr = document.createElement("tr");
    tr.dataset.idx = String(i);

    const key = rowKeyOf(item);
    tr.dataset.key = key;

    const isMe = !!(meInfo && item && item.uk && meInfo.uk === item.uk);
    if (isMe) tr.classList.add("row-me");

    // ‚úÖ NEW DETECTOR (modal aware)
    const isNewNow = !prevKeySet.has(key);

    if (isNewNow && modalOpen) {
      // row baru masuk tapi ketutup result ‚Üí simpan utk nanti
      pendingNewKeys.add(key);
    } else {
      // kalau modal sudah tidak nutup, row baru/pending ‚Üí highlight sekarang
      if (isNewNow) highlightKeys.add(key);
      if (!modalOpen && pendingNewKeys.has(key)) {
        highlightKeys.add(key);
        pendingNewKeys.delete(key);
      }
      if (!modalOpen && opts.revealPending && pendingNewKeys.has(key)) {
        highlightKeys.add(key);
        pendingNewKeys.delete(key);
      }
    }

    const tdNo = document.createElement("td");
    tdNo.textContent = String(i + 1);

    const tdUser = document.createElement("td");
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "h-userbtn" + (isMe ? " is-me" : "");
    if (isMe) btn.dataset.me = "1";

    const userRow = document.createElement("div");
    userRow.className = "h-userrow";

    const userName = document.createElement("span");
    userName.textContent = isMe ? String(meInfo.raw || "").toUpperCase() : String(item.user || "");
    userRow.appendChild(userName);

    if (isMe) {
      const badge = document.createElement("span");
      badge.className = "h-userbadge";
      badge.textContent = "KAMU";
      userRow.appendChild(badge);
    }

    const timeLine = document.createElement("div");
    timeLine.className = "h-time";
    timeLine.textContent = formatHistoryDateTime(item.ts);

    btn.appendChild(userRow);
    btn.appendChild(timeLine);
    tdUser.appendChild(btn);

    const tdPrize = document.createElement("td");
    tdPrize.textContent = item.prize === "0" ? "0" : String(item.prize);
    if (item.prize !== "0") tdPrize.classList.add("win");

    tr.appendChild(tdNo);
    tr.appendChild(tdUser);
    tr.appendChild(tdPrize);
    frag.appendChild(tr);
  }

  historyBody.appendChild(frag);

  // ‚úÖ Smooth anim turun + highlight hanya kalau memang terlihat (modal tidak nutup)
  if (shouldAnimate) {
    requestAnimationFrame(() => animateFLIP(prevRects, highlightKeys));
  } else {
    // ‚úÖ modal nutup ‚Üí tetap update data, highlight ditahan sampai modal close
    // (biar user benar-benar LIHAT highlight nya)
  }

  // ‚úÖ sound notif kalau top berubah (history baru masuk)
  if (opts.playSoundIfNewTop && topSig && topSig !== lastTopSig) {
    const meta = opts.meta || { sim: true, me: false };
    playHistoryIncomingSound(meta);
  }

  lastTopSig = topSig;
  saveHistoryDebounced();
};

// ‚úÖ initial render
queueRenderHistory({ playSoundIfNewTop: false });


// ‚úÖ watcher: begitu Result modal ditutup ‚Üí langsung tampilkan highlight pending
(() => {
  let prevOpen = isResultModalOpen();

  const onTick = () => {
    const nowOpen = isResultModalOpen();
    if (prevOpen && !nowOpen) {
      if (pendingNewKeys.size) {
        queueRenderHistory({ playSoundIfNewTop: false, revealPending: true });
      }
    }
    prevOpen = nowOpen;
  };

  try{
    const mo = new MutationObserver(onTick);
    mo.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] });
    mo.observe(document.body, { attributes: true, attributeFilter: ["class"] });

    const rp = document.querySelector(".result-pop");
    if (rp) mo.observe(rp, { attributes: true, attributeFilter: ["class", "style", "aria-hidden"] });
  }catch(_){}

  // fallback ringan (kalau modal di-recreate via JS)
  setInterval(onTick, 550);
})();


// ==========================================================
// ‚úÖ Push History Top (render via queue biar super smooth)
// ==========================================================
const pushHistoryTop = (rawUser, prizeText, sim = false, ts = nowMs()) => {
  const item = makeHistoryItem(rawUser, prizeText, ts, sim);
  history.unshift(item);
  if (history.length > MAX_HISTORY) history.pop();

  const isMe = !!(meInfo && item.uk && meInfo.uk === item.uk);

  // ‚úÖ SOUND tiap ada history baru (sim & real)
  queueRenderHistory({
    playSoundIfNewTop: true,
    meta: { sim: !!sim, me: !!isMe }
  });
};


// ==========================================================
// ‚úÖ Live Simulation history (tetap update walau Result tampil)
// ==========================================================
let liveTimer = null;
const scheduleLiveHistory = () => {
  if (!CONFIG.history.liveSim) return;
  if (liveTimer) clearTimeout(liveTimer);

  const delay =
    CONFIG.history.liveMinDelay +
    Math.floor(Math.random() * (CONFIG.history.liveMaxDelay - CONFIG.history.liveMinDelay + 1));

  liveTimer = setTimeout(() => {
    if (!document.hidden) {
      // ‚úÖ tetap push walaupun Result popup sedang tampil
      pushHistoryTop(randomUserId(), pickPrizeFromPool(), true, nowMs());
    }
    scheduleLiveHistory();
  }, delay);
};
scheduleLiveHistory();

// ==========================================================
// ‚úÖ MODAL DETAIL HISTORY (klik username kamu) ‚Äî PREMIUM (NO CLOSE BUTTON)
// ==========================================================
const ensureHistoryModal = () => {
  // ‚úÖ premium style patch (override dari style lama)
  if (!document.getElementById("lbHistoryModalPremiumStyle")) {
    const st = document.createElement("style");
    st.id = "lbHistoryModalPremiumStyle";
    st.textContent = `
/* =======================
   Premium History Modal
   ======================= */
.hmodal{
  background: rgba(7, 22, 42, .28) !important;
}
.hmodal.show{
  animation: hmodalFade .18s ease both;
}
@keyframes hmodalFade{
  from{ opacity: .0; }
  to{ opacity: 1; }
}

.hmodal-card{
  width: min(380px, 92vw) !important;
  border-radius: 24px !important;

  /* glass premium */
  background:
    radial-gradient(1200px 520px at 50% -25%,
      rgba(30,167,255,.22),
      rgba(255,255,255,0) 55%),
    linear-gradient(180deg,
      rgba(255,255,255,.94),
      rgba(245,252,255,.86));

  border: 1px solid rgba(255,255,255,.72) !important;
  box-shadow:
    0 32px 110px rgba(7,22,42,.26),
    0 12px 34px rgba(30,167,255,.14);
  position: relative;
  overflow: hidden;

  transform: translateY(12px) scale(.985);
  animation: hmodalInPremium .22s cubic-bezier(.22,1,.36,1) forwards;
}
@keyframes hmodalInPremium{
  to{ transform: translateY(0) scale(1); }
}

.hmodal-card::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    linear-gradient(110deg,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,.62) 18%,
      rgba(255,255,255,0) 36%);
  transform: translateX(-120%);
  animation: hmodalSheen 1.2s cubic-bezier(.22,1,.36,1) both;
  opacity: .55;
}
@keyframes hmodalSheen{
  to{ transform: translateX(120%); }
}

.hmodal-head{
  padding: 16px 16px 12px !important;
  border-bottom: 1px solid rgba(12,35,64,.06) !important;
  position: relative;
}
.hmodal-head::after{
  content:"";
  position:absolute;
  left: 16px;
  right: 16px;
  bottom: -1px;
  height: 2px;
  border-radius: 999px;
  background: linear-gradient(90deg,
    rgba(30,167,255,0),
    rgba(30,167,255,.70),
    rgba(30,167,255,0));
  opacity: .65;
}

.hmodal-title{
  display:flex;
  align-items:center;
  gap: 10px;
  font-weight: 1000 !important;
  letter-spacing: .25px;
  font-size: 1.02rem;
  color: #0c2340;
}
.hmodal-title::before{
  content:"";
  width: 11px;
  height: 11px;
  border-radius: 999px;
  background: radial-gradient(circle at 30% 30%,
    rgba(255,255,255,.95),
    rgba(30,167,255,.95));
  box-shadow:
    0 0 0 3px rgba(30,167,255,.14),
    0 10px 18px rgba(30,167,255,.20);
}

.hmodal-sub{
  margin-top: 6px;
  font-size: .78rem;
  opacity: .60;
  font-weight: 800;
  color: #0c2340;
}

.hmodal-body{
  padding: 14px 16px 16px !important;
}

.hm-big{
  font-weight: 1000 !important;
  font-size: 1.14rem !important;
  color: #0c2340;
  margin-bottom: 10px;
  letter-spacing: .35px;
}

.hm-row{
  background:
    radial-gradient(600px 220px at 30% 0%,
      rgba(30,167,255,.18),
      rgba(30,167,255,.06) 55%,
      rgba(255,255,255,0) 100%),
    rgba(30,167,255,.055) !important;
  border: 1px solid rgba(30,167,255,.18) !important;
  box-shadow:
    0 14px 34px rgba(30,167,255,.08);
  border-radius: 16px !important;
  padding: 11px 12px !important;
}

.hm-k{
  opacity: .62 !important;
  font-weight: 900 !important;
  letter-spacing: .2px;
}

.hm-v{
  font-weight: 1000 !important;
  color: #0c2340;
}

.hm-hint{
  margin-top: 12px;
  font-size: .78rem;
  opacity: .55;
  font-weight: 800;
  text-align: center;
}

@media (prefers-reduced-motion: reduce){
  .hmodal.show{ animation:none !important; }
  .hmodal-card{ animation:none !important; transform:none !important; }
  .hmodal-card::before{ animation:none !important; }
}
    `;
    document.head.appendChild(st);
  }

  let root = document.getElementById("historyModal");
  if (root) return root;

  root = document.createElement("div");
  root.id = "historyModal";
  root.className = "hmodal";
  root.innerHTML = `
    <div class="hmodal-card" role="dialog" aria-modal="true" aria-label="Detail Riwayat">
      <div class="hmodal-head">
        <div class="hmodal-title">Detail Riwayat</div>
      </div>

      <div class="hmodal-body">
        <div class="hm-big" id="hmUser">-</div>

        <div class="hm-row">
          <div class="hm-k">Hadiah</div>
          <div class="hm-v" id="hmPrize">-</div>
        </div>

        <div class="hm-row">
          <div class="hm-k">Waktu</div>
          <div class="hm-v" id="hmTime">-</div>
        </div>

        <div class="hm-hint">Klik area luar untuk menutup</div>
      </div>
    </div>
  `;

  // ‚úÖ close: klik overlay
  root.addEventListener("click", (e) => {
    if (e.target === root) hideHistoryModal();
  });

  // ‚úÖ close: ESC
  if (!root.dataset.bindEsc) {
    root.dataset.bindEsc = "1";
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        hideHistoryModal();
        // kalau kamu masih mau ESC juga nutup result, biarkan ini:
        hideResultPopup?.();
      }
    });
  }

  document.body.appendChild(root);
  return root;
};

const showHistoryModal = ({ uid, prize, ts }) => {
  const root = ensureHistoryModal();
  const u = root.querySelector("#hmUser");
  const p = root.querySelector("#hmPrize");
  const t = root.querySelector("#hmTime");

  if (u) u.textContent = String(uid || "-").toUpperCase();
  if (p) p.textContent = String(prize ?? "0");
  if (t) t.textContent = formatHistoryDateTime(ts);

  root.classList.add("show");
  updateModalLock?.();
};

function hideHistoryModal(){
  const root = document.getElementById("historyModal");
  if (!root) return;
  root.classList.remove("show");
  updateModalLock?.();
  sModalClose?.();
}

// ‚úÖ click username kamu (is-me) -> show modal
historyBody.addEventListener("click", (e) => {
  const btn = e.target.closest(".h-userbtn.is-me");
  if (!btn) return;

  const tr = btn.closest("tr");
  const idx = tr ? Number(tr.dataset.idx || "0") : 0;
  const it = history[idx];
  if (!it) return;

  sModalOpen?.();
  showHistoryModal({
    uid: (meInfo && meInfo.raw) ? meInfo.raw : "-",
    prize: it.prize,
    ts: it.ts
  });
});

  // ==========================================================
  // ‚úÖ Balloon system (PERMANEN HILANG)
  // ==========================================================
  const getBalloonItems = () => $$(".balloon-item", balloon);

  const vanishBalloon = (el) => {
    if (!el) return;
    el.style.pointerEvents = "none";
    el.style.willChange = "transform, opacity, filter";
    el.style.transition =
      "transform 520ms cubic-bezier(0.22, 1, 0.36, 1), opacity 420ms ease, filter 520ms ease";

    requestAnimationFrame(() => {
      el.style.transform = "translate3d(-50%, -50%, 0) scale(0.06)";
      el.style.opacity = "0";
      el.style.filter = "blur(2px)";
    });

    setTimeout(() => { try { el.remove(); } catch {} }, 560);
  };

  const checkBalloonLeft = () => {
    if (getBalloonItems().length > 0) return;
    setPickMode(false);
    popButton.disabled = true;
    popButton.textContent = CONFIG.labels.empty;
  };

  // ==========================================================
  // ‚úÖ Smooth Helpers (timers lebih rapi + anti nabrak)
  // ==========================================================
  const __timers = new Set();
  const later = (ms, fn) => {
    const id = setTimeout(() => {
      __timers.delete(id);
      try { fn(); } catch {}
    }, Math.max(0, ms | 0));
    __timers.add(id);
    return id;
  };
  const clearAllLaters = () => {
    __timers.forEach(clearTimeout);
    __timers.clear();
  };

  // ==========================================================
  // ‚úÖ Confetti (UPGRADE: ALWAYS ON TOP of RESULT MODAL)
  // ==========================================================
  let __sideConfettiUntil = 0;

  // ‚úÖ harus lebih tinggi dari modal result + claim loading
  const CONFETTI_Z = 100500;

  const confettiSafe = () => {
    if (prefersReducedMotion) return null;
    if (typeof window.confetti !== "function") return null;
    return window.confetti;
  };

  const confettiBurstAt = (x, y, opt = {}) => {
    const cf = confettiSafe();
    if (!cf) return;

    const baseCount = Number(opt.particleCount ?? (isSmallDevice ? 70 : 95));
    const spread = Number(opt.spread ?? 38);
    const startVelocity = Number(opt.startVelocity ?? 28);
    const gravity = Number(opt.gravity ?? 0.95);
    const ticks = Number(opt.ticks ?? 170);
    const scalar = Number(opt.scalar ?? 0.9);

    cf({
      particleCount: baseCount,
      spread,
      startVelocity,
      gravity,
      ticks,
      origin: { x, y },
      shapes: opt.shapes || ["square"],
      scalar,
      zIndex: Number(opt.zIndex ?? CONFETTI_Z) // ‚úÖ ON TOP
    });

    later(95, () => {
      const cf2 = confettiSafe();
      if (!cf2) return;
      cf2({
        particleCount: Number(opt.particleCount2 ?? (isSmallDevice ? 52 : 70)),
        spread: Number(opt.spread2 ?? 52),
        startVelocity: Number(opt.startVelocity2 ?? 32),
        gravity: Number(opt.gravity2 ?? 1.05),
        ticks: Number(opt.ticks2 ?? 185),
        origin: { x, y },
        shapes: opt.shapes2 || ["square"],
        scalar: Number(opt.scalar2 ?? 0.85),
        zIndex: Number(opt.zIndex ?? CONFETTI_Z) // ‚úÖ ON TOP
      });
    });

    later(180, () => {
      const cf3 = confettiSafe();
      if (!cf3) return;
      cf3({
        particleCount: Number(opt.particleCount3 ?? (isSmallDevice ? 26 : 35)),
        spread: Number(opt.spread3 ?? 22),
        startVelocity: Number(opt.startVelocity3 ?? 18),
        gravity: Number(opt.gravity3 ?? 0.75),
        ticks: Number(opt.ticks3 ?? 140),
        origin: { x, y },
        shapes: opt.shapes3 || ["square"],
        scalar: Number(opt.scalar3 ?? 0.8),
        zIndex: Number(opt.zIndex ?? CONFETTI_Z) // ‚úÖ ON TOP
      });
    });
  };

  // ‚úÖ Confetti dari kiri + kanan layar (paling depan)
  const confettiSideCannons = (opt = {}) => {
    const cf = confettiSafe();
    if (!cf) return;

    const now = performance.now();
    if (now < __sideConfettiUntil) return;

    const durationMs = Math.max(260, Number(opt.durationMs ?? (isSmallDevice ? 720 : 860)));
    __sideConfettiUntil = now + durationMs + 80;

    const end = now + durationMs;

    const spread = Number(opt.spread ?? (isSmallDevice ? 62 : 68));
    const gravity = Number(opt.gravity ?? 1.15);
    const ticks = Number(opt.ticks ?? (isSmallDevice ? 220 : 260));
    const startVelocity = Number(opt.startVelocity ?? (isSmallDevice ? 34 : 38));
    const scalar = Number(opt.scalar ?? (isSmallDevice ? 0.82 : 0.95));
    const xOffset = Number(opt.xOffset ?? 0.02);

    const yMin = Number(opt.yMin ?? 0.22);
    const yMax = Number(opt.yMax ?? 0.72);

    const base = Number(opt.baseCount ?? (isSmallDevice ? 14 : 18));
    const shapes = opt.shapes || ["square", "circle"];
    const zIndex = Number(opt.zIndex ?? CONFETTI_Z); // ‚úÖ ON TOP

    const frame = () => {
      const t = performance.now();
      const left = Math.max(0, end - t);

      const prog = 1 - left / durationMs;
      const boost = 1 - Math.min(1, prog * 0.7);
      const count = Math.max(6, Math.round(base * boost));

      const y = yMin + Math.random() * (yMax - yMin);

      cf({
        particleCount: count,
        angle: 60,
        spread,
        startVelocity,
        gravity,
        ticks,
        origin: { x: xOffset, y },
        scalar,
        shapes,
        zIndex
      });

      cf({
        particleCount: count,
        angle: 120,
        spread,
        startVelocity,
        gravity,
        ticks,
        origin: { x: 1 - xOffset, y },
        scalar,
        shapes,
        zIndex
      });

      if (t < end) requestAnimationFrame(frame);
    };

    requestAnimationFrame(frame);
  };

  const confettiOnResultPopup = () => {
    if (prefersReducedMotion) return;

    confettiSideCannons({ zIndex: CONFETTI_Z });

    later(40, () => confettiBurstAt(0.5, 0.12, {
      particleCount: isSmallDevice ? 48 : 66,
      spread: 55,
      startVelocity: isSmallDevice ? 22 : 26,
      gravity: 0.95,
      ticks: isSmallDevice ? 160 : 185,
      shapes: ["square", "circle"],
      scalar: isSmallDevice ? 0.82 : 0.9,
      zIndex: CONFETTI_Z
    }));
  };

  // ==========================================================
  // ‚úÖ Prize Logic
  // ==========================================================
  const decidePrize = () => {
    if (Math.random() < CONFIG.jackpot.jackpotChance) {
      state.jackpot = CONFIG.jackpot.minReset;
      saveStateDebounced();
      return "JACKPOT!";
    }
    return pickPrizeFromPool();
  };

  // ==========================================================
  // ‚úÖ Flow: klik tombol -> pick mode -> klik balon -> pop
  // ==========================================================
  let isPopping = false;
  let isArmedPick = false;

  const setPickMode = (on) => {
    isArmedPick = !!on;
    balloon.classList.toggle("pick-mode", isArmedPick);

    getBalloonItems().forEach((b) => b.classList.toggle("is-pick", isArmedPick));

    if (!showUsedOnly && !isPopping && !popButton.disabled) {
      popButton.textContent = isArmedPick ? PICK_LABEL : POP_LABEL;
    }

    if (isArmedPick) sTap();
  };

  const showPrizeAtPoint = (text, x, y) => {
    prizeOverlay.textContent = text;

    // ‚úÖ lebih smooth (GPU)
    prizeOverlay.style.position = "fixed";
    prizeOverlay.style.left = (x * window.innerWidth) + "px";
    prizeOverlay.style.top = (y * window.innerHeight) + "px";
    prizeOverlay.style.transform = "translate3d(-50%, -50%, 0)";
    prizeOverlay.style.pointerEvents = "none";
    prizeOverlay.style.willChange = "transform, opacity";

    prizeOverlay.classList.add("show");
  };

  const resetAfterPop = () => {
    prizeOverlay.classList.remove("show");
    prizeOverlay.textContent = "";
    prizeOverlay.removeAttribute("style");

    isPopping = false;
    setPickMode(false);

    checkReady();
    checkBalloonLeft();
  };

  const popChosenBalloon = async (chosenEl) => {
    const uid = sanitizeUserId(userIdInput.value.trim());
    if (!uid || uid.length < 3) return;
    if (isPopping) return;
    if (!chosenEl) return;

    if (isUserUsed(uid)) {
      popButton.disabled = true;
      popButton.textContent = CONFIG.labels.usedBtn;
      setUsedStatus(true);
      return;
    }

    isPopping = true;
    setPickMode(false);

    // ‚úÖ lock pending
    markUserPending(uid);

    popButton.disabled = true;
    popButton.textContent = CONFIG.labels.processing;

    try {
      // ‚úÖ simpan "me"
      setMeInfo(uid);

      await playPopSound();

      if (!document.contains(chosenEl)) throw new Error("Balloon removed");

      const r = chosenEl.getBoundingClientRect();
      const popPoint = {
        x: (r.left + r.width / 2) / window.innerWidth,
        y: (r.top + r.height * 0.35) / window.innerHeight
      };

      chosenEl.classList.add("is-pop");

      later(140, () => vanishBalloon(chosenEl));
      later(160, () => confettiBurstAt(popPoint.x, popPoint.y));

      const prizeText = decidePrize();
      const ts = nowMs();

      later(360, () => showPrizeAtPoint(prizeText, popPoint.x, popPoint.y));
      later(760, () => showResultPopup(uid, prizeText, ts));

      // ‚úÖ history masuk (real, dan akan bunyi notif juga)
      pushHistoryTop(uid, prizeText, false, ts);

      markUserDone(uid);
      setUsedStatus(true);

      later(2650, () => resetAfterPop());
    } catch (e) {
      clearUserPending(uid);
      isPopping = false;

      popButton.disabled = false;
      popButton.textContent = POP_LABEL;

      setUsedStatus(false);
      setPickMode(false);
    }
  };

  // ==========================================================
  // ‚úÖ Klik tombol POP = mode pilih balon
  // ==========================================================
  popButton.addEventListener("click", () => {
    if (popButton.disabled) return;

    const uid = sanitizeUserId(userIdInput.value.trim());
    if (!uid || uid.length < 3) return;

    if (isUserUsed(uid)) {
      popButton.disabled = true;
      popButton.textContent = CONFIG.labels.usedBtn;
      setUsedStatus(true);
      return;
    }

    if (isPopping) return;

    sTap();
    if (!isArmedPick) setPickMode(true);
  });

  // ==========================================================
  // ‚úÖ Klik balon = pop balon (kalau pick mode)
  // ==========================================================
  balloon.addEventListener("click", (e) => {
    if (!isArmedPick) return;
    if (isPopping) return;
    if (popButton.disabled) return;

    const b = e.target.closest(".balloon-item");
    if (!b) return;

    popChosenBalloon(b);
  });

  // ==========================================================
  // ‚úÖ Result Popup (KLAIM + BAGIKAN)
  // ==========================================================
  const maskForShare = (raw) => {
    const s = String(raw || "").trim().toUpperCase();
    if (!s) return "USER";
    if (s.length <= 3) return s[0] + "**";
    return `${s.slice(0,2)}****${s.slice(-2)}`;
  };

  const copyToClipboard = async (text) => {
    try {
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
        return true;
      }
    } catch {}
    try {
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.setAttribute("readonly", "true");
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      ta.style.top = "-9999px";
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      return true;
    } catch {}
    return false;
  };

  const shareResultSmart = async ({ title, text, url }) => {
    if (navigator.share) {
      try {
        await navigator.share({ title, text, url });
        return { ok: true, mode: "native" };
      } catch {
        return { ok: false, mode: "native_cancel" };
      }
    }

    const msg = `${text}\n${url || ""}`.trim();
    const copied = await copyToClipboard(msg);

    try {
      const wa = "https://wa.me/?text=" + encodeURIComponent(msg);
      window.open(wa, "_blank", "noopener,noreferrer");
    } catch {}

    return { ok: copied, mode: "copy+wa" };
  };

  // ==========================================================
  // ‚úÖ CLAIM LOADING OVERLAY (Injected CSS + UI)
  // ==========================================================
  const ensureClaimLoadingStyles = () => {
    if (document.getElementById("lbClaimLoadingStyle")) return;

    const st = document.createElement("style");
    st.id = "lbClaimLoadingStyle";
    st.textContent = `
.claim-loading{
  position: fixed;
  inset: 0;
  z-index: 100000;
  display: grid;
  place-items: center;
  padding: 18px;
  background: rgba(12,35,64,0.30);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  opacity: 0;
  pointer-events: none;
  transition: opacity .22s ease;
}
.claim-loading.show{ opacity: 1; pointer-events: auto; }
.claim-loading-card{
  width: min(360px, 92vw);
  border-radius: 22px;
  padding: 18px 16px;
  background:
    radial-gradient(900px 420px at 50% -10%,
      rgba(30,167,255,.16) 0%,
      rgba(30,167,255,0) 60%
    ),
    linear-gradient(180deg,
      rgba(255,255,255,.96) 0%,
      rgba(233,246,255,.92) 100%
    );
  border: 1px solid rgba(255,255,255,.82);
  box-shadow:
    0 34px 88px rgba(12,35,64,0.22),
    0 0 0 1px rgba(30,167,255,.12) inset;
  position: relative;
  overflow: hidden;
  text-align: center;
  transform: translateY(10px) scale(.98);
  animation: claimCardIn .28s cubic-bezier(.22,1,.36,1) forwards;
}
@keyframes claimCardIn{ to{ transform: translateY(0) scale(1); } }
.claim-loading-card::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background: radial-gradient(120% 72% at 50% 0%,
    rgba(255,255,255,.60) 0%,
    rgba(255,255,255,0) 60%
  );
  opacity:.92;
}
.claim-spinner{
  width: 46px;
  height: 46px;
  border-radius: 999px;
  margin: 6px auto 10px;
  border: 4px solid rgba(30,167,255,.18);
  border-top-color: rgba(30,167,255,1);
  box-shadow: 0 16px 30px rgba(30,167,255,.16);
  animation: claimSpin .9s linear infinite;
}
@keyframes claimSpin{ to{ transform: rotate(360deg); } }
.claim-title{
  font-weight: 1000;
  font-size: 1.06rem;
  letter-spacing: .2px;
  color: #0c2340;
}
.claim-sub{
  margin-top: 6px;
  font-size: .92rem;
  color: rgba(12,35,64,.62);
  line-height: 1.35;
}
.claim-dots{ display:inline-flex; gap:4px; margin-left:4px; vertical-align:middle; }
.claim-dots i{
  width: 6px;
  height: 6px;
  border-radius: 999px;
  background: rgba(30,167,255,.70);
  opacity: .25;
  animation: dotBlink 1.1s ease-in-out infinite;
}
.claim-dots i:nth-child(2){ animation-delay:.12s; }
.claim-dots i:nth-child(3){ animation-delay:.24s; }
@keyframes dotBlink{
  0%,100%{ opacity:.22; transform: translateY(0); }
  50%{ opacity:.95; transform: translateY(-2px); }
}
@media (prefers-reduced-motion: reduce){
  .claim-spinner{ animation:none !important; }
  .claim-dots i{ animation:none !important; opacity:.7; }
}
    `;
    document.head.appendChild(st);
  };

  const ensureClaimLoading = () => {
    ensureClaimLoadingStyles();

    let el = document.getElementById("claimLoading");
    if (el) return el;

    el = document.createElement("div");
    el.id = "claimLoading";
    el.className = "claim-loading";
    el.innerHTML = `
      <div class="claim-loading-card" role="dialog" aria-modal="true" aria-label="Loading">
        <div class="claim-spinner" aria-hidden="true"></div>
        <div class="claim-title" id="claimTitle">
          ${String(CONFIG.claim?.loading?.title || "Menghubungkan ke server")}
          <span class="claim-dots" aria-hidden="true"><i></i><i></i><i></i></span>
        </div>
        <div class="claim-sub" id="claimSub">
          ${String(CONFIG.claim?.loading?.sub || "Mohon tunggu sebentar‚Ä¶")}
        </div>
      </div>
    `;

    document.body.appendChild(el);
    return el;
  };

  const showClaimLoading = (title, sub) => {
    const cfg = CONFIG.claim?.loading || {};
    if (cfg.enabled === false) return;

    const el = ensureClaimLoading();
    const t = el.querySelector("#claimTitle");
    const s = el.querySelector("#claimSub");

    const titleText = String(title || cfg.title || "Menghubungkan ke server");
    const subText = String(sub || cfg.sub || "Mohon tunggu sebentar‚Ä¶");

    if (t) {
      t.innerHTML = `${titleText} <span class="claim-dots" aria-hidden="true"><i></i><i></i><i></i></span>`;
    }
    if (s) s.textContent = subText;

    el.classList.add("show");
    updateModalLock();
  };

  const hideClaimLoading = () => {
    const el = document.getElementById("claimLoading");
    if (!el) return;
    el.classList.remove("show");
    updateModalLock();
  };

  const ensureResultPopup = () => {
    let root = document.getElementById("resultPopup");
    if (root) return root;

    root = document.createElement("div");
    root.id = "resultPopup";
    root.className = "result-pop";
    root.innerHTML = `
      <div class="result-card" role="dialog" aria-modal="true" aria-label="Hasil Hadiah">
        <div class="result-top">
          <div class="result-balloon-svg" aria-hidden="true">
            <svg viewBox="0 0 120 150" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="bgRed" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#ff7b7b"/>
                  <stop offset="0.55" stop-color="#ff3c3c"/>
                  <stop offset="1" stop-color="#ff1f4a"/>
                </linearGradient>
                <radialGradient id="shine" cx="35%" cy="25%" r="65%">
                  <stop offset="0" stop-color="rgba(255,255,255,.95)"/>
                  <stop offset="0.35" stop-color="rgba(255,255,255,.35)"/>
                  <stop offset="0.6" stop-color="rgba(255,255,255,0)"/>
                </radialGradient>
                <filter id="softGlow" x="-40%" y="-40%" width="180%" height="180%">
                  <feGaussianBlur stdDeviation="6" result="b"/>
                  <feColorMatrix in="b" type="matrix"
                    values="1 0 0 0 0
                            0 1 0 0 0
                            0 0 1 0 0
                            0 0 0 .24 0"/>
                  <feMerge>
                    <feMergeNode/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>
              </defs>

              <ellipse cx="60" cy="56" rx="44" ry="52" fill="rgba(30,167,255,.14)" filter="url(#softGlow)"/>
              <path d="M60 12 C32 12 18 35 18 60 C18 88 38 110 60 110 C82 110 102 88 102 60 C102 35 88 12 60 12Z" fill="url(#bgRed)"/>
              <path d="M42 24 C28 34 26 54 30 72 C34 88 44 98 54 102 C38 92 32 78 32 62 C32 44 36 32 42 24Z" fill="url(#shine)" opacity=".95"/>
              <path d="M60 14 C36 14 22 35 22 60 C22 86 40 106 60 106 C80 106 98 86 98 60 C98 35 84 14 60 14Z"
                    fill="none" stroke="rgba(255,255,255,.38)" stroke-width="2" opacity=".55"/>
              <path d="M54 110 L66 110 L60 124 Z" fill="#ff1f4a" opacity=".95"/>
              <path d="M54 110 L66 110" stroke="rgba(255,255,255,.55)" stroke-width="2" opacity=".6"/>
              <path d="M60 124 C58 136 66 140 60 150"
                    fill="none"
                    stroke="rgba(12,35,64,.20)"
                    stroke-width="2"
                    stroke-linecap="round"/>
            </svg>
          </div>
          <div class="result-pill">HADIAH ANDA</div>
        </div>

        <div class="result-body">
          <div class="result-label">PRIZE</div>
          <div class="result-prize" id="rpPrize">0</div>

          <div class="result-hint">
            Klaim sekarang melalui <b>Live Chat</b> dan sertakan User ID:
          </div>

          <div class="result-meta">
            <div class="meta-row">
              <div class="meta-k">USER ID</div>
              <div class="meta-v" id="rpUser">-</div>
            </div>
            <div class="meta-row">
              <div class="meta-k">WAKTU</div>
              <div class="meta-v" id="rpTime">-</div>
            </div>
          </div>
        </div>

        <div class="result-actions">
          <button class="result-btn btn-claim" type="button" data-claim>KLAIM SEKARANG</button>
          <button class="result-btn btn-share" type="button" data-share>BAGIKAN</button>
        </div>
      </div>
    `;

    // ‚úÖ close on backdrop
    root.addEventListener("click", (e) => {
      if (e.target === root) hideResultPopup();
    });

    // ‚úÖ close on ESC (modern UX)
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        const r = document.getElementById("resultPopup");
        if (r && r.classList.contains("show")) hideResultPopup();
      }
    });

    root.querySelector("[data-claim]")?.addEventListener("click", () => {
      sTap();
      const uid = root.dataset.uid || "";
      const prize = root.dataset.prize || "0";
      const ts = Number(root.dataset.ts || nowMs());
      handleClaim(uid, prize, ts);
    });

    root.querySelector("[data-share]")?.addEventListener("click", async () => {
      sTap();

      const btn = root.querySelector("[data-share]");
      if (!btn) return;

      btn.disabled = true;
      const old = btn.textContent;
      btn.textContent = "MEMBUKA...";

      const uid = root.dataset.uid || "";
      const prize = root.dataset.prize || "0";
      const ts = Number(root.dataset.ts || nowMs());

      const d = new Date(ts);
      const t = d.toTimeString().slice(0, 8);

      const shareText =
        `üéà Aku dapat hadiah ${prize} di Pop Balon!\n` +
        `User: ${maskForShare(uid)} ‚Ä¢ Waktu: ${t}`;

      const res = await shareResultSmart({
        title: CONFIG.share.title,
        text: shareText,
        url: (CONFIG.share.url && String(CONFIG.share.url).trim()) ? CONFIG.share.url : location.href
      });

      later(200, () => {
        btn.disabled = false;
        btn.textContent = res.ok ? "BERHASIL DIBAGIKAN" : "BAGIKAN";
        later(900, () => { btn.textContent = old; });
      });
    });

    document.body.appendChild(root);
    return root;
  };

  const showResultPopup = (uid, prizeText, ts = nowMs()) => {
    sModalOpen();

    const root = ensureResultPopup();
    const prizeEl = root.querySelector("#rpPrize");
    const userEl = root.querySelector("#rpUser");
    const timeEl2 = root.querySelector("#rpTime");

    const d = new Date(ts);
    const t = d.toTimeString().slice(0, 8);

    const p = String(prizeText || "0");
    const uidUpper = String(uid || "-").toUpperCase();

    prizeEl.textContent = p;
    prizeEl.classList.toggle("is-zero", p === "0");

    userEl.textContent = uidUpper;
    timeEl2.textContent = t;

    root.dataset.uid = String(uid || "");
    root.dataset.prize = p;
    root.dataset.ts = String(ts);

    root.classList.add("show");
    updateModalLock();

    // ‚úÖ NEW: Confetti kanan/kiri saat modal muncul
    confettiOnResultPopup();

    later(90, () => root.querySelector("[data-claim]")?.focus());
  };

  function hideResultPopup(){
    const root = document.getElementById("resultPopup");
    if (!root) return;
    root.classList.remove("show");
    updateModalLock();
    sModalClose();
  }

  function handleClaim(uid, prizeText, ts){
    hideResultPopup();

    const claimUrl = String(CONFIG.claim?.url || "").trim();
    const openTarget = CONFIG.claim?.openTarget || "_self";
    const includeParams = CONFIG.claim?.includeParams !== false;

    const loadCfg = CONFIG.claim?.loading || {};
    const useLoading = loadCfg.enabled !== false;
    const delayMs = Math.max(250, Number(loadCfg.delayMs || 950));

    if (useLoading) {
      showClaimLoading(loadCfg.title, loadCfg.sub);
    }

    if (!claimUrl) {
      if (useLoading) {
        later(200, () => {
          showClaimLoading(
            loadCfg.failTitle || "Link klaim belum diisi",
            loadCfg.failSub || "Silakan isi CONFIG.claim.url dulu."
          );
          later(1400, () => hideClaimLoading());
        });
      }
      return;
    }

    let finalUrl = claimUrl;
    try {
      const u = new URL(claimUrl, location.href);
      if (includeParams) {
        u.searchParams.set("uid", uid);
        u.searchParams.set("prize", prizeText);
        u.searchParams.set("time", String(ts));
      }
      finalUrl = u.toString();
    } catch {}

    let popupRef = null;
    if (openTarget === "_blank") {
      try { popupRef = window.open("about:blank", "_blank", "noopener,noreferrer"); } catch {}
    }

    later(delayMs, () => {
      if (openTarget === "_self") {
        window.location.href = finalUrl;
        return;
      }

      if (popupRef && !popupRef.closed) {
        try {
          popupRef.location.href = finalUrl;
        } catch {
          try { window.open(finalUrl, "_blank", "noopener,noreferrer"); }
          catch { window.location.href = finalUrl; }
        }
        if (useLoading) later(450, () => hideClaimLoading());
        return;
      }

      try { window.open(finalUrl, "_blank", "noopener,noreferrer"); }
      catch { window.location.href = finalUrl; }

      if (useLoading) later(450, () => hideClaimLoading());
    });
  }

  // ==========================================================
  // ‚úÖ Ticker (1s)
  // ==========================================================
  const tick = () => {
    tickJackpot();
    updateClock();
  };

  tick();
  setInterval(tick, 1000);

  // ==========================================================
  // ‚úÖ Visibility (lebih smart + bg music)
  // ==========================================================
  document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
      pauseBg();
      return;
    }
    resumeBg();
    cleanupUsedMap();
    tick();
    checkReady();
    renderHistory({ playSoundIfNewTop: false });
    checkBalloonLeft();
  });

  // init
  checkBalloonLeft();
})();
</script>
</body>
</html>