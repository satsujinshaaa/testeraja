<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no"/>

  <!-- ✅ SEO / SHARE (auto via JS dari CONFIG.site.baseUrl) -->
  <meta property="og:url" content="" />
  <link rel="canonical" href="" />
  <meta property="og:title" content="Lucky Ang Pao — Chinese New Year 2026" />
  <meta name="description" content="Pilih Ang Pao keberuntunganmu & dapatkan hadiah!" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="" />
  <meta name="theme-color" content="#19040b"/>
  <meta name="color-scheme" content="dark"/>

  <title>Lucky Ang Pao — Chinese New Year 2026</title>

  <link rel="preconnect" href="https://i.postimg.cc" crossorigin>

<style>
/* ─────────────────────────────────────────────────────────────
 * BLOK 01 — DESIGN TOKENS (CNY 2026 • PREMIUM • HD • NO-BLUR)
 * ─────────────────────────────────────────────────────────── */
:root{
  --bg0:#19040b;
  --bg1:#2a0610;
  --bg2:#3b0712;
  --bg3:#5a0b14;

  --redHi:#ff3a44;
  --red1:#d51a2b;
  --red2:#b51221;
  --red3:#7f0a16;

  --gold0:#fff6df;
  --gold1:#ffe4a6;
  --gold2:#f2c96f;
  --gold3:#c79a40;
  --gold4:#8a6424;

  --ease:cubic-bezier(.2,.9,.18,1);
  --ease2:cubic-bezier(.22,.85,.2,1);

  --cardW:560px;
  --radius:26px;
  --shadow:0 22px 72px rgba(0,0,0,.62);
  --shadow2:0 12px 34px rgba(0,0,0,.38);
  --ring:rgba(255,228,166,.58);

  --safe-top: env(safe-area-inset-top);
  --safe-bot: env(safe-area-inset-bottom);
  --scene-pad: clamp(12px, 2.2vw, 18px);
  --scene-top: calc(var(--safe-top) + var(--scene-pad));

  --cornerW: clamp(112px, 20vw, 190px);
  --corner-bg-scale-left: 90%;
  --corner-bg-scale-right: 90%;

  --wireTop: calc(var(--safe-top) + clamp(2px, .6vh, 10px));
  --lanternY: 0px;

  --fxBright: 1.12;
  --fxContrast: 1.06;
  --fxSat: 1.10;

  --corner-left-url:  url("");
  --corner-right-url: url("");

  --cloud-left-url:  url("");
  --cloud-mid-url:   url("");
  --cloud-right-url: url("");

  --bottom-cloud-url: url("");

  --angpao-url: url("");
  --angpaoImg: 102;

  --pageTitleGap: clamp(86px, 12vh, 152px);
  --titlePadX: max(var(--scene-pad), calc(var(--cornerW) * .34));
  --titleMaxW: 2200px;
  --titleDeskBoost: 1;

  /* overlay theme */
  --ovBg: rgba(0,0,0,.76);
  --ovBlur: 10px;
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 02 — RESET + BASE
 * ─────────────────────────────────────────────────────────── */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  position:relative;
  isolation:isolate;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
  color:#fff;

  min-height:100svh;
  overflow-x:hidden;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  overscroll-behavior:none;

  background:
    radial-gradient(1400px 980px at 50% 30%, rgba(255,230,170,.14), transparent 62%),
    radial-gradient(1100px 800px at 18% 22%, rgba(255,152,78,.10), transparent 58%),
    radial-gradient(1100px 800px at 82% 22%, rgba(255,152,78,.10), transparent 58%),
    linear-gradient(180deg, var(--bg3), var(--bg0));

  touch-action:manipulation;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
@supports (height:100dvh){
  body{ min-height:100dvh; }
}
body.modal-open{ overflow:hidden; }

/* ─────────────────────────────────────────────────────────────
 * BLOK 03 — BACKDROP
 * ─────────────────────────────────────────────────────────── */
body::before{
  content:"";
  position:fixed;
  inset:-14%;
  z-index:0;
  pointer-events:none;

  background:
    radial-gradient(1200px 860px at 50% 34%, rgba(255,230,170,.11), transparent 62%),
    radial-gradient(980px 720px at 22% 22%, rgba(255,120,70,.085), transparent 60%),
    radial-gradient(980px 720px at 78% 22%, rgba(255,120,70,.085), transparent 60%),
    linear-gradient(180deg,
      rgba(255,255,255,.035),
      rgba(255,255,255,0) 32%,
      rgba(0,0,0,.06) 72%,
      rgba(0,0,0,.10));

  opacity:.98;
  filter:saturate(1.03) contrast(1.01);
}
body::after{
  content:"";
  position:fixed;
  inset:-14%;
  z-index:0;
  pointer-events:none;

  background:
    radial-gradient(1200px 900px at 50% 40%,
      transparent 54%, rgba(0,0,0,.42) 78%, rgba(0,0,0,.66) 100%),
    radial-gradient(760px 520px at 50% 10%,
      rgba(0,0,0,.16), transparent 66%);

  opacity:.94;
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 05 — SCENE
 * ─────────────────────────────────────────────────────────── */
.scene{
  position:fixed;
  inset:0;
  z-index:2;
  pointer-events:none;
  overflow:hidden;
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 06 — CORNERS
 * ─────────────────────────────────────────────────────────── */
.corner{
  position:absolute;
  top:var(--scene-top);
  width:var(--cornerW);
  aspect-ratio:1/1;
  height:auto;

  opacity:.985;
  z-index:2;

  background-image:var(--corner-url);
  background-repeat:no-repeat;
  background-position:center;
  background-size:var(--corner-bg-size,contain);

  filter:
    drop-shadow(0 14px 26px rgba(0,0,0,.34))
    drop-shadow(0 0 10px rgba(255,228,166,.08));

  transform:scaleX(var(--cornerFlip,1));
  backface-visibility:hidden;
  contain:layout paint;
}
.corner.tl{
  left:var(--scene-pad);
  --corner-url:var(--corner-left-url);
  --cornerFlip:1;
  --corner-bg-size:var(--corner-bg-scale-left);
}
.corner.tr{
  right:var(--scene-pad);
  --corner-url:var(--corner-right-url);
  --cornerFlip:-1;
  --corner-bg-size:var(--corner-bg-scale-right);
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 07 — LANTERNS
 * ─────────────────────────────────────────────────────────── */
.lanternWrap{
  position:absolute;
  left:var(--lx);

  --lyFinal: calc(var(--ly) + var(--lanternY, 0px) + var(--lY, 0px));
  top:var(--lyFinal);

  width:calc(clamp(84px, 15vw, 150px) * var(--lScale, 1));
  aspect-ratio:140/220;

  z-index:4;
  opacity:var(--lop, .985);

  transform:translate3d(-50%,0,0) rotate(var(--lrot, -1deg));
  transform-origin:50% 0%;

  animation:lanternHang var(--ldur, 9.2s) var(--ease2) infinite;
  animation-delay: calc(var(--ldelay, 0s) * -1);

  filter:
    drop-shadow(0 16px 26px rgba(0,0,0,.36))
    drop-shadow(0 0 12px rgba(255,228,166,.10))
    saturate(1.02) contrast(1.02);

  will-change:transform;
  backface-visibility:hidden;

  --wireLen: max(0px, calc(var(--lyFinal) - var(--wireTop)));
}
.lanternWrap::before{
  content:"";
  position:absolute;
  left:50%;
  top:calc(-1 * var(--wireLen));
  height:var(--wireLen);
  width:clamp(2px, .35vw, 3px);
  transform:translateX(-50%);

  background:
    linear-gradient(90deg,
      rgba(255,255,255,.20),
      rgba(255,228,166,.10) 34%,
      rgba(199,154,64,.60) 66%,
      rgba(0,0,0,.18)),
    linear-gradient(180deg,
      rgba(255,228,166,.22),
      rgba(199,154,64,.68) 55%,
      rgba(90,60,20,.92));

  border-radius:999px;
  opacity:.96;

  box-shadow:
    0 0 8px rgba(255,228,166,.10),
    0 10px 18px rgba(0,0,0,.22);
}
.lanternWrap::after{
  content:"";
  position:absolute;
  left:50%;
  top:58%;
  width: calc(240% * var(--lGlowSize, 1));
  height: calc(250% * var(--lGlowSize, 1));
  transform:translate(-50%,-50%);
  pointer-events:none;

  background:
    radial-gradient(ellipse at 50% 60%,
      rgba(255,246,224,.18) 0%,
      rgba(255,226,160,.12) 26%,
      rgba(255,182,118,.07) 48%,
      rgba(255,132,96,.035) 66%,
      transparent 86%),
    radial-gradient(ellipse at 50% 44%,
      rgba(255,255,255,.055) 0%,
      transparent 58%);

  border-radius:999px;
  mix-blend-mode:screen;
  opacity:var(--lGlow, .78);

  -webkit-mask-image: radial-gradient(ellipse at 50% 60%,
    rgba(0,0,0,.95) 0 54%,
    rgba(0,0,0,.55) 68%,
    transparent 90%);
  mask-image: radial-gradient(ellipse at 50% 60%,
    rgba(0,0,0,.95) 0 54%,
    rgba(0,0,0,.55) 68%,
    transparent 90%);

  animation:lanternGlow 4.2s var(--ease2) infinite;
}
@keyframes lanternGlow{
  0%   { opacity:calc(var(--lGlow, .78) * .94); transform:translate(-50%,-50%) scale(.995); }
  50%  { opacity:var(--lGlow, .78);            transform:translate(-50%,-50%) scale(1.012); }
  100% { opacity:calc(var(--lGlow, .78) * .94); transform:translate(-50%,-50%) scale(.995); }
}
@keyframes lanternHang{
  0%   { transform:translate3d(-50%,0,0) rotate(-1.2deg); }
  35%  { transform:translate3d(-50%,10px,0) rotate(1.05deg); }
  70%  { transform:translate3d(-50%,6px,0) rotate(-.8deg); }
  100% { transform:translate3d(-50%,0,0) rotate(-1.2deg); }
}
.lanternWrap svg{ width:100%; height:100%; display:block; shape-rendering:geometricPrecision; text-rendering:geometricPrecision; }

.lanternWrap.l1{
  --lx: clamp(92px, 16vw, 220px);
  --ly: calc(var(--wireTop) + clamp(118px, 16vh, 210px));
  --ldelay:.22s;
  --lGlow:.82;
  --lGlowSize: 1.08;
}
.lanternWrap.l2{
  --lx: clamp(170px, 28vw, 340px);
  --ly: calc(var(--wireTop) + clamp(94px, 14vh, 180px));
  --lScale:.84;
  --lop:.96;
  --lGlow:.66;
  --lGlowSize: .92;
  --ldelay:1.05s;
}
.lanternWrap.l3{
  --lx: calc(100% - clamp(170px, 28vw, 340px));
  --ly: calc(var(--wireTop) + clamp(94px, 14vh, 180px));
  --lScale:.84;
  --lop:.96;
  --lGlow:.66;
  --lGlowSize: .92;
  --ldelay:.66s;
}
.lanternWrap.l4{
  --lx: calc(100% - clamp(92px, 16vw, 220px));
  --ly: calc(var(--wireTop) + clamp(118px, 16vh, 210px));
  --ldelay:1.55s;
  --lGlow:.82;
  --lGlowSize: 1.08;
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 08 — CLOUDS
 * ─────────────────────────────────────────────────────────── */
.cloudPng{
  position:absolute;
  top:calc(var(--scene-top) + clamp(118px, 15.5vh, 228px));
  left:var(--cx, 50%);

  --cloudBox: 2.9;
  --cloudImg: 1.9;

  width: calc(clamp(240px, 34vw, 360px) * var(--cloudBox));
  aspect-ratio: 520 / 200;

  z-index:3;

  transform:translateX(-50%) scaleX(var(--sx, 1));
  transform-origin:50% 50%;

  background-image:var(--cloud-url);
  background-repeat:no-repeat;
  background-position:center;
  background-size: calc(41% * var(--cloudImg)) auto;

  opacity:var(--co, .96);
  filter:
    drop-shadow(0 12px 18px rgba(0,0,0,.24))
    drop-shadow(0 0 12px rgba(255,228,166,.06));

  will-change:transform;
  backface-visibility:hidden;

  --cdx: 14px;
  --cdy: 6px;
  animation:cloudDriftPng 11s var(--ease2) infinite;
}
.cloudPng.cLeft{
  --cx:14%;
  --sx:1;
  --cloud-url: var(--cloud-left-url);
  --cloudImg: 1.25;
  animation-delay:.25s;
}
.cloudPng.cMid{
  --cx:50%;
  --sx:1;
  --co:.94;
  top:calc(var(--scene-top) + clamp(148px, 18.5vh, 260px));
  width: calc(clamp(280px, 42vw, 460px) * 1.45);
  --cloud-url: var(--cloud-mid-url);
  --cloudImg: 1.25;
  animation-delay:.85s;
}
.cloudPng.cRight{
  --cx:86%;
  --sx:-1;
  --cloud-url: var(--cloud-right-url);
  --cloudImg: 1.25;
  animation-delay:1.45s;
}
@keyframes cloudDriftPng{
  0%{ transform:translateX(-50%) scaleX(var(--sx, 1)) translate3d(0,0,0) rotate(-0.35deg); }
  50%{ transform:translateX(-50%) scaleX(var(--sx, 1)) translate3d(calc(var(--cdx) * .55), calc(var(--cdy) * .70), 0) rotate(0.25deg); }
  100%{ transform:translateX(-50%) scaleX(var(--sx, 1)) translate3d(0,0,0) rotate(-0.35deg); }
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 09 — BOTTOM CLOUD
 * ─────────────────────────────────────────────────────────── */
.bottomCloudPng{
  position:absolute;
  left:50%;
  bottom:calc(-6px + var(--safe-bot));
  transform:translateX(-50%);
  transform-origin:50% 100%;

  --bCloudBox: 1.00;
  --bCloudImg: 1.00;

  width: calc(min(980px, 120vw) * var(--bCloudBox));
  max-width: 1200px;
  aspect-ratio: 1600 / 520;

  min-height: clamp(110px, 18vw, 220px);

  pointer-events:none;
  z-index:2;

  background-image: var(--bottom-cloud-url);
  background-repeat:no-repeat;
  background-position:center bottom;
  background-size: calc(85% * var(--bCloudImg)) auto;

  filter:
    drop-shadow(0 -10px 22px rgba(0,0,0,.28))
    drop-shadow(0 0 12px rgba(255,228,166,.06));

  animation: bottomCloudFloat 9.2s var(--ease2) infinite;
  will-change: transform;
  backface-visibility:hidden;

  contain: layout paint;
}
@media (min-width: 900px){
  .bottomCloudPng{
    width: 100vw;
    max-width: none;
    background-size: calc(115% * var(--bCloudImg)) auto;
  }
}
@keyframes bottomCloudFloat{
  0%   { transform:translateX(-50%) translate3d(0,0,0) rotate(-.18deg); }
  50%  { transform:translateX(-50%) translate3d(0,-9px,0) rotate(.18deg); }
  100% { transform:translateX(-50%) translate3d(0,0,0) rotate(-.18deg); }
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 10 — BOTTOM ORNAMENT
 * ─────────────────────────────────────────────────────────── */
.bottomOrn{
  position:absolute;
  left:0; right:0;
  bottom:calc(-2px + var(--safe-bot));
  width:100%;
  height:min(54vh,540px);
  z-index:1;
  opacity:1;
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 11A — PAGE TITLE
 * ─────────────────────────────────────────────────────────── */
.pageTitle{
  position:fixed;
  inset:0 0 auto 0;
  z-index:6;
  pointer-events:none;

  display:flex;
  justify-content:center;

  padding-top: calc(var(--safe-top) + clamp(10px, 1.3vh, 16px));
}
.pageTitleInner{
  width: calc(100vw - (var(--titlePadX) * 2));
  max-width: var(--titleMaxW);
  text-align:center;
  line-height:1.05;

  padding-inline: clamp(10px, 1.35vw, 22px);
  filter: drop-shadow(0 18px 34px rgba(0,0,0,.38));

  container-type:inline-size;
  container-name:titlebox;
  text-wrap:balance;
}
.ptLine1{
  display:inline-flex;
  gap:.42ch;
  flex-wrap:wrap;
  justify-content:center;
  align-items:baseline;

  font-weight:950;
  letter-spacing:.8px;
  text-transform:uppercase;
  font-size: clamp(16px, 2.6vw, 34px);
  text-shadow:0 10px 22px rgba(0,0,0,.44);
}
.ptWelcome{ opacity:.92; color:rgba(255,255,255,.94); }
.ptBrand{
  font-weight:1000;
  letter-spacing:.95px;

  background: linear-gradient(180deg, var(--gold0), var(--gold1) 32%, var(--gold2) 62%, var(--gold3));
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;

  text-shadow:
    0 10px 24px rgba(0,0,0,.46),
    0 0 18px rgba(255,228,166,.14);
}
.ptLine2{
  margin-top:7px;
  font-size: clamp(12px, 1.6vw, 17px);
  font-weight:850;
  letter-spacing:.35px;
  opacity:.92;
  text-shadow:0 10px 22px rgba(0,0,0,.40);
}
.ptLine3{
  margin-top:7px;
  font-size: clamp(12px, 1.7vw, 18px);
  font-weight:950;
  letter-spacing:.25px;
  color: rgba(255,228,166,.98);
  text-shadow:
    0 12px 26px rgba(0,0,0,.44),
    0 0 16px rgba(255,228,166,.12);
}
.pageTitleInner::after{
  content:"";
  display:block;
  height:2px;
  width:min(720px,86%);
  margin:10px auto 0;
  background: linear-gradient(90deg,
    transparent,
    rgba(255,228,166,.55),
    rgba(199,154,64,.55),
    rgba(255,228,166,.55),
    transparent
  );
  opacity:.84;
  border-radius:999px;
}
@container titlebox (max-width: 520px){
  .ptLine1{ font-size: clamp(15px, 4.6cqi, 22px); letter-spacing:.65px; }
  .ptLine2{ font-size: clamp(11px, 3.4cqi, 14px); }
  .ptLine3{ font-size: clamp(11px, 3.6cqi, 15px); }
}
@container titlebox (min-width: 900px){
  .ptLine1{ font-size: clamp(24px, calc(2.6cqi * var(--titleDeskBoost)), 52px); letter-spacing:.95px; }
  .ptLine2{ font-size: clamp(13px, 1.25cqi, 18px); }
  .ptLine3{ font-size: clamp(14px, 1.35cqi, 20px); }
  .pageTitleInner::after{ width: min(860px, 74%); }
}
@media (min-width: 1400px){
  :root{ --pageTitleGap: clamp(92px, 12vh, 168px); }
  .ptLine1{ text-shadow:0 14px 28px rgba(0,0,0,.46); }
}
@media (max-width: 420px){
  :root{
    --pageTitleGap: clamp(78px, 11vh, 132px);
    --titlePadX: max(var(--scene-pad), calc(var(--cornerW) * .28));
  }
}
@media (max-height: 650px){
  :root{ --pageTitleGap: clamp(68px, 10vh, 118px); }
  .pageTitleInner::after{ margin-top:8px; }
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 11 — UI WRAPPER
 * ─────────────────────────────────────────────────────────── */
.ui{
  position:relative;
  z-index:5;
  width:100%;
  min-height:100svh;
  display:flex;
  align-items:center;
  justify-content:center;

  padding:
    calc(28px + var(--pageTitleGap))
    14px
    calc(28px + var(--safe-bot));
}
@supports (height:100dvh){
  .ui{ min-height:100dvh; }
}
.uiInner{
  width:min(var(--cardW),92vw);
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 12 — CARD
 * ─────────────────────────────────────────────────────────── */
.card{
  width:100%;
  border-radius:var(--radius);
  position:relative;
  padding:28px 22px 22px;
  text-align:center;
  background:
    radial-gradient(900px 560px at 50% 28%, rgba(255,255,255,.13), transparent 58%),
    radial-gradient(520px 220px at 50% 0%, rgba(255,228,166,.16), transparent 70%),
    linear-gradient(180deg, rgba(255,214,126,.20), rgba(255,214,126,.06)),
    linear-gradient(180deg, rgba(90,11,20,.86), rgba(35,6,14,.96));
  box-shadow:var(--shadow);
  border:2px solid var(--ring_toggle, var(--ring));
  transform:translateY(6px);
  animation:cardIn .9s var(--ease2) both;
  overflow:hidden;
  backdrop-filter:saturate(1.08);
}
.card .innerPattern{
  position:absolute; inset:0;
  pointer-events:none;
  opacity:.22;
  background:
    radial-gradient(400px 260px at 20% 18%, rgba(255,255,255,.22), transparent 70%),
    radial-gradient(520px 260px at 82% 22%, rgba(255,255,255,.16), transparent 72%),
    repeating-linear-gradient(135deg, rgba(255,228,166,.10) 0 2px, transparent 2px 10px),
    repeating-linear-gradient(45deg, rgba(199,154,64,.06) 0 1px, transparent 1px 8px);
  mix-blend-mode:overlay;
}
@keyframes cardIn{
  from{ opacity:0; transform:translateY(22px) scale(.965); }
  to{ opacity:1; transform:translateY(0) scale(1); }
}
.card::before{
  content:"";
  position:absolute; inset:10px;
  border-radius:calc(var(--radius) - 8px);
  border:2px solid rgba(255,228,166,.74);
  box-shadow:
    inset 0 0 0 2px rgba(199,154,64,.24),
    inset 0 0 0 1px rgba(255,255,255,.10),
    0 0 12px rgba(255,228,166,.18);
  pointer-events:none;
}
.card::after{
  content:"";
  position:absolute; inset:0;
  border-radius:var(--radius);
  pointer-events:none;
  background:
    radial-gradient(160px 110px at 12% 16%, rgba(255,255,255,.16), transparent 70%),
    radial-gradient(160px 110px at 88% 16%, rgba(255,255,255,.14), transparent 70%),
    linear-gradient(180deg, rgba(0,0,0,.14), transparent 20%);
  opacity:.96;
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 13 — TYPO
 * ─────────────────────────────────────────────────────────── */
.title{
  position:relative;
  z-index:2;
  margin:0 0 14px;
  font-size:clamp(18px,2.4vw,22px);
  letter-spacing:.3px;
  font-weight:950;
  text-shadow:0 10px 22px rgba(0,0,0,.35);
}
.sub{
  position:relative;
  z-index:2;
  margin:0 0 12px;
  font-size:12px;
  opacity:.92;
  letter-spacing:.35px;
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 14 — INPUT
 * ─────────────────────────────────────────────────────────── */
.fields{ position:relative; z-index:2; display:grid; gap:10px; margin:10px 0 10px; }
input{
  width:100%;
  padding:13px 14px;
  border-radius:14px;
  border:1px solid rgba(255,228,166,.34);
  background:rgba(12,2,6,.32);
  color:#fff;
  outline:none;
  font-weight:800;
  letter-spacing:.5px;
  user-select:text;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  transition:transform .15s var(--ease), border-color .2s var(--ease), background .2s var(--ease), box-shadow .2s var(--ease);
}
input::placeholder{ color:rgba(255,255,255,.62); font-weight:850; letter-spacing:.9px; }
input:focus{
  border-color:rgba(255,228,166,.82);
  background:rgba(12,2,6,.36);
  transform:translateY(-1px);
  box-shadow:0 0 0 3px rgba(255,228,166,.12), inset 0 1px 0 rgba(255,255,255,.06);
}
.inputBad{ border-color:rgba(255,90,90,.78) !important; box-shadow:0 0 0 3px rgba(255,90,90,.12) !important; }
input.locked{ opacity:.92; cursor:not-allowed; filter:saturate(.95); }

/* ─────────────────────────────────────────────────────────────
 * BLOK 15 — BUTTONS + LOADING
 * ─────────────────────────────────────────────────────────── */
.btnRow{ position:relative; z-index:2; display:grid; gap:10px; margin-top:10px; justify-items:center; }
button{
  appearance:none;
  border:0;
  cursor:pointer;
  width:min(360px,94%);
  padding:12px 16px;
  border-radius:16px;
  font-weight:950;
  letter-spacing:.6px;
  color:#3c0712;
  background:
    linear-gradient(180deg, rgba(255,255,255,.26), transparent 42%),
    linear-gradient(135deg, var(--gold1), var(--gold2), var(--gold3));
  box-shadow:0 12px 26px rgba(0,0,0,.36);
  transition:transform .14s var(--ease), box-shadow .2s var(--ease), filter .2s var(--ease);
  touch-action:manipulation;
  position:relative;
  overflow:hidden;
}
button:focus-visible{ outline:none; box-shadow:0 0 0 3px rgba(255,228,166,.18), 0 12px 26px rgba(0,0,0,.36); transform:translateY(-1px); }
button[disabled]{ opacity:.62; cursor:not-allowed; filter:saturate(.9); }
button::before{
  content:"";
  position:absolute; inset:-40%;
  background:linear-gradient(90deg, transparent 0, rgba(255,255,255,.32) 45%, transparent 60%);
  transform:translateX(-60%) rotate(12deg);
  opacity:0;
  transition:opacity .18s var(--ease);
}
@media (hover:hover){
  button:hover::before{ opacity:.9; animation:btnSheen 1.05s var(--ease2) both; }
  button:hover{ transform:translateY(-2px) scale(1.02); box-shadow:0 16px 32px rgba(0,0,0,.44); }
}
button:active{ transform:translateY(0) scale(.99); }
@keyframes btnSheen{ from{ transform:translateX(-70%) rotate(12deg); } to{ transform:translateX(70%) rotate(12deg); } }

.btnGhost{
  background:
    linear-gradient(180deg, rgba(255,255,255,.08), transparent 45%),
    linear-gradient(135deg, rgba(255,228,166,.18), rgba(255,228,166,.08));
  color:rgba(255,228,166,.95);
  border:1px solid rgba(255,228,166,.34);
  box-shadow:0 12px 26px rgba(0,0,0,.26);
}

/* loading inline (button) */
.btnLoading{
  display:inline-flex;
  gap:10px;
  align-items:center;
  justify-content:center;
}
.spinner{
  width:18px; height:18px;
  border-radius:999px;
  border:2px solid rgba(90,11,20,.24);
  border-top-color: rgba(90,11,20,.92);
  animation:spin .75s linear infinite;
}
@keyframes spin{ to{ transform:rotate(360deg); } }

/* ─────────────────────────────────────────────────────────────
 * BLOK 16 — ERROR
 * ─────────────────────────────────────────────────────────── */
.err{
  position:relative;
  z-index:2;
  margin:8px 0 0;
  font-size:12px;
  color:rgba(255,228,166,.96);
  min-height:16px;
  opacity:0;
  transform:translateY(-2px);
  transition:.18s var(--ease);
}
.err.show{ opacity:1; transform:translateY(0); }

/* ─────────────────────────────────────────────────────────────
 * BLOK 17 — GRID
 * ─────────────────────────────────────────────────────────── */
#main-menu{ display:none; }
#login-menu{ display:block; }

.angpaoGrid{
  position:relative;
  z-index:2;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:clamp(10px, 1.6vw, 14px);
  justify-items:center;
  margin-top:10px;
  padding:10px 6px 2px;
}
.angpaoBtn{
  width:clamp(86px, 16vw, 110px);
  aspect-ratio:96/104;

  border-radius:20px;
  background:transparent !important;
  padding:0;
  border:0;
  box-shadow:none !important;

  position:relative;
  cursor:pointer;

  transition:transform .18s var(--ease), filter .18s var(--ease);
  transform:translateZ(0);
  will-change:transform;

  outline:none !important;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  user-select:none;
}
.angpaoBtn::before{ display:none !important; content:none !important; }
.angpaoBtn:focus-visible{
  box-shadow: 0 0 0 3px rgba(255,228,166,.18), 0 18px 30px rgba(0,0,0,.22) !important;
}
@media (hover:hover){
  .angpaoBtn:hover{
    transform:translateY(-4px) scale(1.07) rotate(-.6deg);
    filter:brightness(1.08);
  }
}
.angpaoBtn:active{ transform:translateY(-1px) scale(1.02); }
.angpaoBtn[disabled]{ opacity:.55; cursor:not-allowed; filter:saturate(.9); }

.envelope{
  width:100%;
  height:100%;
  display:block;

  background-image: var(--angpao-url);
  background-repeat:no-repeat;
  background-position:center;
  background-size: calc(1% * var(--angpaoImg, 115)) auto;

  filter: drop-shadow(0 12px 18px rgba(0,0,0,.38));
  backface-visibility:hidden;
  transform:translateZ(0);
}
.angpaoBtn.is-picked .envelope{ animation:picked .55s var(--ease2) both; }
@keyframes picked{
  0%{ transform:translateY(0) rotate(0deg) scale(1); }
  35%{ transform:translateY(-6px) rotate(-2deg) scale(1.05); }
  70%{ transform:translateY(2px) rotate(2deg) scale(1.02); }
  100%{ transform:translateY(0) rotate(0deg) scale(1); }
}
.hint{
  position:relative;
  z-index:2;
  margin-top:10px;
  font-size:11px;
  opacity:.80;
  letter-spacing:.35px;
  line-height:1.35;
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 18 — POPUP (CLEAN • RAPI • PREMIUM)
 *  ✅ Prize: no double layer + sheen clipped rapi
 *  ✅ Meta rows: lebih masuk + sejajar + lega
 * ─────────────────────────────────────────────────────────── */

/* overlay */
#popup{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;

  background:
    radial-gradient(900px 600px at 50% 18%, rgba(255,228,166,.11), transparent 60%),
    radial-gradient(760px 520px at 50% 92%, rgba(255,58,68,.06), transparent 62%),
    var(--ovBg);

  padding:18px;
  backdrop-filter: blur(8px) saturate(1.08);
  -webkit-backdrop-filter: blur(8px) saturate(1.08);

  animation: popFade .22s var(--ease2) both;
}
@keyframes popFade{ from{ opacity:0; } to{ opacity:1; } }

/* card */
.popupCard{
  width:min(520px,92vw);
  border-radius: calc(var(--radius) + 2px);
  position:relative;
  text-align:center;

  padding:28px 18px 18px;

  background:
    radial-gradient(860px 560px at 50% 18%, rgba(255,255,255,.14), transparent 58%),
    radial-gradient(440px 250px at 50% 0%, rgba(255,228,166,.18), transparent 72%),
    linear-gradient(180deg, rgba(255,214,126,.16), rgba(255,214,126,.04)),
    linear-gradient(180deg, rgba(90,11,20,.95), rgba(22,4,10,.98));

  border:1px solid rgba(255,228,166,.44);
  box-shadow:
    0 26px 86px rgba(0,0,0,.66),
    0 10px 30px rgba(0,0,0,.40);

  overflow:hidden;
  transform: translateZ(0);
  will-change: transform, opacity;

  animation: popIn2 .42s var(--ease2) both;
}
@keyframes popIn2{
  from{ opacity:0; transform:translateY(22px) scale(.92); }
  to{ opacity:1; transform:translateY(0) scale(1); }
}

/* inner frame */
.popupCard::before{
  content:"";
  position:absolute;
  inset:10px;
  border-radius: calc(var(--radius) - 6px);
  border:2px solid rgba(255,228,166,.70);
  box-shadow:
    inset 0 0 0 2px rgba(199,154,64,.20),
    inset 0 0 0 1px rgba(255,255,255,.08),
    0 0 14px rgba(255,228,166,.18);
  pointer-events:none;
}

/* top glass sweep */
.popupCard::after{
  content:"";
  position:absolute;
  inset:-18%;
  border-radius: inherit;
  pointer-events:none;

  background:
    radial-gradient(260px 180px at 18% 10%, rgba(255,255,255,.16), transparent 72%),
    radial-gradient(260px 180px at 82% 10%, rgba(255,255,255,.12), transparent 74%),
    linear-gradient(180deg, rgba(0,0,0,.14), transparent 28%),
    linear-gradient(120deg, transparent 0 38%, rgba(255,255,255,.06) 50%, transparent 64%);

  opacity:.92;
}

.closeX{ display:none !important; }

/* titles */
.rewardText{
  position:relative;
  z-index:2;
  margin:2px 0 12px;
  text-shadow:
    0 12px 26px rgba(0,0,0,.42),
    0 0 18px rgba(255,228,166,.10);
}
.rewardText .t1{
  font-size: clamp(22px, 4.2vw, 30px);
  font-weight: 1000;
  letter-spacing:.25px;
  margin:0;
}
.rewardText .t2{
  margin:6px 0 0;
  font-size: 12px;
  font-weight: 900;
  letter-spacing:.35px;
  opacity:.90;
}

/* ───────── Prize box (lebih kecil + sheen anti bocor) ───────── */
.rewardPrize{
  position:relative;
  z-index:2;

  display:grid;
  grid-template-columns: 48px 1fr; /* ✅ kecilkan kolom kiri */
  gap:10px;
  align-items:center;

  margin:0 auto 12px;
  width:100%;
  max-width:100%;

  /* ✅ lebih ramping */
  padding:12px 12px;
  border-radius:16px;

  border:1px solid rgba(255,228,166,.34);
  background:
    radial-gradient(520px 260px at 50% 0%, rgba(255,228,166,.14), transparent 72%),
    radial-gradient(260px 170px at 18% 14%, rgba(255,255,255,.06), transparent 70%),
    linear-gradient(180deg, rgba(12,2,6,.34), rgba(8,2,6,.22));

  box-shadow:
    0 16px 38px rgba(0,0,0,.38),
    inset 0 1px 0 rgba(255,255,255,.05);

  /* ✅ anti-bocor */
  overflow:hidden;
  isolation:isolate;
  transform: translateZ(0);

  /* ✅ clip presisi (paling ampuh buat kasus bocor kanan-atas) */
  clip-path: inset(0 round 16px);
  -webkit-clip-path: inset(0 round 16px);
}

/* sheen (lebih “masuk” & ke-clip rapat) */
.rewardPrize::after{
  content:"";
  position:absolute;

  /* ✅ jangan terlalu keluar biar tidak nyenggol tepi */
  inset:-34% -44%;
  pointer-events:none;

  background:
    linear-gradient(115deg,
      transparent 0 47%,
      rgba(255,255,255,0) 49%,
      rgba(255,255,255,.13) 52%,
      rgba(255,228,166,.09) 56%,
      rgba(255,255,255,0) 60%,
      transparent 0),
    radial-gradient(420px 220px at 50% 0%, rgba(255,228,166,.09), transparent 70%);

  mix-blend-mode: screen;
  opacity:.78;

  border-radius: inherit;

  /* ✅ mask tambahan supaya sheen “ketahan” di dalam shape (iOS friendly) */
  -webkit-mask-image: -webkit-radial-gradient(white, black);
  mask-image: radial-gradient(white, black);

  transform: translate3d(-16%, 10%, 0) rotate(-6deg);
  animation: prizeSheen 4.4s var(--ease2) infinite;
}

@keyframes prizeSheen{
  0%   { transform: translate3d(-20%, 12%, 0) rotate(-6deg); opacity:.58; }
  45%  { opacity:.86; }
  100% { transform: translate3d(18%, -10%, 0) rotate(-6deg); opacity:.58; }
}

/* thumb kecil & rapi */
.rewardThumb{
  width:48px;
  height:48px;
  border-radius:14px;
  border:1px solid rgba(255,228,166,.22);

  background:
    radial-gradient(40px 34px at 30% 22%, rgba(255,255,255,.14), transparent 70%),
    linear-gradient(135deg, rgba(255,228,166,.10), rgba(199,154,64,.05));

  display:grid;
  place-items:center;
  box-shadow: 0 10px 22px rgba(0,0,0,.22);
  overflow:hidden;
  position:relative;
  transform: translateZ(0);
}
.rewardThumb::after{
  content:"";
  position:absolute;
  inset:-12%;
  pointer-events:none;
  background: linear-gradient(120deg, transparent 0 46%, rgba(255,255,255,.10) 54%, transparent 64%);
  opacity:.48;
}
.rewardThumb img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  opacity:.96;
}

/* prize value */
.rewardValWrap{ min-width:0; }
.rewardValWrap .val{
  font-size:clamp(14px, 3.2vw, 18px);
  line-height:1.18;
  font-weight:1000;
  letter-spacing:.45px;
  color:rgba(255,246,224,.98);
  text-shadow:
    0 10px 22px rgba(0,0,0,.32),
    0 0 12px rgba(255,228,166,.08);
  word-break:break-word;
}

/* ───────── Status rows (lebih masuk & rapi) ───────── */
.popMeta{
  position:relative;
  z-index:2;

  /* semua row masuk ke dalam */
  margin: 10px auto 14px;
  padding: 0 6px;

  display:grid;
  gap:10px;
}

.metaRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;

  width:100%;
  padding:12px 12px;
  border-radius:16px;

  border:1px solid rgba(255,228,166,.16);
  background:
    radial-gradient(320px 160px at 20% 0%, rgba(255,228,166,.07), transparent 70%),
    rgba(12,2,6,.22);

  box-shadow: inset 0 1px 0 rgba(255,255,255,.04);
  overflow:hidden;
}
.metaRow .k{
  font-size:11px;
  letter-spacing:.12em;
  text-transform:uppercase;
  opacity:.78;
}
.metaRow .v{
  font-size:12px;
  font-weight:900;
  letter-spacing:.25px;
  color:rgba(255,228,166,.98);
  text-align:right;
  max-width: 70%;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

/* status note */
.statusNote{
  position:relative;
  z-index:2;
  margin:10px 0 0;
  font-size:12px;
  opacity:.88;
  min-height:16px;
}

/* buttons wrap */
.popupBtns{
  position:relative;
  z-index:2;
  display:grid;
  gap:12px;
  justify-items:center;
  margin-top:14px;
  padding-top:2px;
}

/* motion safety */
@media (prefers-reduced-motion: reduce){
  .popupCard{ animation:none; }
  .rewardPrize::after{ animation:none; opacity:.70; }
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 18B — OVERLAY HADIAH (GRID 4 PNG)
 * ─────────────────────────────────────────────────────────── */
#prizeOverlay{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:30;

  background:
    radial-gradient(900px 640px at 50% 22%, rgba(255,228,166,.10), transparent 62%),
    rgba(0,0,0,.44);

  padding:max(14px, calc(var(--safe-top) + 10px)) 14px calc(14px + var(--safe-bot));
  backdrop-filter: blur(6px) saturate(1.05);
  -webkit-backdrop-filter: blur(6px) saturate(1.05);
  animation: popFade .22s var(--ease2) both;
}

.prizeMiniCard{
  width:min(520px, 92vw);
  border-radius:22px;
  position:relative;
  padding:16px 14px 12px;
  text-align:center;

  background:
    radial-gradient(760px 420px at 50% 18%, rgba(255,255,255,.14), transparent 62%),
    linear-gradient(180deg, rgba(255,214,126,.14), rgba(255,214,126,.04)),
    linear-gradient(180deg, rgba(90,11,20,.92), rgba(22,4,10,.98));

  border:1px solid rgba(255,228,166,.44);
  box-shadow:
    0 30px 92px rgba(0,0,0,.62),
    0 12px 34px rgba(0,0,0,.38);

  overflow:hidden;
  transform: translateZ(0);
  animation: popIn2 .42s var(--ease2) both;
}
.prizeMiniCard::before{
  content:"";
  position:absolute;
  inset:10px;
  border-radius:18px;
  border:2px solid rgba(255,228,166,.70);
  box-shadow:
    inset 0 0 0 2px rgba(199,154,64,.18),
    inset 0 0 0 1px rgba(255,255,255,.08),
    0 0 14px rgba(255,228,166,.16);
  pointer-events:none;
}

.prizeMiniBody{
  position:relative;
  z-index:2;
  display:grid;
  justify-items:center;
  gap:10px;
  padding:6px 8px 8px;
}

.prizeMiniTitle{
  font-weight:1000;
  letter-spacing:.16em;
  font-size:12px;
  opacity:.92;
  color:rgba(255,228,166,.95);
  text-shadow:0 12px 26px rgba(0,0,0,.42);
}

.prizeGrid{
  width:100%;
  display:grid;
  grid-template-columns:repeat(2, minmax(0, 1fr));
  gap:12px;
  padding:6px 4px 2px;
}

.prizeItem{
  border-radius:18px;
  border:1px solid rgba(255,228,166,.22);
  background:
    radial-gradient(240px 150px at 30% 20%, rgba(255,255,255,.12), transparent 70%),
    rgba(10,2,6,.26);
  box-shadow: 0 14px 30px rgba(0,0,0,.32);
  padding:10px 10px 12px;
  overflow:hidden;

  transform:translateZ(0);
  transition:transform .16s var(--ease), filter .16s var(--ease), border-color .16s var(--ease);
}
@media (hover:hover){
  .prizeItem:hover{
    transform:translateY(-2px) scale(1.01);
    border-color: rgba(255,228,166,.42);
    filter:brightness(1.03);
  }
}
.prizeItem:active{ transform:translateY(0) scale(.995); }

.prizeThumb{
  width:100%;
  aspect-ratio:1/1;
  border-radius:16px;
  overflow:hidden;
  border:1px solid rgba(255,228,166,.18);
  background:
    radial-gradient(70px 62px at 32% 26%, rgba(255,255,255,.16), transparent 70%),
    linear-gradient(135deg, rgba(255,228,166,.08), rgba(199,154,64,.05));
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  display:grid;
  place-items:center;
}
.prizeThumb img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  opacity:.96;
}

.prizeName{
  margin-top:10px;
  font-weight:1000;
  letter-spacing:.35px;
  font-size:12px;
  color:rgba(255,246,224,.98);
  text-shadow:0 12px 26px rgba(0,0,0,.42);

  line-height:1.12;
  min-height: 30px;

  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;

  padding: 0 4px;

  /* biar rapi & konsisten */
  text-align:center;
  white-space:normal;
  word-break:break-word;
}
.prizeName br{ display:block; content:""; }

.prizeMiniHint{
  margin:2px 0 0;
  font-size:11px;
  opacity:.78;
  letter-spacing:.25px;
  line-height:1.35;
  max-width: 420px;
}

.prizeMiniBtns{
  position:relative;
  z-index:2;
  display:grid;
  gap:10px;
  justify-items:center;
  padding: 6px 8px 10px;
}

@media (max-width:420px){
  .prizeMiniCard{ width:min(460px, 92vw); }
  .prizeGrid{ gap:10px; }
  .prizeItem{ padding:9px 9px 11px; border-radius:16px; }
  .prizeThumb{ border-radius:14px; }
  .prizeName{ font-size:11px; min-height: 26px; }
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 18C — CLAIM LOADING OVERLAY (THEME SERAGAM)
 * ─────────────────────────────────────────────────────────── */
#claimOverlay{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:40;
  background:
    radial-gradient(900px 640px at 50% 24%, rgba(255,228,166,.12), transparent 60%),
    radial-gradient(980px 620px at 50% 72%, rgba(255,120,70,.08), transparent 62%),
    rgba(0,0,0,.78);
  backdrop-filter: blur(10px) saturate(1.10);
  -webkit-backdrop-filter: blur(10px) saturate(1.10);
  padding:18px;
}
.claimBox{
  width:min(520px, 92vw);
  border-radius: 22px;
  padding: 22px 18px;
  text-align:center;
  background:
    radial-gradient(760px 420px at 50% 18%, rgba(255,255,255,.14), transparent 62%),
    linear-gradient(180deg, rgba(255,214,126,.14), rgba(255,214,126,.04)),
    linear-gradient(180deg, rgba(90,11,20,.92), rgba(22,4,10,.98));
  border:1px solid rgba(255,228,166,.44);
  box-shadow:
    0 32px 100px rgba(0,0,0,.70),
    0 10px 34px rgba(0,0,0,.44);
  position:relative;
  overflow:hidden;
}
.claimBox::before{
  content:"";
  position:absolute;
  inset:10px;
  border-radius: 18px;
  border:2px solid rgba(255,228,166,.70);
  box-shadow:
    inset 0 0 0 2px rgba(199,154,64,.18),
    inset 0 0 0 1px rgba(255,255,255,.08),
    0 0 14px rgba(255,228,166,.16);
  pointer-events:none;
}
.claimSpin{
  position:relative;
  z-index:2;
  width:44px;
  height:44px;
  margin: 6px auto 12px;
  border-radius:999px;
  border:3px solid rgba(255,228,166,.22);
  border-top-color: rgba(255,228,166,.98);
  border-right-color: rgba(199,154,64,.86);
  animation: spin 0.85s linear infinite;
  box-shadow: 0 14px 30px rgba(0,0,0,.34);
}
.claimText{
  position:relative;
  z-index:2;
  margin:0;
  font-weight:1000;
  letter-spacing:.4px;
  color: rgba(255,246,224,.98);
  text-shadow:0 12px 26px rgba(0,0,0,.42);
  font-size: clamp(14px, 2.2vw, 16px);
}
.claimSub{
  position:relative;
  z-index:2;
  margin:8px 0 0;
  font-size:12px;
  opacity:.84;
  letter-spacing:.25px;
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 20 — RESPONSIVE TUNING
 * ─────────────────────────────────────────────────────────── */
@media (max-width:560px){
  :root{ --fxBright: 1.14; --fxContrast: 1.08; --fxSat: 1.12; }
  .card{ padding:24px 16px 18px; }
  .angpaoGrid{ gap:12px; }
  .cloudPng{ top:calc(var(--scene-top) + clamp(106px, 14vh, 200px)); }
  .lanternWrap.l2{ --lx: clamp(150px, 30vw, 310px); }
  .lanternWrap.l3{ --lx: calc(100% - clamp(150px, 30vw, 310px)); }
}
@media (max-width:420px){
  :root{ --cornerW: clamp(96px, 22vw, 140px); }
  .lanternWrap{ --lScale:.92; }
  .lanternWrap.l2, .lanternWrap.l3{ --lScale:.82; }
  .popupCard{ padding:24px 14px 16px; }
  .metaRow .v{ max-width: 64%; }
  .prizeMiniImg{ width:88px; height:88px; border-radius:16px; }
}
@media (max-height:650px){
  .cloudPng{ opacity:.90; }
  .bottomOrn{ height:min(46vh,420px); }
}

/* ─────────────────────────────────────────────────────────────
 * BLOK 21 — REDUCED MOTION
 * ─────────────────────────────────────────────────────────── */
@media (prefers-reduced-motion:reduce){
  .lanternWrap, .cloudPng, .card, .bottomCloudPng{ animation:none !important; }
  .lanternWrap::after{ display:none !important; }
  .angpaoBtn, button{ transition:none !important; }
  button::before{ display:none; }
  .spinner, .claimSpin{ animation:none !important; }
}
</style>
</head>

<body>

  <!-- SVG DEFINITIONS -->
  <svg width="0" height="0" style="position:absolute;left:-9999px;top:-9999px"
       aria-hidden="true" focusable="false"
       xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="lap-gold" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="#fff6df"/>
        <stop offset=".35" stop-color="#ffe4a6"/>
        <stop offset=".72" stop-color="#f2c96f"/>
        <stop offset="1" stop-color="#c79a40"/>
      </linearGradient>
      <linearGradient id="lap-gold-deep" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="#f2c96f"/>
        <stop offset="1" stop-color="#8a6424"/>
      </linearGradient>

      <linearGradient id="lap-red" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0" stop-color="#ff3a44"/>
        <stop offset=".55" stop-color="#d51a2b"/>
        <stop offset="1" stop-color="#7f0a16"/>
      </linearGradient>

      <radialGradient id="lap-glow" cx=".5" cy=".42" r=".62">
        <stop offset="0" stop-color="#fff6df" stop-opacity=".95"/>
        <stop offset=".55" stop-color="#ffd37a" stop-opacity=".55"/>
        <stop offset="1" stop-color="#ff8b2c" stop-opacity="0"/>
      </radialGradient>

      <linearGradient id="lap-waveRed" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0" stop-color="#a40f1f"/>
        <stop offset=".55" stop-color="#7f0a16"/>
        <stop offset="1" stop-color="#520610"/>
      </linearGradient>
      <linearGradient id="lap-waveGold" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0" stop-color="#ffe4a6"/>
        <stop offset="1" stop-color="#c79a40"/>
      </linearGradient>

      <symbol id="lap-lantern" viewBox="0 0 140 220">
        <path d="M70 0v34" stroke="rgba(255,228,166,.88)" stroke-width="3" stroke-linecap="round"/>
        <path d="M52 34h36c4 0 7 3 7 7v6H45v-6c0-4 3-7 7-7Z" fill="url(#lap-gold)" opacity=".95"/>
        <path d="M45 47h50" stroke="rgba(0,0,0,.18)" stroke-width="3" stroke-linecap="round" opacity=".45"/>

        <path d="M40 50c8-18 52-18 60 0v92c-6 18-54 18-60 0V50Z"
              fill="url(#lap-red)" stroke="url(#lap-gold)" stroke-width="3" stroke-linejoin="round"/>

        <ellipse cx="70" cy="94" rx="34" ry="44" fill="url(#lap-glow)"/>

        <path d="M48 52c6-12 38-12 44 0" fill="none" stroke="rgba(255,228,166,.62)" stroke-width="3" stroke-linecap="round"/>
        <path d="M48 142c6 12 38 12 44 0" fill="none" stroke="rgba(255,228,166,.62)" stroke-width="3" stroke-linecap="round"/>

        <path d="M56 60c0-6 5-10 10-10h10c5 0 10 4 10 10v78c0 6-5 10-10 10H66c-5 0-10-4-10-10V60Z"
              fill="rgba(255,255,255,.10)"/>

        <path d="M52 146h36c4 0 7 3 7 7v6H45v-6c0-4 3-7 7-7Z" fill="url(#lap-gold)" opacity=".92"/>
        <path d="M70 160v16" stroke="rgba(255,228,166,.90)" stroke-width="3" stroke-linecap="round"/>
        <circle cx="70" cy="182" r="6" fill="url(#lap-gold)"/>
        <path d="M70 188v22" stroke="rgba(255,228,166,.90)" stroke-width="3" stroke-linecap="round"/>
        <path d="M62 210h16l-8 14Z" fill="url(#lap-gold-deep)" opacity=".92"/>
      </symbol>

      <symbol id="lap-bottom" viewBox="0 0 1600 720">
        <path d="M0 540C220 500 340 640 560 600C760 564 860 470 1040 520C1230 574 1320 682 1600 630V720H0Z"
              fill="url(#lap-waveRed)" opacity=".92"/>
        <path d="M0 590C240 545 360 680 580 640C780 605 900 520 1080 570C1260 625 1360 715 1600 670"
              fill="none" stroke="url(#lap-waveGold)" stroke-width="10" stroke-linecap="round" opacity=".55"/>
        <path d="M0 640C260 610 420 710 640 680C860 652 980 590 1160 628C1340 666 1440 730 1600 710"
              fill="none" stroke="rgba(255,228,166,.28)" stroke-width="8" stroke-linecap="round"/>
        <g opacity=".18">
          <circle cx="180" cy="610" r="12" fill="url(#lap-gold)"/>
          <circle cx="260" cy="645" r="8" fill="url(#lap-gold)"/>
          <circle cx="1320" cy="640" r="10" fill="url(#lap-gold)"/>
          <circle cx="1440" cy="610" r="7" fill="url(#lap-gold)"/>
        </g>
      </symbol>
    </defs>
  </svg>

  <!-- Decorative scene -->
  <div class="scene" aria-hidden="true">
    <div class="corner tl"></div>
    <div class="corner tr"></div>

    <div class="lanternWrap l1"><svg viewBox="0 0 140 220" focusable="false"><use href="#lap-lantern"></use></svg></div>
    <div class="lanternWrap l2"><svg viewBox="0 0 140 220" focusable="false"><use href="#lap-lantern"></use></svg></div>
    <div class="lanternWrap l3"><svg viewBox="0 0 140 220" focusable="false"><use href="#lap-lantern"></use></svg></div>
    <div class="lanternWrap l4"><svg viewBox="0 0 140 220" focusable="false"><use href="#lap-lantern"></use></svg></div>

    <div class="cloudPng cLeft"></div>
    <div class="cloudPng cMid"></div>
    <div class="cloudPng cRight"></div>

    <div class="bottomCloudPng"></div>

    <svg class="bottomOrn" viewBox="0 0 1600 720" preserveAspectRatio="none" focusable="false">
      <use href="#lap-bottom"></use>
    </svg>
  </div>

  <!-- PAGE TITLE -->
  <header class="pageTitle" aria-label="Judul Halaman">
    <div class="pageTitleInner">
      <div class="ptLine1">
        <span class="ptWelcome">SELAMAT DATANG DI</span>
        <span class="ptBrand">MADETOTO2</span>
      </div>
      <div class="ptLine2">Lucky Ang Pao - Keberuntungan Ang Pao</div>
      <div class="ptLine3">Hadiah Total Jutaan! Menang Besar</div>
    </div>
  </header>

  <!-- UI -->
  <div class="ui">
    <div class="uiInner">

      <!-- Login -->
      <div class="card" id="login-menu">
        <div class="innerPattern"></div>
        <h1 class="title" id="ui-title">Lucky Ang Pao — Chinese New Year 2026</h1>
        <p class="sub" id="ui-sub">Masukkan User ID Anda lalu mulai permainan</p>

        <div class="fields">
          <input type="text" id="username" placeholder="Contoh: USER123" autocomplete="username" inputmode="text" aria-label="User ID"/>
        </div>

        <div class="btnRow">
          <button id="btnStart" type="button">MULAI</button>
        </div>

        <p class="err" id="err" role="alert" aria-live="polite"></p>
        <div class="hint" id="ui-hint">© 2025 Admin. All rights reserved.</div>
      </div>

      <!-- Main -->
      <div class="card" id="main-menu">
        <div class="innerPattern"></div>
        <h1 class="title" id="main-title">Pilih Ang Pao Keberuntunganmu!</h1>
        <div class="angpaoGrid" id="angpao-grid" aria-label="Pilih salah satu Ang Pao"></div>

        <div class="btnRow" style="margin-top:12px">
          <button id="btnShowPrize" class="btnGhost" type="button">HADIAH</button>
        </div>

        <div class="hint" id="main-hint">Klik salah satu Ang Pao</div>
      </div>

    </div>
  </div>

<!-- OVERLAY HADIAH (GRID 4 PNG) -->
<div id="prizeOverlay" role="dialog" aria-modal="true" aria-label="Daftar Hadiah">
  <div class="prizeMiniCard" role="document">
    <div class="prizeMiniBody">
      <div class="prizeMiniTitle" id="prizeOverlayTitle">HADIAH UTAMA</div>

      <!-- GRID 4 -->
      <div class="prizeGrid" id="prizeGrid" aria-label="Grid hadiah"></div>

      <p class="prizeMiniHint" id="prizeOverlayHint">—</p>
    </div>

    <div class="prizeMiniBtns">
      <button id="btnPrizeOk" type="button">OK</button>
    </div>
  </div>
</div>

  <!-- Popup (reward) -->
  <div id="popup" role="dialog" aria-modal="true" aria-label="Hadiah">
    <div class="popupCard" role="document" aria-describedby="reward-text">
      <button class="closeX" id="btnClose" type="button" aria-label="Tutup">&times;</button>

      <div class="rewardText" id="reward-text">
        <div class="t1">SELAMAT</div>
        <div class="t2">Anda Mendapatkan Hadiah</div>
      </div>

<div class="rewardPrize" aria-label="Detail hadiah">
  <div class="rewardThumb" aria-hidden="true">
    <img id="prize-img" alt="" decoding="async" loading="eager">
  </div>
  <div class="rewardValWrap">
    <div class="val" id="prize-val">—</div>
  </div>
</div>

      <div class="popMeta" aria-label="Detail pengguna">
        <div class="metaRow">
          <div class="k">User ID</div>
          <div class="v" id="meta-user">—</div>
        </div>
        <div class="metaRow">
          <div class="k">Waktu</div>
          <div class="v" id="meta-time">—</div>
        </div>
      </div>

      <div class="statusNote" id="status-note" aria-live="polite"></div>

      <div class="popupBtns">
        <button id="btnClaim" type="button">
          <span class="btnLoading" id="claimLabel">CLAIM SEKARANG</span>
        </button>
        <button id="btnShare" class="btnGhost" type="button">BAGIKAN</button>
      </div>
    </div>
  </div>

  <!-- CLAIM LOADING OVERLAY -->
  <div id="claimOverlay" aria-hidden="true">
    <div class="claimBox" role="status" aria-live="polite">
      <div class="claimSpin" aria-hidden="true"></div>
      <p class="claimText" id="claimOverlayText">Memproses klaim...</p>
      <p class="claimSub" id="claimOverlaySub">Mohon tunggu sebentar</p>
    </div>
  </div>

  <!-- Audio -->
  <audio id="bgMusic" loop preload="auto"></audio>
  <audio id="winSound" preload="auto"></audio>
  <audio id="clickSound" preload="auto"></audio>

<script>
(() => {
  "use strict";

  // =====================================================
  // ✅ CONFIG — EDIT DI SINI SAJA
  // =====================================================
  const CONFIG = {
    site: {
      title: "Lucky Ang Pao",
      shareTitle: "Lucky Ang Pao",
      baseUrl: "https://madetoto2.info/",
      claimRedirectUrl: "https://madetoto2.info/",
      requireUsername: true,
      loginSubtitle: "Masukkan User ID Anda lalu mulai permainan",
      hintLogin: "© 2025 Admin. All rights reserved.",
      hintMain: "Pilih salah satu Ang Pao"
    },

    images: {
      cornerLeft:  "https://i.postimg.cc/ZKHcV5Rq/Pngtree-chinese-gradient-auspicious-cloud-5400711.png",
      cornerRight: "https://i.postimg.cc/ZKHcV5Rq/Pngtree-chinese-gradient-auspicious-cloud-5400711.png",
      cloudLeft:   "https://i.postimg.cc/ZKHcV5Rq/Pngtree-chinese-gradient-auspicious-cloud-5400711.png",
      cloudMid:    "https://i.postimg.cc/ZKHcV5Rq/Pngtree-chinese-gradient-auspicious-cloud-5400711.png",
      cloudRight:  "https://i.postimg.cc/ZKHcV5Rq/Pngtree-chinese-gradient-auspicious-cloud-5400711.png",
      bottomCloud: "https://i.postimg.cc/yd8Gh12G/Wave.png",
      angpao:      "https://i.postimg.cc/CxRSkfR6/511.png"
    },

prizeIntro: {
  enabled: true,
  showOncePerDevice: true,
  storageKey: "lap_prize_intro_seen_v2",

  // 4 item grid (isi URL PNG kamu)
  items: [
    { name: "iPhone 17 Pro Max", img: "https://YOUR-PNG-1.png" },
    { name: "BONUS IMLEK 10%", img: "https://YOUR-PNG-2.png" },
    { name: "Uang Tunai Rp 3.000.00", img: "https://YOUR-PNG-3.png" },
    { name: "Free Chip Rp 200.000", img: "https://YOUR-PNG-4.png" }
  ],

  hintText: "Hadiah utama event ini. Klik OK untuk lanjut bermain."
},
    game: {
      envelopes: 9,
      lockAfterPick: true,

      oneUsernamePerDevice: true,
      onePlayPerDevice: true,

      storageKey: "lap_cny_2026_v1",

      primaryPrizes: ["BONUS IMLEK 20%", "Rp 200.000"],
      autoLockPrimaryMode: "fixed", // "off" | "random" | "fixed"
      lockedPrizeFixed: "BONUS IMLEK 20%",

      prizes: [
        { label: "Rp 5.000",        weight: 28 },
        { label: "Rp 10.000",       weight: 22 },
        { label: "Rp 15.000",       weight: 16 },
        { label: "Rp 20.000",       weight: 12 },
        { label: "Rp 25.000",       weight: 9  },
        { label: "Rp 30.000",       weight: 6  },
        { label: "Rp 50.000",       weight: 4  },
        { label: "Rp 75.000",       weight: 2  },
        { label: "Rp 100.000",      weight: 1  },
        { label: "BONUS IMLEK 20%", weight: 2  },
        { label: "Rp 200.000",      weight: 1  }
      ]
    },

    api: {
      enabled: false,
      timeoutMs: 8000,
      headers: { "Content-Type": "application/json" },
      endpoints: {
        reveal: "/api/angpao/reveal",
        claim:  "/api/angpao/claim"
      }
    },

    // ✅ AUDIO
    audio: {
      enabled: true,
      bgUrl:   "https://s19.aconvert.com/convert/p3r68-cdx67/pnilp-nw2w7.mp3",
      winUrl:  "",
      clickUrl:"",
      volumeBg: 0.55,
      volumeWin: 0.75,
      volumeClick: 0.55,
      fadeMs: 420
    },

    // ✅ CLAIM UX
    claimUX: {
      loadingMs: 1800,
      openInNewTab: true,
      overlayText: "Menghubungkan live chat...",
      overlaySub: "Mohon tunggu sebentar"
    },

    security: {
      enabled: true,
      blockContextMenu: true,
      blockKeys: true,
      devtoolsDetect: false,
      devtoolsThresholdPx: 160,
      devtoolsPollMs: 700,
      overlayTitle: "AKSES TERBATAS",
      overlayText: "Konten ini dilindungi. Silakan gunakan akses resmi dari Pengembang."
    }
  };

  // =====================================================
  // UTIL
  // =====================================================
  const $  = (q, r=document) => r.querySelector(q);
  const $$ = (q, r=document) => Array.from(r.querySelectorAll(q));
  const root = document.documentElement;

  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
  const nowMs = () => Date.now();

  function escapeText(s){
    return String(s ?? "").replace(/\s+/g, " ").trim();
  }

  function setCSSUrlVar(name, url){
    if (!url) return;
    root.style.setProperty(name, `url("${String(url).replace(/"/g,'\\"')}")`);
  }

  function preloadImage(url){
    if (!url) return;
    try{
      const link = document.createElement("link");
      link.rel = "preload";
      link.as = "image";
      link.href = url;
      link.crossOrigin = "anonymous";
      document.head.appendChild(link);
    }catch{}
    try{
      const img = new Image();
      img.decoding = "async";
      img.loading = "eager";
      img.src = url;
    }catch{}
  }

  function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

  function weightedPick(items){
    const pool = (items || []).filter(x => x && x.label && Number.isFinite(x.weight) && x.weight > 0);
    if (!pool.length) return "Hadiah Misterius";
    let total = 0;
    for (const it of pool) total += it.weight;
    let r = Math.random() * total;
    for (const it of pool){
      r -= it.weight;
      if (r <= 0) return it.label;
    }
    return pool[pool.length - 1].label;
  }

function fmtTime(ts = Date.now(), tz = "Asia/Jakarta"){
  try{
    const d = ts instanceof Date ? ts : new Date(ts);
    if (isNaN(d)) return "";
    const date = new Intl.DateTimeFormat("id-ID", {
      day:"2-digit", month:"2-digit", year:"numeric", timeZone: tz
    }).format(d).replace(/\./g, "/");
    const time = new Intl.DateTimeFormat("id-ID", {
      hour:"2-digit", minute:"2-digit", hour12:false, timeZone: tz
    }).format(d).replace(/:/g, ".");
    return `${date} • ${time}`;
  } catch { return ""; }
}
  async function apiFetch(path, body){
    const base = (CONFIG.site.baseUrl || "").replace(/\/+$/,"");
    const url  = (String(path || "").startsWith("http") ? path : (base + path));

    const ac = new AbortController();
    const t  = setTimeout(() => ac.abort(), CONFIG.api.timeoutMs || 8000);

    try{
      const res = await fetch(url, {
        method: "POST",
        headers: CONFIG.api.headers || { "Content-Type": "application/json" },
        body: JSON.stringify(body || {}),
        signal: ac.signal
      });

      const txt = await res.text();
      let json = null;
      try{ json = JSON.parse(txt); }catch{}

      if (!res.ok){
        const msg = (json && (json.message || json.error)) ? (json.message || json.error) : (txt || "Request gagal");
        throw new Error(msg);
      }
      return json ?? { ok:true, raw: txt };
    } finally {
      clearTimeout(t);
    }
  }

  // =====================================================
  // META AUTO
  // =====================================================
  function applyMeta(){
    const base = escapeText(CONFIG.site.baseUrl) || window.location.href;
    const ogUrl = $('meta[property="og:url"]');
    const canonical = $('link[rel="canonical"]');
    if (ogUrl) ogUrl.setAttribute("content", base);
    if (canonical) canonical.setAttribute("href", base);

    const ogTitle = $('meta[property="og:title"]');
    if (ogTitle) ogTitle.setAttribute("content", escapeText(CONFIG.site.title || document.title));

    const ogImg = $('meta[property="og:image"]');
    const candidateImg = escapeText(CONFIG.images?.angpao || "");
    if (ogImg && candidateImg) ogImg.setAttribute("content", candidateImg);
  }

  // =====================================================
  // STORAGE
  // =====================================================
  const STORE = (() => {
    const base = String(CONFIG.game.storageKey || "lap_cny_2026_v1");
    const kUser   = `${base}:user`;
    const kPlayed = `${base}:played`;
    const kResult = `${base}:result`;

    const get = (k) => { try{ return localStorage.getItem(k); }catch{ return null; } };
    const set = (k, v) => { try{ localStorage.setItem(k, v); }catch{} };
    const getJSON = (k) => {
      const v = get(k);
      if (!v) return null;
      try{ return JSON.parse(v); }catch{ return null; }
    };
    const setJSON = (k, obj) => set(k, JSON.stringify(obj));

    return {
      keys: { kUser, kPlayed, kResult },
      get, set, getJSON, setJSON,
      isPlayed(){ return get(kPlayed) === "1"; },
      setPlayed(){ set(kPlayed, "1"); },
      getUser(){ return get(kUser) || ""; },
      setUser(u){ set(kUser, String(u || "")); },
      getResult(){ return getJSON(kResult); },
      setResult(obj){ setJSON(kResult, obj); }
    };
  })();

  // =====================================================
  // SECURITY OVERLAY (Deterrent) — SAFE NO-CRASH
  // =====================================================
  const Security = (() => {
    if (!CONFIG.security?.enabled) return { init(){}, lock(){}, isLocked(){ return false; } };

    let locked = false;
    let overlay = null;

    function ensureStyle(){
      if ($("#secOverlayStyle")) return;
      const st = document.createElement("style");
      st.id = "secOverlayStyle";
      st.textContent = `
        #secOverlay{
          position:fixed; inset:0; z-index:999999;
          display:none; align-items:center; justify-content:center;
          background: rgba(6,6,10,.78);
          backdrop-filter: blur(10px);
          -webkit-backdrop-filter: blur(10px);
          color:#fff;
          font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
          text-align:center;
          padding: 24px;
        }
        #secOverlay .box{
          width:min(560px, 92vw);
          border-radius: 18px;
          padding: 22px 18px;
          background: rgba(255,255,255,.06);
          border: 1px solid rgba(255,255,255,.14);
          box-shadow: 0 30px 80px rgba(0,0,0,.35);
        }
        #secOverlay .t{
          font-weight: 800;
          letter-spacing: .14em;
          font-size: 14px;
          opacity: .95;
        }
        #secOverlay .m{
          margin-top: 10px;
          font-size: 14px;
          line-height: 1.55;
          opacity: .92;
        }
        #secOverlay .s{
          margin-top: 14px;
          font-size: 12px;
          opacity: .65;
        }
      `;
      document.head.appendChild(st);
    }

    function ensureOverlay(){
      if (overlay) return overlay;
      ensureStyle();
      overlay = document.createElement("div");
      overlay.id = "secOverlay";
      overlay.innerHTML = `
        <div class="box" role="alert" aria-live="assertive">
          <div class="t">${escapeText(CONFIG.security.overlayTitle || "AKSES TERBATAS")}</div>
          <div class="m" id="secOverlayMsg">${escapeText(CONFIG.security.overlayText || "Konten ini dilindungi.")}</div>
          <div class="s">If you believe this is an error, please contact admin.</div>
        </div>
      `;
      document.body.appendChild(overlay);
      return overlay;
    }

    function lock(reason){
      if (locked) return;
      locked = true;
      const ov = ensureOverlay();
      const msg = $("#secOverlayMsg", ov);
      if (msg && reason) msg.textContent = escapeText(reason);
      ov.style.display = "flex";
      try{
        document.documentElement.style.overflow = "hidden";
        document.body.style.overflow = "hidden";
      }catch{}
    }

    function isLocked(){ return locked; }

    function keyBlocker(e){
      if (!CONFIG.security.blockKeys) return;
      if (locked) { e.preventDefault(); e.stopPropagation(); return; }

      const k = (e.key || "").toLowerCase();
      const ctrl = e.ctrlKey || e.metaKey;
      const shift = e.shiftKey;

      const blocked =
        (k === "f12") ||
        (ctrl && k === "u") ||
        (ctrl && shift && (k === "i" || k === "j" || k === "c")) ||
        (ctrl && k === "s") ||
        (ctrl && k === "p");

      if (blocked){
        e.preventDefault();
        e.stopPropagation();
        lock("Akses terbatas.");
      }
    }

    function contextBlocker(e){
      if (!CONFIG.security.blockContextMenu) return;
      if (locked) { e.preventDefault(); return; }
      e.preventDefault();
      lock("Akses terbatas.");
    }

    function devtoolsDetector(){
      if (!CONFIG.security.devtoolsDetect) return;
      const thr = clamp(+CONFIG.security.devtoolsThresholdPx || 160, 80, 420);
      const w = Math.abs((window.outerWidth || 0) - (window.innerWidth || 0));
      const h = Math.abs((window.outerHeight || 0) - (window.outerHeight ? window.innerHeight : 0));
      if (w > thr || h > thr) lock("Akses terbatas.");
    }

    function init(){
      window.addEventListener("keydown", keyBlocker, true);
      window.addEventListener("contextmenu", contextBlocker, true);
      if (CONFIG.security.devtoolsDetect){
        setInterval(devtoolsDetector, clamp(+CONFIG.security.devtoolsPollMs || 700, 250, 2000));
      }
    }

    return { init, lock, isLocked };
  })();

  const onReady = (fn) => {
    if (document.readyState === "loading"){
      document.addEventListener("DOMContentLoaded", fn, { once:true });
    } else fn();
  };

  onReady(() => {
    // =====================================================
    // DOM
    // =====================================================
    const loginMenu  = $("#login-menu");
    const mainMenu   = $("#main-menu");
    const errEl      = $("#err");
    const usernameEl = $("#username");

    const btnStart = $("#btnStart");

    const grid     = $("#angpao-grid");
    const popup    = $("#popup");
    const btnClose = $("#btnClose");
    const btnClaim = $("#btnClaim");
    const btnShare = $("#btnShare");

    const prizeVal   = $("#prize-val");
    const metaUser   = $("#meta-user");
    const metaTime   = $("#meta-time");

    const statusNote = $("#status-note");

    const bgMusic    = $("#bgMusic");
    const winSound   = $("#winSound");
    const clickSound = $("#clickSound");

    const uiTitle  = $("#ui-title");
    const uiSub    = $("#ui-sub");
    const uiHint   = $("#ui-hint");
    const mainHint = $("#main-hint");

    const claimLabel = $("#claimLabel");

    // prize intro overlay
    const prizeOverlay = $("#prizeOverlay");
    const prizeOverlayImg = $("#prizeOverlayImg");
    const prizeOverlayName = $("#prizeOverlayName");
    const prizeOverlayHint = $("#prizeOverlayHint");
    const btnPrizeOk = $("#btnPrizeOk");
    const btnShowPrize = $("#btnShowPrize");

    // claim overlay
    const claimOverlay = $("#claimOverlay");
    const claimOverlayText = $("#claimOverlayText");
    const claimOverlaySub  = $("#claimOverlaySub");

    // =====================================================
    // APPLY CONFIG
    // =====================================================
    document.title = CONFIG.site.title || document.title;
    if (uiTitle) uiTitle.textContent = CONFIG.site.title || uiTitle.textContent;
    if (uiSub) uiSub.textContent = CONFIG.site.loginSubtitle || uiSub.textContent;
    if (uiHint) uiHint.textContent = CONFIG.site.hintLogin || uiHint.textContent;
    if (mainHint) mainHint.textContent = CONFIG.site.hintMain || mainHint.textContent;

    setCSSUrlVar("--corner-left-url",  CONFIG.images.cornerLeft);
    setCSSUrlVar("--corner-right-url", CONFIG.images.cornerRight);
    setCSSUrlVar("--cloud-left-url",   CONFIG.images.cloudLeft);
    setCSSUrlVar("--cloud-mid-url",    CONFIG.images.cloudMid);
    setCSSUrlVar("--cloud-right-url",  CONFIG.images.cloudRight);
    setCSSUrlVar("--bottom-cloud-url", CONFIG.images.bottomCloud);
    setCSSUrlVar("--angpao-url",       CONFIG.images.angpao);

    Object.values(CONFIG.images || {}).forEach(preloadImage);
    if (CONFIG.prizeIntro?.prizeImg) preloadImage(CONFIG.prizeIntro.prizeImg);

    applyMeta();

    if (CONFIG.audio.enabled){
      if (bgMusic && CONFIG.audio.bgUrl) bgMusic.src = CONFIG.audio.bgUrl;
      if (winSound && CONFIG.audio.winUrl) winSound.src = CONFIG.audio.winUrl;
      if (clickSound && CONFIG.audio.clickUrl) clickSound.src = CONFIG.audio.clickUrl;
    }

    Security.init();

    // =====================================================
    // AUDIO ENGINE (BG loop + click + win) + fade tab
    // =====================================================
    const AudioEngine = (() => {
      if (!CONFIG.audio.enabled) return { onGesture(){}, ensureBg(){}, click(){}, win(){}, stopAll(){}, onPopupOpen(){}, onPopupClose(){} };

      const fadeMs = clamp(+CONFIG.audio.fadeMs || 420, 120, 1600);
      let gesture = false;

      const safePlay = (a) => {
        if (!a || !a.src) return;
        const p = a.play();
        if (p && typeof p.catch === "function") p.catch(() => {});
      };
      const safePause = (a) => { if (!a) return; try{ a.pause(); }catch{} };
      const setVol = (a, v) => { if (!a) return; a.volume = clamp(v, 0, 1); };

      const Fade = (() => {
        const state = new WeakMap();
        function fadeTo(a, target, ms, after){
          if (!a) return;
          const prev = state.get(a);
          if (prev?.raf) cancelAnimationFrame(prev.raf);

          const start = performance.now();
          const from = Number.isFinite(a.volume) ? a.volume : 0;
          const dur = clamp(ms || fadeMs, 80, 2000);

          const step = (t) => {
            const k = clamp((t - start) / dur, 0, 1);
            const e = 1 - Math.pow(1 - k, 3);
            setVol(a, from + (target - from) * e);
            if (k < 1){
              const raf = requestAnimationFrame(step);
              state.set(a, { raf });
            } else {
              state.set(a, { raf: 0 });
              after && after();
            }
          };

          const raf = requestAnimationFrame(step);
          state.set(a, { raf });
        }
        return { fadeTo };
      })();

      if (bgMusic){
        bgMusic.loop = true;
        bgMusic.preload = "auto";
        bgMusic.playsInline = true;
        setVol(bgMusic, 0);
      }
      if (winSound){
        winSound.loop = false;
        winSound.preload = "auto";
        winSound.playsInline = true;
        setVol(winSound, clamp(CONFIG.audio.volumeWin ?? 0.75, 0, 1));
      }
      if (clickSound){
        clickSound.loop = false;
        clickSound.preload = "auto";
        clickSound.playsInline = true;
        setVol(clickSound, clamp(CONFIG.audio.volumeClick ?? 0.55, 0, 1));
      }

      function ensureBg(){
        if (!gesture) return;
        if (!bgMusic || !bgMusic.src) return;
        if (document.hidden) return;

        safePlay(bgMusic);
        const target = clamp(CONFIG.audio.volumeBg ?? 0.55, 0, 1);
        Fade.fadeTo(bgMusic, target, fadeMs);
      }

      function fadeOutBgPause(){
        if (!bgMusic) return;
        Fade.fadeTo(bgMusic, 0, fadeMs, () => safePause(bgMusic));
      }

      function click(){
        if (!gesture) return;
        if (!clickSound || !clickSound.src) return;
        try{ clickSound.currentTime = 0; }catch{}
        setVol(clickSound, clamp(CONFIG.audio.volumeClick ?? 0.55, 0, 1));
        safePlay(clickSound);
      }

      function win(){
        if (!gesture) return;
        if (!winSound || !winSound.src) return;
        try{ winSound.currentTime = 0; }catch{}
        setVol(winSound, clamp(CONFIG.audio.volumeWin ?? 0.75, 0, 1));
        safePlay(winSound);
      }

      function stopAll(){
        if (bgMusic){ Fade.fadeTo(bgMusic, 0, 140, () => safePause(bgMusic)); }
        if (winSound){ safePause(winSound); try{ winSound.currentTime = 0; }catch{} }
        if (clickSound){ safePause(clickSound); try{ clickSound.currentTime = 0; }catch{} }
      }

      function onGesture(){ gesture = true; ensureBg(); }

      document.addEventListener("visibilitychange", () => {
        if (document.hidden) fadeOutBgPause();
        else ensureBg();
      }, { passive:true });

      window.addEventListener("pagehide", stopAll, { passive:true });

      function onPopupOpen(){ ensureBg(); }
      function onPopupClose(){}

      return { onGesture, ensureBg, click, win, stopAll, onPopupOpen, onPopupClose };
    })();

    const markGesture = () => AudioEngine.onGesture();
    window.addEventListener("pointerdown", markGesture, { passive:true, once:true });
    window.addEventListener("keydown", markGesture, { passive:true, once:true });

    document.addEventListener("pointerdown", (e) => {
      const b = e.target?.closest?.("button");
      const ap = e.target?.closest?.(".angpaoBtn");
      if (b || ap) AudioEngine.click?.();
    }, { passive:true });

    // =====================================================
    // PRIZE INTRO OVERLAY (MINIMAL)
    // =====================================================
    const PrizeIntro = (() => {
  const conf = CONFIG.prizeIntro || {};
  const enabled = !!conf.enabled;
  const LSKEY = String(conf.storageKey || "lap_prize_intro_seen_v2");

  const hasSeen = () => {
    if (!enabled) return true;
    if (!conf.showOncePerDevice) return false;
    try{ return localStorage.getItem(LSKEY) === "1"; }catch{ return false; }
  };

  const setSeen = () => {
    if (!enabled) return;
    if (!conf.showOncePerDevice) return;
    try{ localStorage.setItem(LSKEY, "1"); }catch{}
  };

  function normalizeItems(){
    const items = Array.isArray(conf.items) ? conf.items : [];
    const out = items
      .map(it => ({
        name: String(it?.name || "").trim(),
        img:  String(it?.img  || "").trim()
      }))
      .filter(it => it.name || it.img);

    // pastikan 4 slot (kalau kurang, isi placeholder ringan)
    while (out.length < 4){
      out.push({ name: "Hadiah", img: "" });
    }
    return out.slice(0, 4);
  }

  function hydrate(){
    if (!enabled) return;

    const hint = String(conf.hintText || "").trim() || "Hadiah utama event ini. Klik OK untuk lanjut bermain.";
    if (prizeOverlayHint) prizeOverlayHint.textContent = hint;

    const items = normalizeItems();

    // preload
    for (const it of items){
      if (it.img && /^https?:\/\//i.test(it.img)) preloadImage(it.img);
    }

    if (!prizeGrid) return;
    prizeGrid.innerHTML = "";

    const frag = document.createDocumentFragment();
    for (let i = 0; i < 4; i++){
      const it = items[i];

      const card = document.createElement("div");
      card.className = "prizeItem";
      card.setAttribute("role", "group");
      card.setAttribute("aria-label", it.name ? `Hadiah ${it.name}` : `Hadiah ${i+1}`);

      const thumb = document.createElement("div");
      thumb.className = "prizeThumb";

      const img = document.createElement("img");
      img.alt = it.name ? it.name : `Hadiah ${i+1}`;
      img.decoding = "async";
      img.loading = "eager";

      if (it.img && /^https?:\/\//i.test(it.img)){
        img.src = it.img;
      } else {
        // placeholder ringan (no external)
        img.src =
          "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cdefs%3E%3CradialGradient id='g' cx='.35' cy='.28' r='.9'%3E%3Cstop offset='0' stop-color='%23fff6df' stop-opacity='.20'/%3E%3Cstop offset='1' stop-color='%23c79a40' stop-opacity='.05'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='160' height='160' rx='26' fill='url(%23g)'/%3E%3Cpath d='M34 104l24-28 18 16 30-38 22 50H34Z' fill='rgba(255,228,166,.18)'/%3E%3Ccircle cx='56' cy='54' r='14' fill='rgba(255,228,166,.14)'/%3E%3C/svg%3E";
      }

function escHtml(s){
  return String(s ?? "")
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#39;");
}

function twoLineLabel(label){
  const t = String(label || "").replace(/\s+/g, " ").trim();
  if (!t) return { a:"Hadiah", b:"" };

  const parts = t.split(" ");
  if (parts.length <= 2){
    return { a: parts.join(" "), b: "" };
  }
  return {
    a: parts.slice(0, 2).join(" "),
    b: parts.slice(2).join(" ")
  };
}

const name = document.createElement("div");
name.className = "prizeName";
const L = twoLineLabel(it.name || `Hadiah ${i+1}`);
name.innerHTML = L.b ? `${escHtml(L.a)}<br>${escHtml(L.b)}` : escHtml(L.a);

      thumb.appendChild(img);
      card.appendChild(thumb);
      card.appendChild(name);
      frag.appendChild(card);
    }

    prizeGrid.appendChild(frag);
  }

  function open(){
    if (!enabled || !prizeOverlay) return;
    hydrate();
    prizeOverlay.style.display = "flex";
    document.body.classList.add("modal-open");
  }

  function close(){
    if (!enabled || !prizeOverlay) return;
    prizeOverlay.style.display = "none";
    document.body.classList.remove("modal-open");
  }

  function init(){
    if (!enabled) return;

    hydrate();

    btnPrizeOk?.addEventListener("click", () => {
      setSeen();
      close();
    });

    prizeOverlay?.addEventListener("click", (e) => {
      if (e.target === prizeOverlay){
        setSeen();
        close();
      }
    });

    btnShowPrize?.addEventListener("click", () => open());
  }

  function maybeShowOnce(){
    if (!enabled) return;
    if (!hasSeen()) open();
  }

  return { init, maybeShowOnce, open };
})();
    // =====================================================
    // CLAIM OVERLAY
    // =====================================================
    function showClaimOverlay(on){
      if (!claimOverlay) return;
      if (on){
        if (claimOverlayText) claimOverlayText.textContent = escapeText(CONFIG.claimUX.overlayText || "Memproses klaim...");
        if (claimOverlaySub) claimOverlaySub.textContent  = escapeText(CONFIG.claimUX.overlaySub || "Mohon tunggu sebentar");
        claimOverlay.style.display = "flex";
        document.body.classList.add("modal-open");
      } else {
        claimOverlay.style.display = "none";
        document.body.classList.remove("modal-open");
      }
    }

    // =====================================================
    // STATE
    // =====================================================
    let picked = false;
    let pickedIndex = -1;
    let pickedPrize = "";
    let pickBusy = false;
    let lastPickAt = 0;

    // =====================================================
    // UI HELPERS
    // =====================================================
    function showErr(msg){
      if (!errEl) return;
      errEl.textContent = msg || "";
      errEl.classList.toggle("show", !!msg);
    }

    function setPickedState(on){
      picked = !!on;
      if (!grid) return;

      const lock = !!CONFIG.game.lockAfterPick;
      $$(".angpaoBtn", grid).forEach(b => {
        const idx = parseInt(b.dataset.index || "-1", 10);
        if (picked && lock) b.disabled = (idx !== pickedIndex);
        else b.disabled = false;
        if (!picked) b.classList.remove("is-picked");
      });
    }

    function fillPopupMeta({ username, prize, ts }){
      if (prizeVal) prizeVal.textContent = escapeText(prize || "—") || "—";
      if (metaUser) metaUser.textContent = escapeText(username || "—") || "—";
      if (metaTime) metaTime.textContent = fmtTime(ts || Date.now());
    }
    
    function openPopup(){
      if (!popup) return;
      popup.style.display = "flex";
      document.body.classList.add("modal-open");
      if (statusNote) statusNote.textContent = "";
      AudioEngine.onPopupOpen?.();
    }

    function closePopup(){
      if (!popup) return;
      popup.style.display = "none";
      document.body.classList.remove("modal-open");
      AudioEngine.onPopupClose?.();
    }

    // =====================================================
    // GRID BUILD
    // =====================================================
    function buildGrid(){
      if (!grid) return;
      grid.innerHTML = "";
      const n = clamp(parseInt(CONFIG.game.envelopes, 10) || 9, 1, 30);

      const frag = document.createDocumentFragment();
      for (let i = 1; i <= n; i++){
        const b = document.createElement("button");
        b.className = "angpaoBtn";
        b.type = "button";
        b.setAttribute("aria-label", `Pilih Ang Pao ${i}`);
        b.dataset.index = String(i - 1);

        const env = document.createElement("span");
        env.className = "envelope";
        env.setAttribute("aria-hidden", "true");
        b.appendChild(env);

        frag.appendChild(b);
      }
      grid.appendChild(frag);
    }
    buildGrid();

    // =====================================================
    // NAV
    // =====================================================
    function gotoMain(){
      if (loginMenu) loginMenu.style.display = "none";
      if (mainMenu)  mainMenu.style.display  = "block";
      showErr("");
      AudioEngine.ensureBg?.();

      // ✅ tampilkan overlay hadiah (sekali, jika enabled)
      PrizeIntro.maybeShowOnce?.();
    }

    function lockUsernameUI(u){
      if (!usernameEl) return;
      usernameEl.value = u || "";
      usernameEl.readOnly = true;
      usernameEl.setAttribute("aria-readonly", "true");
      usernameEl.classList.add("locked");
    }

    function resetSession(){
      if (statusNote) statusNote.textContent = "";
      pickedIndex = -1;
      pickedPrize = "";
      setPickedState(false);
    }

    // =====================================================
    // INIT RESTORE
    // =====================================================
    (function initRestore(){
      PrizeIntro.init?.();

      if (CONFIG.site.requireUsername && CONFIG.game.oneUsernamePerDevice){
        const savedU = escapeText(STORE.getUser());
        if (savedU) lockUsernameUI(savedU);
      }

      if (CONFIG.game.onePlayPerDevice && STORE.isPlayed()){
        const res = STORE.getResult();
        if (res && res.prize){
          if (res.username && usernameEl) lockUsernameUI(String(res.username));
          gotoMain();

          pickedIndex = Number.isFinite(+res.index) ? (+res.index) : -1;
          pickedPrize = String(res.prize);
          setPickedState(true);

          if (grid && pickedIndex >= 0){
            const btn = $(`.angpaoBtn[data-index="${pickedIndex}"]`, grid);
            btn?.classList.add("is-picked");
          }

          fillPopupMeta({
            username: String(res.username || STORE.getUser() || ""),
            prize: String(res.prize || ""),
            ts: Number.isFinite(+res.ts) ? +res.ts : Date.now()
          });
        } else {
          showErr("Kesempatan bermain telah digunakan.");
          if (btnStart) btnStart.disabled = true;
        }
      } else {
        // jika belum pernah main, tidak auto tampil overlay di login
        // overlay muncul saat masuk main (gotoMain)
      }
    })();

    // =====================================================
    // START
    // =====================================================
    function validateUsername(){
      const u = escapeText(usernameEl?.value);
      const need = !!CONFIG.site.requireUsername;
      if (need && !u){
        showErr("Masukkan User ID dulu.");
        usernameEl?.classList.add("inputBad");
        usernameEl?.focus?.();
        return null;
      }
      usernameEl?.classList.remove("inputBad");
      return u;
    }

    function canStartRealPlay(){
      if (!CONFIG.game.onePlayPerDevice) return true;
      return !STORE.isPlayed();
    }

    btnStart?.addEventListener("click", () => {
      if (Security.isLocked()) return;

      if (!canStartRealPlay()){
        showErr("Kesempatan bermain sudah digunakan.");
        return;
      }

      resetSession();

      const u = validateUsername();
      if (CONFIG.site.requireUsername && !u) return;

      if (CONFIG.site.requireUsername && CONFIG.game.oneUsernamePerDevice){
        STORE.setUser(u);
        lockUsernameUI(u);
      }

      gotoMain();
    });

    usernameEl?.addEventListener("keydown", (e) => {
      if (e.key === "Enter") btnStart?.click();
    });

    // =====================================================
    // PRIZE RESOLVE
    // =====================================================
    function resolveLockedPrimary(){
      const mode = String(CONFIG.game.autoLockPrimaryMode || "off").toLowerCase();
      const prim = (CONFIG.game.primaryPrizes || []).map(escapeText).filter(Boolean);
      if (!prim.length) return null;

      if (mode === "fixed"){
        const fixed = escapeText(CONFIG.game.lockedPrizeFixed);
        return prim.includes(fixed) ? fixed : prim[0];
      }
      if (mode === "random"){
        return prim[(Math.random() * prim.length) | 0];
      }
      return null;
    }

    async function resolvePrize({ username, index }){
      const locked = resolveLockedPrimary();
      if (locked) return locked;

      if (CONFIG.api.enabled){
        const data = await apiFetch(CONFIG.api.endpoints.reveal, { username, index, demo:false });
        const p = (data && (data.prize || data.label)) ? String(data.prize || data.label) : "";
        if (!p) throw new Error("Prize kosong dari server");
        return p;
      }

      return weightedPick(CONFIG.game.prizes);
    }

    // =====================================================
    // PICK LOGIC
    // =====================================================
    async function onPick(btn, ev){
      const t = performance.now();
      if (pickBusy) return;
      if (t - lastPickAt < 220) return;
      lastPickAt = t;

      if (Security.isLocked()) return;
      if (!btn || !grid) return;

      const index = parseInt(btn.dataset.index || "-1", 10);
      if (!Number.isFinite(index) || index < 0) return;

      if (picked && CONFIG.game.lockAfterPick){
        if (index === pickedIndex && pickedPrize){
          const username = escapeText(usernameEl?.value) || escapeText(STORE.getUser());
          const res = STORE.getResult();
          fillPopupMeta({ username, prize: pickedPrize, ts: (res?.ts || Date.now()) });
          openPopup();
        }
        return;
      }

      if (CONFIG.game.onePlayPerDevice && STORE.isPlayed()){
        showErr("Kesempatan bermain sudah digunakan.");
        Security.lock("Akses terbatas.");
        return;
      }

      const username = escapeText(usernameEl?.value) || escapeText(STORE.getUser());
      if (CONFIG.site.requireUsername){
        const u = validateUsername();
        if (!u) return;
      }

      pickBusy = true;

      pickedIndex = index;
      btn.classList.add("is-picked");
      setPickedState(true);

      try{
        const prize = await resolvePrize({ username, index });
        pickedPrize = prize;

        const ts = nowMs();

        if (CONFIG.game.onePlayPerDevice){
          STORE.setPlayed();
          STORE.setResult({
            username: username || STORE.getUser() || "",
            prize: String(prize),
            index: pickedIndex,
            ts
          });
        }

        fillPopupMeta({ username: username || STORE.getUser() || "", prize, ts });

        AudioEngine.win?.();
        openPopup();
      }catch(err){
        pickedIndex = -1;
        pickedPrize = "";
        setPickedState(false);
        btn.classList.remove("is-picked");
        showErr(err?.message ? String(err.message) : "Terjadi error. Coba lagi.");
      } finally {
        pickBusy = false;
      }
    }

    let ignoreClickUntil = 0;

    grid?.addEventListener("pointerup", (e) => {
      const btn = e.target?.closest?.(".angpaoBtn");
      if (!btn) return;
      if (e.pointerType === "mouse" || e.pointerType === "touch" || e.pointerType === "pen"){
        ignoreClickUntil = performance.now() + 450;
        onPick(btn, e);
      }
    }, { passive:true });

    grid?.addEventListener("click", (e) => {
      if (performance.now() < ignoreClickUntil) return;
      const btn = e.target?.closest?.(".angpaoBtn");
      if (!btn) return;
      onPick(btn, e);
    });

    // =====================================================
    // POPUP CLOSE
    // =====================================================
    btnClose?.addEventListener("click", closePopup);
    popup?.addEventListener("click", (e) => { if (e.target === popup) closePopup(); });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && popup && popup.style.display === "flex") closePopup();
      if (e.key === "Escape" && prizeOverlay && prizeOverlay.style.display === "flex"){
        // ESC juga boleh tutup overlay hadiah, tapi tetap tandai "seen"
        try{
          const conf = CONFIG.prizeIntro || {};
          if (conf.enabled && conf.showOncePerDevice){
            localStorage.setItem(String(conf.storageKey || "lap_prize_intro_seen_v1"), "1");
          }
        }catch{}
        prizeOverlay.style.display = "none";
        document.body.classList.remove("modal-open");
      }
    });

    // =====================================================
    // CLAIM (overlay loading seragam)
    // =====================================================
    let claimBusy = false;

    function setClaimLoading(on){
      if (!btnClaim || !claimLabel) return;
      claimBusy = !!on;
      btnClaim.disabled = !!on;

      if (on){
        claimLabel.innerHTML = `<span class="spinner" aria-hidden="true"></span><span>MEMPROSES...</span>`;
      } else {
        claimLabel.textContent = "CLAIM SEKARANG";
      }
    }

    btnClaim?.addEventListener("click", async () => {
      if (!statusNote) return;
      if (Security.isLocked()) return;
      if (claimBusy) return;

      const username = escapeText(usernameEl?.value) || escapeText(STORE.getUser());
      const prize = escapeText(pickedPrize);
      const res = STORE.getResult();
      const ts = (res?.ts || Date.now());

      if (!username || !prize){
        statusNote.textContent = "Data klaim belum lengkap.";
        return;
      }

      setClaimLoading(true);
      showClaimOverlay(true);
      statusNote.textContent = "Memproses klaim...";

      await sleep(clamp(+CONFIG.claimUX.loadingMs || 1800, 900, 6000));

      if (CONFIG.api.enabled){
        try{
          const data = await apiFetch(CONFIG.api.endpoints.claim, { username, prize, index: pickedIndex, ts });
          statusNote.textContent = (data && (data.message || data.status)) ? String(data.message || data.status) : "Klaim diproses.";
          showClaimOverlay(false);
          setClaimLoading(false);
          return;
        }catch(err){
          statusNote.textContent = err?.message ? String(err.message) : "Klaim gagal. Coba lagi.";
          showClaimOverlay(false);
          setClaimLoading(false);
          return;
        }
      }

      if (CONFIG.site.claimRedirectUrl){
        const url = new URL(CONFIG.site.claimRedirectUrl, window.location.href);
        if (username) url.searchParams.set("u", username);
        if (prize) url.searchParams.set("p", prize);
        if (pickedIndex >= 0) url.searchParams.set("i", String(pickedIndex));
        url.searchParams.set("t", String(ts));

        statusNote.textContent = "Membuka live chat...";

        const openNew = !!CONFIG.claimUX.openInNewTab;

        await sleep(220);
        showClaimOverlay(false);
        setClaimLoading(false);

        if (openNew){
          window.open(url.toString(), "_blank", "noopener,noreferrer");
        } else {
          window.location.href = url.toString();
        }
        return;
      }

      statusNote.textContent = "Klaim diproses. Silakan lanjutkan via live chat.";
      showClaimOverlay(false);
      setClaimLoading(false);
    });

    // =====================================================
    // SHARE (link domain + user + waktu)
    // =====================================================
    function buildShareLink({ username, prize, ts }){
      const base = escapeText(CONFIG.site.baseUrl) || window.location.href;
      const u = new URL(base, window.location.href);
      if (username) u.searchParams.set("u", username);
      if (prize) u.searchParams.set("p", prize);
      u.searchParams.set("t", String(ts || Date.now()));
      return u.toString();
    }

    btnShare?.addEventListener("click", async () => {
      if (Security.isLocked()) return;

      const prize = escapeText(pickedPrize);
      const username = escapeText(usernameEl?.value) || escapeText(STORE.getUser());
      const res = STORE.getResult();
      const ts = (res?.ts || Date.now());

      const link = buildShareLink({ username, prize, ts });
      const text =
        `Lucky Ang Pao — ${prize ? `Saya dapat ${prize}` : "Ikutan sekarang!"}` +
        (username ? ` | User: ${username}` : "") +
        ` | Waktu: ${fmtTime(ts)}\n${link}`;

      try{
        if (navigator.share){
          await navigator.share({ title: CONFIG.site.shareTitle || "Lucky Ang Pao", text, url: link });
          if (statusNote) statusNote.textContent = "Berhasil dibagikan.";
        } else if (navigator.clipboard && window.isSecureContext){
          await navigator.clipboard.writeText(text);
          if (statusNote) statusNote.textContent = "Link & detail tersalin.";
        } else {
          window.prompt("Salin ini:", text);
          if (statusNote) statusNote.textContent = "Silakan salin teks.";
        }
      }catch{
        if (statusNote) statusNote.textContent = "Share dibatalkan.";
      }
    });
  });
})();
</script>
</body>
</html>